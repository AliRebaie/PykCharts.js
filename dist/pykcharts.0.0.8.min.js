var PykCharts={};Array.prototype.groupBy=function(a){for(var b,c,d=[],e={oned:["name"],line:["x","name"],area:["x","name"],bar:["y","group"],column:["x","group"],scatterplot:["x","y","name","group"],pulse:["x","y","name","group"],spiderweb:["x","y","name"]},f={oned:{dimension:"name",fact:"weight"},line:{dimension:"x",fact:"y",name:"name"},area:{dimension:"x",fact:"y",name:"name"},bar:{dimension:"y",fact:"x",name:"group"},column:{dimension:"x",fact:"y",name:"group"},scatterplot:{dimension:"x",fact:"y",weight:"weight",name:"name",group:"group"},pulse:{dimension:"y",fact:"x",weight:"weight",name:"name",group:"group"},spiderweb:{dimension:"x",fact:"y",name:"name",weight:"weight"}},g=e[a],h=this,i=[],b=0,j=h.length;j>b;b+=1){var c=h[b];if(0==i.length)i.push([c]);else{for(var k=!1,l=0,m=i.length;m>l;l+=1){var n=i[l],o=!0,p=n[0];g.forEach(function(a){p[a]!==c[a]&&(o=!1)}),o&&(k=n)}k?k.push(c):i.push([c])}}for(b in i)if($.isArray(i[b])){c={};var q=i[b],r=f[a];c[r.dimension]=q[0][r.dimension],r.name&&(c[r.name]=q[0][r.name]),r.weight?(c[r.weight]=d3.sum(q,function(b){return b[f[a].weight]}),c[r.fact]=q[0][r.fact]):c[r.fact]=d3.sum(q,function(b){return b[f[a].fact]}),r.group&&(c[r.group]=q[0][r.group]);var s=_.extend(c,_.omit(q[0],_.values(f[a])));d.push(s)}return d},PykCharts.boolean=function(a){var b=["0","f","false","n","no",""],c=[void 0,null,0/0];return _.contains(c,a)?!1:(value=a.toLocaleString(),value=value.toLowerCase(),b.indexOf(value)>-1?!1:!0)},PykCharts.Configuration=function(a){var b=this,c={liveData:function(b){var c=a.realTimeCharts_refreshFrequency;return PykCharts.boolean(c)&&setInterval(b.refresh,1e3*c),this},emptyDiv:function(){d3.select(a.selector).append("div").style("clear","both")},scaleIdentification:function(a,b,c,d){var e;return"ordinal"===a?e=d3.scale.ordinal().domain(b).rangeRoundBands(c,d):"linear"===a?e=d3.scale.linear().domain(b).range(c):"time"===a?e=d3.time.scale().domain(b).range(c):void 0},appendUnits:function(b){var c,d,e;return d=a.units_prefix,e=a.units_suffix,d&&""!==d?(c=d+" "+b,e&&(c+=" "+e)):c=e&&""!==e?b+" "+e:b,c},title:function(){return PykCharts.boolean(a.title_text)&&a.title_size&&(b.titleDiv=d3.select(a.selector).append("div").attr("id","title").style("width",a.width+"px").style("text-align","left").html("<span style='pointer-events:none;font-size:"+a.title_size+";color:"+a.title_color+";font-weight:"+a.title_weight+";font-family:"+a.title_family+"'>"+a.title_text+"</span>")),this},subtitle:function(){return PykCharts.boolean(a.subtitle_text)&&a.subtitle_size&&(b.subtitleDiv=d3.select(a.selector).append("div").attr("id","sub-title").style("width",a.width+"px").style("text-align","left").html("<span style='pointer-events:none;font-size:"+a.subtitle_size+";color:"+a.subtitle_color+";font-weight:"+a.subtitle_weight+";font-family:"+a.subtitle_family+"'>"+a.subtitle_text+"</span>")),this},createFooter:function(){return d3.select(a.selector).append("table").attr("id","footer").style("background",a.bg).attr("width",a.width+"px"),this},lastUpdatedAt:function(b){if(PykCharts.boolean(a.realTimeCharts_refreshFrequency)&&PykCharts.boolean(a.realTimeCharts_enableLastUpdatedAt))if("liveData"===b){var c=new Date,d=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();$(a.selector+" #lastUpdatedAt").html("<span style='pointer-events:none;'>Last Updated At: </span><span style='pointer-events:none;'>"+d+"</span>")}else{var c=new Date,d=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();d3.select(a.selector+" #footer").append("tr").attr("class","PykCharts-credits").html("<td colspan=2 style='text-align:right' id='lastUpdatedAt'><span style='pointer-events:none;'>Last Updated At: </span><span style='pointer-events:none;'>"+d+"</span></tr>")}return this},checkChangeInData:function(a,c){var d=Object.keys(c[0]),e=Object.keys(a[0]),f=!1;if(d.length===e.length&&c.length===a.length){for(i=0;i<a.length;i++)for(j=0;j<d.length;j++)if(a[i][e[j]]!==c[i][d[j]]||d[j]!==e[j]){f=!0;break}}else f=!0;return b.compare_data=a,[b.compare_data,f]},credits:function(){if(PykCharts.boolean(a.creditMySite_name)||PykCharts.boolean(a.creditMySite_url)){var b=!0;""===a.creditMySite_name&&(a.creditMySite_name=a.creditMySite_url),""===a.creditMySite_url&&(b=!1),d3.select(a.selector+" #footer").append("tr").attr("class","PykCharts-credits").attr("id","credit-datasource").append("td").style("text-align","left").html("<span style='pointer-events:none;'>Credits: </span><a href='"+a.creditMySite_url+"' target='_blank' onclick='return "+b+"'>"+a.creditMySite_name+"</a>")}return this},dataSource:function(){if(PykCharts.boolean(a.dataSource_name)&&PykCharts.boolean(a.dataSource_url)){var b=!0;""===a.dataSource_name&&(a.dataSource_name=a.dataSource_url),""===a.dataSource_url&&(b=!1),$(a.selector+" #footer").length?d3.select(a.selector+" table #credit-datasource").style("background",a.bg).append("td").style("text-align","right").html("<span style='pointer-events:none;'>Source: </span><a href='"+a.dataSource_url+"' target='_blank' onclick='return "+b+"'>"+a.dataSource_name+"</a></tr>"):d3.select(a.selector).append("table").attr("id","footer").style("background",a.bg).attr("width",a.width+"px").append("tr").attr("class","PykCharts-credits").append("td").style("text-align","right").html("<span style='pointer-events:none;'>Source: </span><a href='"+a.dataSource_url+"' target='_blank' onclick='return "+b+"'>"+a.dataSource_name+"</a></tr>")}return this},makeMainDiv:function(b,c){var d=d3.select(b).append("div").attr("id","tooltip-svg-container-"+c).attr("class","main-div").style("width",a.width);return PykCharts.boolean(a.multiple_containers_enable)&&d.style("float","left").style("width","auto"),this},tooltip:function(b,c){return PykCharts.boolean(a.tooltip_enable)&&"default"===a.mode?PykCharts.Configuration.tooltipp=void 0!==c?d3.select(c).append("div").attr("id","pyk-tooltip").attr("class","pyk-line-tooltip"):d3.select("body").append("div").attr("id","pyk-tooltip").style("height","auto").style("padding","5px 6px").style("color","#4F4F4F").style("background","#fff").style("text-decoration","none").style("position","absolute").style("border-radius","5px").style("border","1px solid #CCCCCC").style("text-align","center").style("font-family","Arial, Helvetica, sans-serif").style("font-size","14px").style("min-width","30px").style("z-index","10").style("visibility","hidden").style("box-shadow","0 5px 10px rgba(0,0,0,.2)"):PykCharts.boolean(a.tooltip_enable)&&(PykCharts.Configuration.tooltipp="fixed"===a.tooltip_mode?d3.select("body").append("div").attr("id","pyk-tooltip").style("height","auto").style("padding","5px 6px").style("color","#4F4F4F").style("background","#fff").style("text-decoration","none").style("position","absolute").style("border-radius","5px").style("text-align","center").style("font-family","Arial, Helvetica, sans-serif").style("font-size","14px").style("min-width","30px").style("z-index","10").style("visibility","hidden"):d3.select("body").append("div").attr("id","pyk-tooltip").style("height","auto").style("padding","5px 6px").style("color","#4F4F4F").style("background","#fff").style("text-decoration","none").style("position","absolute").style("border-radius","5px").style("text-align","center").style("font-family","Arial, Helvetica, sans-serif").style("font-size","14px").style("min-width","30px").style("z-index","10").style("visibility","hidden")),this},annotation:function(b){_.each(b[0],function(c,d){$(a.selector+" #"+b[0].parentNode.id+"-tooltip"+d).length>0&&$(a.selector+" #"+b[0].parentNode.id+"-tooltip"+d).remove();var e=$(c).offset(),f=0,g=0;PykCharts.boolean(a.multiple_containers_enable)?(f=$(a.selector+" #"+b[0].parentNode.parentNode.id).offset().left,g=$(a.selector+" #"+b[0].parentNode.parentNode.id).offset().top):(f=$(a.selector+" #"+b[0].parentNode.parentNode.id).offset().left,g=$(a.selector+" #"+b[0].parentNode.parentNode.id).offset().top);{var i=d3.select(a.selector+" #"+b[0].parentNode.id).append("g").attr("id",b[0].parentNode.id+"-tooltip"+d),j=i.append("rect");i.append("text").attr("x",e.left-f).attr("y",e.top-g-5).attr("text-anchor","middle").style("z-index","10").text(function(){return $(c)[0].__data__.annotation}).text(function(){return w=this.getBBox().width+20,h=this.getBBox().height+10,$(c)[0].__data__.annotation}).style("pointer-events","none")}j.attr("x",e.left-f-w/2).attr("y",e.top-g-h).attr("width",w).attr("height",h).attr("fill","#eeeeee").style("pointer-events","none")})},crossHair:function(b,c,d,e){if(PykCharts.boolean(a.enableCrossHair)&&"default"===a.mode)for(PykCharts.Configuration.cross_hair_v=b.append("g").attr("class","line-cursor").style("display","none"),PykCharts.Configuration.cross_hair_v.append("line").attr("class","cross-hair-v").attr("id","cross-hair-v"),PykCharts.Configuration.cross_hair_h=b.append("g").attr("class","line-cursor").style("display","none"),PykCharts.Configuration.cross_hair_h.append("line").attr("class","cross-hair-h").attr("id","cross-hair-h"),j=0;c>j;j++)PykCharts.Configuration.focus_circle=b.append("g").attr("class","focus").style("display","none").attr("id","f_circle"+j),PykCharts.Configuration.focus_circle.append("circle").attr("fill",function(){return e.colorPieMS(d[j])}).attr("id","focus-circle"+j).attr("r",6);return this},fullScreen:function(c){return PykCharts.boolean(a.fullScreen)&&(b.fullScreenButton=d3.select(a.selector).append("input").attr("type","image").attr("id","btn-zoom").attr("src","../../PykCharts/img/apple_fullscreen.jpg").style("font-size","30px").style("left","800px").style("top","0px").style("position","absolute").style("height","4%").on("click",c.fullScreen)),this},loading:function(){return PykCharts.boolean(a.loading)&&($(a.selector).html("<div id='chart-loader'><img src="+a.loading+"></div>"),$(a.selector+" #chart-loader").css({visibility:"visible","padding-left":a.width/2+"px","padding-top":a.height/2+"px"})),this},positionContainers:function(b,c){return PykCharts.boolean(a.legends_enable)&&!PykCharts.boolean(a.size_enable)?(("top"==b||"left"==b)&&c.optionalFeatures().legendsContainer().svgContainer(),("bottom"==b||"right"==b)&&c.optionalFeatures().svgContainer().legendsContainer()):c.optionalFeatures().svgContainer(),this},yGrid:function(b,c,d){a.width,a.height;if(PykCharts.boolean(a.grid_yEnabled)){var e=PykCharts.Configuration.makeYGrid(a,d);c.selectAll(a.selector+" g.y.grid-line").style("stroke",function(){return a.grid_color}).call(e)}return this},xGrid:function(b,c,d){a.width,a.height;if(PykCharts.boolean(a.grid_xEnabled)){var e=PykCharts.Configuration.makeXGrid(a,d);c.selectAll(a.selector+" g.x.grid-line").style("stroke",function(){return a.grid_color}).call(e)}return this},xAxis:function(b,c,d,e,f){var g=(a.width,a.height,new PykCharts.Configuration(a));if(PykCharts.boolean(a.axis_x_enable)){d3.selectAll(a.selector+" .x.axis").attr("fill",function(){return a.axis_x_labelColor}),"bottom"===a.axis_x_position&&c.attr("transform","translate(0,"+(a.height-a.margin_top-a.margin_bottom)+")");var h=PykCharts.Configuration.makeXAxis(a,d);if(0!=a.axis_x_pointer_values.length){var i=[];"time"===a.xAxisDataFormat?_.each(a.axis_x_pointer_values,function(a){i.push(new Date(a))}):i=a.axis_x_pointer_values,h.tickValues(i)}c.style("stroke",function(){return a.axis_x_axisColor}).call(h),"string"===a.xAxisDataFormat&&"no"===a.multiple_containers_enable&&g.ordinalXAxisTickFormat(f,e)}return this},yAxis:function(b,c,d,e){var f,g=(a.width,a.height,new PykCharts.Configuration(a));if(f=PykCharts.boolean(a.multiple_containers_enable)?a.w:a.width,PykCharts.boolean(a.axis_y_enable)){"right"===a.axis_y_position&&c.attr("transform","translate("+(f-a.margin_left-a.margin_right)+",0)"),d3.selectAll(a.selector+" .y.axis").attr("fill",function(){return a.axis_y_labelColor});var h=PykCharts.Configuration.makeYAxis(a,d);0!=a.axis_y_pointer_values.length&&h.tickValues(a.axis_y_pointer_values);{new PykCharts.Configuration.mouseEvent(a)}c.style("stroke",function(){return a.axis_y_axisColor}).call(h),"string"===a.yAxisDataFormat&&"no"===a.multiple_containers_enable&&g.ordinalYAxisTickFormat(e)}return this},xAxisTitle:function(b){var c;return c=PykCharts.boolean(a.multiple_containers_enable)?a.w:a.width,"bottom"===a.axis_x_position?b.append("text").attr("x",(c-a.margin_left-a.margin_right)/2).attr("y",a.margin_bottom).style("text-anchor","middle").style("fill",a.axis_x_labelColor).text(a.axis_x_title):"top"===a.axis_x_position&&b.append("text").attr("x",(c-a.margin_left-a.margin_right)/2).attr("y",-a.margin_top+10).style("text-anchor","middle").style("fill",a.axis_x_labelColor).text(a.axis_x_title),this},yAxisTitle:function(b){var c;return c=PykCharts.boolean(a.multiple_containers_enable)?a.w:a.width,"left"===a.axis_y_position?b.append("text").attr("x",-a.height/2).attr("transform","rotate(-90)").attr("y",-(a.margin_left-12)).style("fill",a.axis_y_labelColor).text(a.axis_y_title):"right"===a.axis_y_position&&b.append("text").attr("x",-a.height/2).attr("transform","rotate(-90)").style("fill",a.axis_y_labelColor).attr("y",a.margin_right-12).attr("dy",".71em").text(a.axis_y_title),this},isOrdinal:function(b,c,d,e,f){var g=new PykCharts.Configuration(a);return".x.axis"===c?(b.select(c).call(PykCharts.Configuration.makeXAxis(a,d)),"string"===a.xAxisDataFormat&&"no"===a.multiple_containers_enable&&g.ordinalXAxisTickFormat(e,f)):".x.grid"===c?b.select(c).call(PykCharts.Configuration.makeXGrid(a,d)):".y.axis"===c?(b.select(c).call(PykCharts.Configuration.makeYAxis(a,d)),"string"===a.yAxisDataFormat&&"no"===a.multiple_containers_enable&&g.ordinalyAxisTickFormat(e)):".y.grid"===c&&b.select(c).call(PykCharts.Configuration.makeYGrid(a,d)),this},ordinalXAxisTickFormat:function(b,c){var d,e=new PykCharts.Configuration.mouseEvent(a),f=$(a.selector+" g.x.axis text"),g=f.length;for(i=0;g-1>i;i++)d=f[i].innerHTML,f[i].getBBox().width>2*c*.7&&(d=d.substr(0,3)+".."),f[i].innerHTML=d;return xaxistooltip=d3.selectAll(a.selector+" g.x.axis text").data(b),xaxistooltip.on("mouseover",function(a){e.tooltipPosition(a),e.toolTextShow(a)}).on("mousemove",function(a){e.tooltipPosition(a),e.toolTextShow(a)}).on("mouseout",function(a){e.tooltipHide(a)}),this},ordinalYAxisTickFormat:function(b){var c,d=new PykCharts.Configuration.mouseEvent(a),e=$(a.selector+" g.y.axis text"),f=e.length;for(i=0;f-1>i;i++)c=e[i].innerHTML,e[i].getBBox().width>.7*a.margin_left&&(c=c.substr(0,3)+".."),e[i].innerHTML=c;return xaxistooltip=d3.selectAll(a.selector+" g.y.axis text").data(b),xaxistooltip.on("mouseover",function(a){d.tooltipPosition(a),d.toolTextShow(a)}).on("mousemove",function(a){d.tooltipPosition(a),d.toolTextShow(a)}).on("mouseout",function(a){d.tooltipHide(a)}),this},totalColors:function(a){var c=parseInt(a,10);return c>2&&10>c?(b.total_colors=c,this):(b.total_colors=9,this)},colorType:function(a){return"colors"===a&&(b.legends="no"),this},xAxisDataFormatIdentification:function(a){return _.isNumber(a[0].x)||!isNaN(a[0].x)?"number":isNaN(new Date(a[0].x).getTime())?"string":"time"},yAxisDataFormatIdentification:function(a){return _.isNumber(a[0].y)||!isNaN(a[0].y)?"number":isNaN(new Date(a[0].y).getTime())?"string":"time"},resize:function(b,c,d){var e=a.width/a.height,f=$(a.selector).width();f>a.width&&(f=a.width),b.attr("width",f),b.attr("height",f/e),PykCharts.boolean(a.title_text)&&$(a.selector+" #title").css("width",f),PykCharts.boolean(a.subtitle_text)&&$(a.selector+" #sub-title").css("width",f),void 0!==d&&d.attr("width",f);var g=$(a.selector+" #footer");g&&g.attr("width",f);var h=$(a.selector+" .main-div");h&&!PykCharts.boolean(a.multiple_containers_enable)&&$(a.selector+" .main-div").css("width",f),PykCharts.boolean(c)},__proto__:{_domainBandwidth:function(a,b,c){if(addFactor=0,"time"===c){var d=a[0],e=a[1],f=[];return padding=.1*(e-d),0===b?f[0]=d-(padding+addFactor):1===b?f[1]=e+(padding+addFactor):2===b&&(f[0]=d-(padding+addFactor),f[1]=e+(padding+addFactor)),[new Date(f[0]),new Date(f[1])]}return padding=.1*(a[1]-a[0]),0===b?a[0]-=padding+addFactor:1===b?a[1]=parseFloat(a[1],10)+(padding+addFactor):2===b&&(a[0]-=padding+addFactor,a[1]=parseFloat(a[1],10)+(padding+addFactor)),a},_radiusCalculation:function(b){var c=d3.min([a.width,a.height]);return c*b/200}}};return c};var configuration=PykCharts.Configuration;configuration.mouseEvent=function(a){var b=this;b.tooltip=configuration.tooltipp,b.cross_hair_v=configuration.cross_hair_v,b.cross_hair_h=configuration.cross_hair_h,b.focus_circle=configuration.focus_circle,b.pt_circle=configuration.pt_circle,b.start_pt_circle=configuration.start_pt_circle;var c={tooltipPosition:function(c,d,e,f,g,h){if(PykCharts.boolean(a.tooltip_enable)){if(void 0!==d){var i=parseFloat($(a.selector+" #tooltip-svg-container-"+h).next("#pyk-tooltip").css("width"));$(a.selector+" #tooltip-svg-container-"+h).next("#pyk-tooltip").css("visibility","visible").css("top",e+g+"px").css("left",d+a.margin_left+f-i+"px")}else b.tooltip.style("visibility","visible").style("top",d3.event.layerY-20+"px").style("left",d3.event.layerX+30+"px");return b.tooltip}},toolTextShow:function(c,d,e,f){return PykCharts.boolean(a.tooltip_enable)&&("yes"===d&&"multilineChart"===e?$(a.selector+" #tooltip-svg-container-"+f).next("#pyk-tooltip").html(c):b.tooltip.html(c)),this},tooltipHide:function(c,d,e){return PykCharts.boolean(a.tooltip_enable)?"yes"===d&&"multilineChart"===e?d3.selectAll(a.selector+" .pyk-line-tooltip").style("visibility","hidden"):b.tooltip.style("visibility","hidden"):void 0},crossHairPosition:function(b,c,d,e,f,g,h,j,l,m,n){if((PykCharts.boolean(a.enableCrossHair)||PykCharts.boolean(a.tooltip_enable)||PykCharts.boolean(a.onHoverHighlightenable))&&"default"===a.mode){var o=$(a.selector+" #"+f[0].attr("id")).offset().left,p=$(a.selector+" #"+f[0].attr("id")).offset().top,q=c.length,r=a.margin_left,s=(a.margin_right,a.margin_top),t=a.margin_bottom,u=(a.width,a.height),v=parseInt(d3.event.target.id.substr(d3.event.target.id.length-1,1)),w=d3.event.pageX-o,x=d3.event.pageY-p,y=[];if("string"===a.xAxisDataFormat)y=d.range();else for(temp=d.range(),pad=(temp[1]-temp[0])/c[0].data.length,len=c[0].data.length,strt=0,i=0;len>i;i++)strt+=pad,y[i]=strt;var z,A,B,C,D,E,F,G,H,I,J=e.range(),K=[],L=[],M=y.length;for(z=0;M>z;z++)for(k=0;k<J.length;k++){if(z+1>=M)return!1;if(E===y[z]&&F===y[z+1]&&I===J[k])return!1;if(w>=y[z]&&w<=y[z+1]&&x<=J[k]-s-t)if(F=y[z],E=y[z+1],H=J[k+1],I=J[k],B=F-w,C=w-E,B>=C?(A=b[z].x,K.push(b[z].y),tooltipText=b[z].tooltip||b[z].y,D=d(A)+g+r,L=e(b[z].y)+s):(A=b[z+1].x,K.push(b[z+1].y),tooltipText=b[z+1].tooltip||b[z+1].y,D=d(A)+g+r,L=e(b[z+1].y)+s),"multilineChart"===j){if("no"===n){var N=[];d3.selectAll(a.selector+" #pyk-tooltip").classed({"pyk-line-tooltip":!1,"pyk-multiline-tooltip":!0,"pyk-tooltip-table":!0});var O=c[0].data.length,P="";K=[];for(var Q=0;q>Q;Q++)for(var R=0;O>R;R++)cond="time"===a.xAxisDataFormat?Date.parse(A)===Date.parse(c[Q].data[R].x):c[Q].data[R].x===A,cond&&(K.push(c[Q].data[R].y),N.push(e(c[Q].data[R].y)+s),PykCharts.boolean(m)?PykCharts.boolean(m)&&(P+="<tr><td><div style='padding:2px;width:5px;height:5px;background-color:"+c[Q].color+"'></div></td><td>"+c[Q].name+"</td><td><b>"+c[Q].data[R].tooltip+"</b></td></tr>",G=3):(P+="<tr><td>"+c[Q].name+"</td><td><b>"+c[Q].data[R].tooltip+"</b></td></tr>",G=2));D+=6,tooltipText="<table><thead><th colspan='"+G+"'>"+A+"</th></thead><tbody>"+P+"</tbody></table>","stackedAreaChart"===j?(v=1,this.tooltipPosition(tooltipText,D,x,60,70,v)):this.tooltipPosition(tooltipText,D,x,60,-15,v),this.toolTextShow(tooltipText),a.enableCrossHair?this.crossHairShow(D,s,D,u-t,D,N,j,K.length,n,c):null,this.axisHighlightShow(K,a.selector+" .y.axis",h),this.axisHighlightShow(A,a.selector+" .x.axis",h)}else if("yes"===n){D+=5;for(var O=c[0].data.length,Q=0;q>Q;Q++)for(var S=$(a.selector+" #svg-"+Q).offset().left,T=$(a.selector+" #svg-"+Q).offset().top-$(a.selector).offset().top,R=0;O>R;R++)cond="time"===a.xAxisDataFormat?Date.parse(A)===Date.parse(c[Q].data[R].x):c[Q].data[R].x===A,cond&&(K.push(c[Q].data[R].y),tooltipText=c[Q].data[R].tooltip,L=e(c[Q].data[R].y)+s,this.tooltipPosition(tooltipText,D+S,L+T,-15,-15,Q),this.toolTextShow(tooltipText,n,j,Q),a.enableCrossHair?this.crossHairShow(D,s,D,u-t,D,L,j,K.length,n,c[Q],Q):null)}}else if("lineChart"===j||"areaChart"===j)"fixed"===a.tooltip_mode.toLowerCase()?this.tooltipPosition(tooltipText,0,L,-14,-15,v):"moving"===a.tooltip_mode.toLowerCase()&&this.tooltipPosition(tooltipText,D,L,5,-45,v),this.toolTextShow(tooltipText),a.enableCrossHair?this.crossHairShow(D,s,D,u-t,D,L,j,K.length,n):null,this.axisHighlightShow(K,a.selector+" .y.axis",h),this.axisHighlightShow(A,a.selector+" .x.axis",h);else if("stackedAreaChart"===j){var N=[];d3.selectAll(a.selector+" #pyk-tooltip").classed({"pyk-line-tooltip":!1,"pyk-multiline-tooltip":!0,"pyk-tooltip-table":!0});var O=c[0].data.length,P="";K=[];for(var Q=0;q>Q;Q++)for(var R=0;O>R;R++)cond="time"===a.xAxisDataFormat?Date.parse(A)===Date.parse(c[Q].data[R].x):c[Q].data[R].x===A,cond&&(K.push(c[Q].data[R].y),N.push(e(c[Q].data[R].y+c[Q].data[R].y0)+s),PykCharts.boolean(m)?PykCharts.boolean(m)&&(P+="<tr><td><div style='padding:2px;width:5px;height:5px;background-color:"+c[Q].color+"'></div></td><td>"+c[Q].name+"</td><td><b>"+c[Q].data[R].tooltip+"</b></td></tr>",G=3):(P+="<tr><td>"+c[Q].name+"</td><td><b>"+c[Q].data[R].tooltip+"</b></td></tr>",G=2));D+=6,tooltipText="<table><thead><th colspan='"+G+"'>"+A+"</th></thead><tbody>"+P+"</tbody></table>","stackedAreaChart"===j?(v=1,this.tooltipPosition(tooltipText,D,x,60,70,v)):this.tooltipPosition(tooltipText,D,x,60,-15,v),this.toolTextShow(tooltipText),a.enableCrossHair?this.crossHairShow(D,s,D,u-t,D,N,j,K.length,n,c):null,this.axisHighlightShow(K,a.selector+" .y.axis",h),this.axisHighlightShow(A,a.selector+" .x.axis",h)}}}},crossHairShow:function(c,d,e,f,g,h,i,k,l,m,n){if(PykCharts.boolean(a.enableCrossHair)&&void 0!==c)if("lineChart"===i||"areaChart"===i)b.cross_hair_v.style("display","block"),b.cross_hair_v.select(a.selector+" #cross-hair-v").attr("x1",c).attr("y1",d).attr("x2",e).attr("y2",f),b.cross_hair_h.style("display","block"),b.cross_hair_h.select(a.selector+" #cross-hair-h").attr("x1",a.margin_left).attr("y1",h).attr("x2",a.width-a.margin_right).attr("y2",h),b.focus_circle.style("display","block").attr("transform","translate("+g+","+h+")");else if("multilineChart"===i)if("no"===l)for(b.cross_hair_v.style("display","block"),b.cross_hair_v.select(a.selector+" #cross-hair-v").attr("x1",c-5).attr("y1",d).attr("x2",e-5).attr("y2",f),j=0;j<m.length;j++)d3.select(a.selector+" #f_circle"+j).style("display","block").attr("transform","translate("+(g-3)+","+h[j]+")");else"yes"===l&&(d3.selectAll(a.selector+" .line-cursor").style("display","block"),d3.selectAll(a.selector+" .cross-hair-v").attr("x1",c-5).attr("y1",d).attr("x2",e-5).attr("y2",f),d3.select(a.selector+" #svg-"+n+" .cross-hair-h").attr("x1",a.margin_left).attr("y1",h).attr("x2",a.width-a.margin_right).attr("y2",h),d3.select(a.selector+" #svg-"+n+" .focus").style("display","block").attr("transform","translate("+(g-5)+","+h+")"));else if("stackedAreaChart"===i)for(b.cross_hair_v.style("display","block"),b.cross_hair_v.select(a.selector+" #cross-hair-v").attr("x1",c-5).attr("y1",d).attr("x2",e-5).attr("y2",f),j=0;j<m.length;j++)d3.select(a.selector+" #f_circle"+j).style("display","block").attr("transform","translate("+(g-3)+","+h[j]+")");return this},crossHairHide:function(c){return PykCharts.boolean(a.enableCrossHair)&&(b.cross_hair_v.style("display","none"),"lineChart"===c||"areaChart"===c?(b.cross_hair_h.style("display","none"),b.focus_circle.style("display","none")):("multilineChart"===c||"stackedAreaChart"===c)&&(d3.selectAll(a.selector+" .line-cursor").style("display","none"),d3.selectAll(a.selector+" .focus").style("display","none"))),this},axisHighlightShow:function(b,c,d,e){var f,g,h,i,j;if(PykCharts.boolean(a.axis_onHoverHighlightenable))if(c===a.selector+" .y.axis"){i=c+" .tick text",h=a.axis_y_labelColor,j=d3.selectAll(i)[0].length,d3.selectAll(i).style("fill","#bbb").style("font-size","12px").style("font-weight","normal");for(var k=0;j>k;k++)for(var e=0;e<b.length;e++)d3.selectAll(i)[0][k].innerHTML==b[e]&&d3.select(d3.selectAll(i)[0][k]).style("fill",h).style("font-size","13px").style("font-weight","bold")}else{c===a.selector+" .x.axis"?(i=c+" .tick text",h=a.axis_x_labelColor):c===a.selector+" .axis-text"&&"column"===e?(i=c,h=a.axis_x_labelColor):c===a.selector+" .axis-text"&&"bar"===e&&(i=c,h=a.axis_y_labelColor),void 0!==g&&d3.select(d3.selectAll(i)[0][g]).style("fill",h).style("font-weight","normal");var l=d.length;for(f=0;l>f&&d[f]!==b;f++);g=f,d3.selectAll(i).style("fill","#bbb").style("font-size","12px").style("font-weight","normal"),d3.select(d3.selectAll(i)[0][f]).style("fill",h).style("font-size","13px").style("font-weight","bold")}return this},axisHighlightHide:function(b,c){var d,e;return PykCharts.boolean(a.axis_onHoverHighlightenable)&&(b===a.selector+" .y.axis"?(e=b+" .tick text",d=a.axis_y_labelColor):b===a.selector+" .x.axis"?(e=b+" .tick text",d=a.axis_x_labelColor):b===a.selector+" .axis-text"&&"column"===c?(e=b,d=a.axis_x_labelColor):b===a.selector+" .axis-text"&&"bar"===c&&(e=b,d=a.axis_y_labelColor),d3.selectAll(e).style("fill",d).style("font-size","12px").style("font-weight","normal")),this}};return c},configuration.fillChart=function(a,b){var c={color:function(a){return a.color},saturation:function(){return"steelblue"},selectColor:function(b){return b.name===a.highlight?a.highlightColor:a.chartColor},colorChart:function(c){return c.name===a.highlight?b.stylesheet.highlightColor:b.stylesheet.chartColor},colorPieW:function(b){return PykCharts.boolean(a.size_enable)?PykCharts.boolean(a.size_enable)?b.color?b.color:a.color.length?a.color:a.chartColor:void 0:a.saturationColor},colorPieMS:function(b){return b.name.toLowerCase()===a.highlight.toLowerCase()?a.highlightColor:"saturation"===a.color_mode?a.saturationColor:"color"===a.color_mode&&b.color?b.color:"color"===a.color_mode&&a.color.length?a.color:a.chartColor},colorLegends:function(b){return"saturation"===a.color_mode?a.saturationColor:"color"===a.color_mode&&b?b:"color"===a.color_mode&&a.color.length?a.color:a.chartColor}};return c},configuration.border=function(a){var b={width:function(){return a.borderBetweenChartElements_thickness},color:function(){return a.borderBetweenChartElements_color},style:function(){return a.borderBetweenChartElements_style}};return b},configuration.makeXAxis=function(c,d){var e=(PykCharts.Configuration(c),d3.svg.axis().scale(d).tickSize(c.axis_x_pointer_size).outerTickSize(c.axis_x_outer_pointer_size).tickFormat(function(a){return"yes"===c.multiple_containers_enable&&"string"===c.xAxisDataFormat?a.substr(0,2):a}).tickPadding(c.axis_x_pointer_padding).orient(c.axis_x_value_position));return"time"===c.xAxisDataFormat&&PykCharts.boolean(c.axis_x_time_value_datatype)?("month"===c.axis_x_time_value_datatype?(console.log("its a month"),a=d3.time.month,b="%b"):"date"===c.axis_x_time_value_datatype?(a=d3.time.day,b="%d"):"year"===c.axis_x_time_value_datatype?(a=d3.time.year,b="%Y"):"hours"===c.axis_x_time_value_datatype?(a=d3.time.hour,b="%H"):"minutes"===c.axis_x_time_value_datatype&&(a=d3.time.minute,b="%M"),e.ticks(a,c.axis_x_time_value_interval).tickFormat(d3.time.format(b))):"number"===c.xAxisDataFormat&&e.ticks(c.axis_x_no_of_axis_value),e},configuration.makeYAxis=function(c,d){var e=PykCharts.Configuration(c),f=d3.svg.axis().scale(d).orient(c.axis_y_value_position).tickSize(c.axis_y_pointer_size).outerTickSize(c.axis_y_outer_pointer_size).tickPadding(c.axis_y_pointer_padding).tickFormat(function(a){return e.appendUnits(a)});return"time"===c.yAxisDataFormat&&PykCharts.boolean(c.axis_y_time_value_type)?("month"===c.axis_y_time_value_type?(a=d3.time.month,b="%b"):"date"===c.axis_y_time_value_type?(a=d3.time.day,b="%d"):"year"===c.axis_y_time_value_type?(a=d3.time.year,b="%Y"):"hours"===c.axis_y_time_value_type?(a=d3.time.hour,b="%H"):"minutes"===c.axis_y_time_value_type&&(a=d3.time.minute,b="%M"),xaxis.ticks(a,c.axis_y_time_value_unit).tickFormat(d3.time.format(b))):"number"===c.yAxisDataFormat&&f.ticks(c.axis_y_no_of_axis_value),f},configuration.makeXGrid=function(a,b){var c=d3.svg.axis().scale(b).orient("bottom").ticks(a.axis_x_no_of_axis_value).tickFormat("").tickSize(a.height-a.margin_top-a.margin_bottom).outerTickSize(0);return c},configuration.makeYGrid=function(a,b){var c=d3.svg.axis().scale(b).orient("left").ticks(a.axis_x_no_of_axis_value).tickSize(-(a.width-a.margin_left-a.margin_right)).tickFormat("").outerTickSize(0);return c},configuration.transition=function(a){var b={duration:function(){return"default"===a.mode&&PykCharts.boolean(a.transition_duration)?a.transition_duration:0}};return b},configuration.Theme=function(){var a=this;return a.stylesheet={chart_height:400,chart_width:600,chart_margin_top:35,chart_margin_right:50,chart_margin_bottom:35,chart_margin_left:50,chart_grid_xEnabled:"yes",chart_grid_yEnabled:"yes",chart_grid_color:"#ddd",mode:"default",selector:"body",title_size:"15px",title_color:"#1D1D1D",title_weight:"bold",title_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",subtitle_size:"12px",subtitle_color:"black",subtitle_weight:"thin",subtitle_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",loading_animationGifUrl:"https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/img/loader.gif",buttons_enableFullScreen:"no",tooltip_enable:"yes",creditMySite_name:"Pykih",creditMySite_url:"http://www.pykih.com",highlight:"",backgroundColor:"transparent",chartColor:"steelblue",highlightColor:"#013F73",saturationColor:"steelblue",borderBetweenChartElements_thickness:1,borderBetweenChartElements_color:"white",borderBetweenChartElements_style:"solid",legendsText_size:13,legendsText_color:"white",legendsText_weight:"thin",legendsText_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",label_size:13,label_color:"white",label_weight:"thin",label_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",pointer_overflow_enable:"no",pointer_thickness:1,pointer_weight:"thin",pointer_size:13,pointer_color:"#1D1D1D",pointer_family:"'Helvetica Neue',Helvetica,Arial,sans-serif"},a.functionality={realTimeCharts_refreshFrequency:0,realTimeCharts_enableLastUpdatedAt:"yes",transition_duration:0},a.oneDimensionalCharts={clubData_enable:"yes",clubData_text:"others",clubData_maximumNodes:5,donut_radiusPercent:70,donut_innerRadiusPercent:40,donut_showTotalAtTheCenter:"yes",pie_radiusPercent:70,pictograph_showTotal:"yes",pictograph_enableTotal:"yes",pictograph_enableCurrent:"yes",pictograph_imagePerLine:3,pictograph_imageWidth:79,pictograph_imageHeight:66,pictograph_activeText_size:64,pictograph_activeText_color:"steelblue",pictograph_activeText_weight:"thin",pictograph_activeText_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",pictograph_inactiveText_size:64,pictograph_inactiveText_color:"grey",pictograph_inactiveText_weight:"thin",pictograph_inactiveText_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",funnel_rectWidth:100,funnel_rectHeight:100},a.multiDimensionalCharts={axis_onHoverHighlightenable:"no",axis_x_enable:"yes",axis_x_title:"X axis",axis_x_position:"bottom",axis_x_value_position:"bottom",axis_x_axisColor:"#1D1D1D",axis_x_labelColor:"#1D1D1D",axis_x_no_of_axis_value:5,axis_x_pointer_size:5,axis_x_value_format:"",axis_x_pointer_padding:6,axis_x_pointer_values:[],axis_x_outer_pointer_size:0,axis_x_time_value_datatype:"",axis_x_time_value_interval:"",axis_y_enable:"yes",axis_y_title:"Y axis",axis_y_position:"left",axis_y_value_position:"left",axis_y_axisColor:"#1D1D1D",axis_y_labelColor:"#1D1D1D",axis_y_no_of_axis_value:5,axis_y_pointer_size:5,axis_y_value_format:"",axis_y_pointer_padding:6,axis_y_pointer_values:[],axis_y_outer_pointer_size:0,axis_y_time_value_datatype:"",axis_y_time_value_interval:"",yAxisDataFormat:"number",xAxisDataFormat:"string",enableCrossHair:"yes",zoom_enable:"no",size_enable:"yes",color_mode:"color",color:["yellow"],spiderweb_outerRadiusPercent:80,spiderweb_radius:5,spiderweb_axisTitle:"yes",spiderweb_pointer:"yes",multiple_containers_enable:"no",legends_enable:"yes",legends_display:"horizontal",tooltip_enable:"yes",tooltip_mode:"fixed",scatterplot_radius:40,scatterplot_pointer:"no",line_curvy_lines:"no"},a.treeCharts={zoom_enable:"no",nodeRadius:4.5},a.mapsTheme={chart_width:1e3,chart_height:1e3,colors_defaultColor:"#4682B4",colors_total:3,colors_type:"saturation",colors_palette:"Blue",colors_backgroundColor:"white",tooltip_enable:"yes",tooltip_mode:"moving",tooltip_positionTop:0,tooltip_positionLeft:0,timeline_duration:1e3,timeline_margin_top:5,timeline_margin_right:25,timeline_margin_bottom:25,timeline_margin_left:45,legends_enable:"yes",legends_display:"horizontal",label_enable:"no",enableClick:"yes",onhover:"shadow",highlightArea:"no",highlight:"",axis_onHoverHighlightenable:"no",axis_x_enable:"yes",axis_x_value_position:"top",axis_x_axisColor:"#1D1D1D",axis_x_labelColor:"#1D1D1D",axis_x_pointer_size:5,axis_x_value_format:"",axis_x_pointer_padding:6,axis_x_pointer_values:[],axis_x_outer_pointer_size:0},a
},PykCharts.oneD={},PykCharts.oneD.mouseEvent=function(){var a={highlight:function(a,b){var c=d3.select(b);return d3.selectAll(a).attr("opacity",.5),c.attr("opacity",1),this},highlightHide:function(a){return d3.selectAll(a).attr("opacity",1),this}};return a},PykCharts.oneD.processInputs=function(a,b){{var c=new PykCharts.Configuration.Theme({}),d=c.stylesheet,e=c.functionality,f=c.oneDimensionalCharts;b.optional}switch(a.selector=b.selector?b.selector:d.selector,a.width=b.chart_width&&_.isNumber(b.chart_width)?b.chart_width:d.chart_width,a.height=b.chart_height&&_.isNumber(b.chart_height)?b.chart_height:d.chart_height,a.mode=b.mode?b.mode:d.mode,b&&PykCharts.boolean(b.title_text)?(a.title_text=b.title_text,a.title_size="title_size"in b?b.title_size:d.title_size,a.title_color=b.title_color?b.title_color:d.title_color,a.title_weight=b.title_weight?b.title_weight:d.title_weight,a.title_family=b.title_family?b.title_family:d.title_family):(a.title_size=d.title_size,a.title_color=d.title_color,a.title_weight=d.title_weight,a.title_family=d.title_family),b&&PykCharts.boolean(b.subtitle_text)?(a.subtitle_text=b.subtitle_text,a.subtitle_size="subtitle_size"in b?b.subtitle_size:d.subtitle_size,a.subtitle_color=b.subtitle_color?b.subtitle_color:d.subtitle_color,a.subtitle_weight=b.subtitle_weight?b.subtitle_weight:d.subtitle_weight,a.subtitle_family=b.subtitle_family?b.subtitle_family:d.subtitle_family):(a.subtitle_size=d.subtitle_size,a.subtitle_color=d.subtitle_color,a.subtitle_weight=d.subtitle_weight,a.subtitle_family=d.subtitle_family),a.realTimeCharts_refreshFrequency=b.realTimeCharts_refreshFrequency?b.realTimeCharts_refreshFrequency:e.realTimeCharts_refreshFrequency,a.realTimeCharts_enableLastUpdatedAt=b.realTimeCharts_enableLastUpdatedAt?b.realTimeCharts_enableLastUpdatedAt:e.realTimeCharts_enableLastUpdatedAt,a.creditMySite_name=b.creditMySite_name?b.creditMySite_name:d.creditMySite_name,a.creditMySite_url=b.creditMySite_url?b.creditMySite_url:d.creditMySite_url,a.dataSource_name=b.dataSource_name?b.dataSource_name:"",a.dataSource_url=b.dataSource_url?b.dataSource_url:"",a.clubData_enable=b.clubData_enable?b.clubData_enable:f.clubData_enable,a.clubData_text=PykCharts.boolean(b.clubData_enable)&&b.clubData_text?b.clubData_text:f.clubData_text,a.clubData_maximumNodes=PykCharts.boolean(b.clubData_maximumNodes)&&b.clubData_maximumNodes?b.clubData_maximumNodes:f.clubData_maximumNodes,a.clubData_alwaysIncludeDataPoints=PykCharts.boolean(b.clubData_enable)&&b.clubData_alwaysIncludeDataPoints?b.clubData_alwaysIncludeDataPoints:[],a.transition_duration=b.transition_duration?b.transition_duration:e.transition_duration,a.pointer_overflow_enable=b.pointer_overflow_enable?b.pointer_overflow_enable:d.pointer_overflow_enable,a.bg=b.backgroundColor?b.backgroundColor:d.backgroundColor,a.chartColor=b.chartColor?b.chartColor:d.chartColor,a.highlightColor=b.highlightColor?b.highlightColor:d.highlightColor,a.fullscreen=b.buttons_enableFullScreen?b.buttons_enableFullScreen:d.buttons_enableFullScreen,a.loading=b.loading_animationGifUrl?b.loading_animationGifUrl:d.loading_animationGifUrl,a.tooltip_enable=b.tooltip_enable?b.tooltip_enable:d.tooltip_enable,a.borderBetweenChartElements_thickness="borderBetweenChartElements_thickness"in b?b.borderBetweenChartElements_thickness:d.borderBetweenChartElements_thickness,a.borderBetweenChartElements_color=b.borderBetweenChartElements_color?b.borderBetweenChartElements_color:d.borderBetweenChartElements_color,a.borderBetweenChartElements_style=b.borderBetweenChartElements_style?b.borderBetweenChartElements_style:d.borderBetweenChartElements_style,a.borderBetweenChartElements_style){case"dotted":a.borderBetweenChartElements_style="1,3";break;case"dashed":a.borderBetweenChartElements_style="5,5";break;default:a.borderBetweenChartElements_style="0"}return a.highlight=b.highlight?b.highlight:d.highlight,a.label_size="label_size"in b?b.label_size:d.label_size,a.label_color=b.label_color?b.label_color:d.label_color,a.label_weight=b.label_weight?b.label_weight:d.label_weight,a.label_family=b.label_family?b.label_family:d.label_family,a.pointer_thickness="pointer_thickness"in b?b.pointer_thickness:d.pointer_thickness,a.pointer_size="pointer_size"in b?b.pointer_size:d.pointer_size,a.pointer_color=b.pointer_color?b.pointer_color:d.pointer_color,a.pointer_family=b.pointer_family?b.pointer_family:d.pointer_family,a.showTotalAtTheCenter=b.donut_showTotalAtTheCenter?b.donut_showTotalAtTheCenter:f.donut_showTotalAtTheCenter,a.units_prefix=b.units_prefix?b.units_prefix:!1,a.units_suffix=b.units_suffix?b.units_suffix:!1,a.k=new PykCharts.Configuration(a),a},PykCharts.oneD.bubble=function(a){var b=this;this.execute=function(){b=PykCharts.oneD.processInputs(b,a),console.log("bubble"),"default"===b.mode&&b.k.loading(),d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove(),b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",b.render()})},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("oned"),b.refresh_data=c.groupBy("oned");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.new_data=b.optionalFeatures().clubData(),b.optionalFeatures().createChart().label()})},this.render=function(){b.fillChart=new PykCharts.Configuration.fillChart(b),b.onHoverEffect=new PykCharts.oneD.mouseEvent(b),b.transitions=new PykCharts.Configuration.transition(b),"default"===b.mode?(b.k.title(),b.k.subtitle(),b.new_data=b.optionalFeatures().clubData(),b.optionalFeatures().svgContainer().createChart().label(),b.k.createFooter().lastUpdatedAt().credits().dataSource().liveData(b).tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b)):"infographics"===b.mode&&(b.new_data={children:b.data},b.optionalFeatures().svgContainer().createChart().label(),b.k.tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b)),$(window).on("load",function(){return b.k.resize(b.svgContainer)}).on("resize",function(){return b.k.resize(b.svgContainer)})},this.optionalFeatures=function(){var c={svgContainer:function(){return $(b.selector).css("background-color",b.bg),b.svgContainer=d3.select(b.selector).append("svg").attr("class","svgcontainer").attr("id","svgcontainer").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height).attr("width",b.width).attr("height",b.height),b.group=b.svgContainer.append("g").attr("id","bubgrp"),this},createChart:function(){b.bubble=d3.layout.pack().sort(function(a,b){return b.weight-a.weight}).size([b.width,b.height]).value(function(a){return a.weight}).padding(20),b.sum=d3.sum(b.new_data.children,function(a){return a.weight});b.new_data.children.length;return b.node=b.bubble.nodes(b.new_data),b.chart_data=b.group.selectAll(".bubble-node").data(b.node),b.chart_data.enter().append("g").attr("class","bubble-node").append("circle"),b.chart_data.attr("class","bubble-node").select("circle").attr("class","bubble").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("r",0).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("fill",function(a){return a.children?b.bg:b.fillChart.selectColor(a)}).on("mouseover",function(c){c.children||(b.onHoverEffect.highlight(a.selector+" .bubble",this),c.tooltip=c.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+c.name+"</tr><tr><td class='tooltip-left-content'>"+b.k.appendUnits(c.weight)+"  <td class='tooltip-right-content'>(&nbsp;"+(100*c.weight/b.sum).toFixed(2)+"%&nbsp;)</tr></table>",b.mouseEvent.tooltipPosition(c),b.mouseEvent.toolTextShow(c.tooltip))}).on("mouseout",function(c){b.mouseEvent.tooltipHide(c),b.onHoverEffect.highlightHide(a.selector+" .bubble")}).on("mousemove",function(a){a.children||b.mouseEvent.tooltipPosition(a)}).transition().duration(b.transitions.duration()).attr("r",function(a){return a.r}),b.chart_data.exit().remove(),this},label:function(){return b.chart_text=b.group.selectAll(".name").data(b.node),b.chart_text1=b.group.selectAll(".weight").data(b.node),b.chart_text.enter().append("svg:text").attr("class","name"),b.chart_text1.enter().append("svg:text").attr("class","weight"),b.chart_text.attr("class","name").attr("x",function(a){return a.x}).attr("y",function(a){return a.y-5}),b.chart_text1.attr("class","weight").attr("x",function(a){return a.x}).attr("y",function(a){return a.y+10}),b.chart_text.attr("text-anchor","middle").style("font-weight",b.label_weight).style("font-size",b.label_size).attr("fill",b.label_color).style("font-family",b.label_family).text(""),setTimeout(function(){b.chart_text.text(function(a){return a.children?" ":a.name}).attr("pointer-events","none").text(function(a){return this.getBBox().width<2*a.r&&this.getBBox().height<2*a.r?a.children?" ":a.name:""})},b.transitions.duration()),b.chart_text1.attr("text-anchor","middle").style("font-weight",b.label_weight).style("font-size",b.label_size).attr("fill",b.label_color).style("font-family",b.label_family).text("").attr("pointer-events","none"),setTimeout(function(){b.chart_text1.text(function(a){return a.children?" ":b.k.appendUnits(a.weight)}).text(function(a){return this.getBBox().width<2*a.r*.55&&this.getBBox().height<2*a.r*.55?a.children?" ":(100*a.weight/b.sum).toFixed(2)+"%":""})},b.transitions.duration()),b.chart_text.exit().remove(),b.chart_text1.exit().remove(),this},clubData:function(){var a;if(PykCharts.boolean(b.clubData_enable)){var c,d,e=[],f=0,g=[];if(b.data.length<=b.clubData_maximumNodes)return a={children:b.data};if(0!==b.clubData_alwaysIncludeDataPoints.length){var h=b.clubData_alwaysIncludeDataPoints.length;for(d=0;h>d;d++)e[d]=b.clubData_alwaysIncludeDataPoints[d]}for(d=0;d<e.length;d++)for(c=0;c<b.data.length;c++)e[d].toUpperCase()===b.data[c].name.toUpperCase()&&g.push(b.data[d]);for(b.data.sort(function(a,b){return b.weight-a.weight});g.length<b.clubData_maximumNodes-1;){for(d=0;d<e.length;d++)b.data[f].name.toUpperCase()===e[d].toUpperCase()&&f++;g.push(b.data[f]),f++}var i=0;for(c=f;c<b.data.length;c++){for(d=0;d<g.length&&d<b.data.length;d++)b.data[c].name.toUpperCase()===g[d].name.toUpperCase()&&(i+=0,c++,d=-1);c<b.data.length&&(i+=b.data[c].weight)}for(var j=function(a,b){return b.weight-a.weight};g.length>b.clubData_maximumNodes;){g.sort(j);{g.pop()}}var k={name:b.clubData_text,weight:i,color:b.clubData_color,tooltip:b.clubData_tooltipText,highlight:!1};g.length<b.clubData_maximumNodes&&g.push(k),g.sort(function(a,b){return a.weight-b.weight}),a={children:g},b.map1=a.children.map(function(a){return a.weight})}else b.data.sort(function(a,b){return a.weight-b.weight}),a={children:b.data};return a}};return c}},PykCharts.oneD.funnel=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.oneD.processInputs(b,a);var d=(a.optional,c.oneDimensionalCharts);b.rect_width=a.funnel_rectWidth&&_.isNumber(a.funnel_rectWidth)?a.funnel_rectWidth:d.funnel_rectWidth,b.rect_height=a.funnel_rectHeight&&_.isNumber(a.funnel_rectHeight)?a.funnel_rectHeight:d.funnel_rectHeight,"default"===b.mode&&b.k.loading(),d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove(),b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",b.render()})},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("oned"),b.refresh_data=c.groupBy("oned");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.optionalFeatures().clubData().createChart().label().ticks()})},this.render=function(){var a=this;a.fillChart=new PykCharts.Configuration.fillChart(a),a.onHoverEffect=new PykCharts.oneD.mouseEvent(a),a.transitions=new PykCharts.Configuration.transition(a),a.border=new PykCharts.Configuration.border(a),"default"===a.mode&&a.k.title().subtitle(),a.k.tooltip(),a.mouseEvent=new PykCharts.Configuration.mouseEvent(a),"infographics"===a.mode&&(a.new_data=a.data),"default"===a.mode&&a.optionalFeatures().clubData(),a.optionalFeatures().svgContainer().createChart().label(),"default"===a.mode&&(a.optionalFeatures().ticks(),a.k.liveData(a).createFooter().lastUpdatedAt().credits().dataSource()),$(window).on("load",function(){return a.k.resize(a.svgContainer)}).on("resize",function(){return a.k.resize(a.svgContainer)})},this.funnelLayout=function(){var a,b,c,d=this,e={data:function(b){return 0===b.length||(a=b),this},size:function(a){return 2!==a.length||(b=a),this},mouth:function(a){return 2!==a.length||(c=a),this},coordinates:function(){function e(a){return d3.sum(q,function(b,c){return c>=a?b:void 0})}for(var f=b[0],g=b[1],h=c[0],i=c[1],j=(f-h)/2,k=g-i,l=0,m=0,n=0,o=0,p=[],q=d.percentageValues(a),r=j/k,s=(f+h)/2*k,t=h*i,u=s+t,v=t/u*100,w=a.length-1;w>=0;w--){var x=e(w);if(v>=x)n=x/v*i,l=g-n,p[w]=w===a.length-1?{values:[{x:(f-h)/2,y:l},{x:(f-h)/2,y:g},{x:(f-h)/2+h,y:g},{x:(f-h)/2+h,y:l}]}:{values:[{x:(f-h)/2,y:l},p[w+1].values[0],p[w+1].values[3],{x:(f-h)/2+h,y:l}]};else{var y;y=0===o?(x-v)/100*s:x/100*s;var z=2*r,A=2*h,B=2*y;m=(-A+Math.sqrt(Math.pow(A,2)-4*z*-B))/(2*z),l=g-m-i;var C=2*r*m+h,D=(f-C)/2;if(0===o)p[w]=w===a.length-1?{values:[{x:D,y:l},{x:(f-h)/2,y:k},{x:(f-h)/2,y:g},{x:(f-h)/2+h,y:g},{x:(f-h)/2+h,y:k},{x:C+D,y:l}]}:{values:[{x:D,y:l},{x:(f-h)/2,y:k},p[w+1].values[0],p[w+1].values[3],{x:(f-h)/2+h,y:k},{x:C+D,y:l}]};else{var E;E=6===p[w+1].values.length?5:3,p[w]={values:[{x:D,y:l},p[w+1].values[0],p[w+1].values[E],{x:C+D,y:l}]}}o=1}}return p}};return e},this.percentageValues=function(a){var b=this;b.sum=d3.sum(a,function(a){return a.weight});var c=a.map(function(a){return a.weight/b.sum*100});return c.sort(function(a,b){return b-a}),c},this.optionalFeatures=function(){var c={svgContainer:function(){return $(a.selector).css("background-color",b.bg),b.svgContainer=d3.select(a.selector).append("svg").attr("width",b.width).attr("height",b.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height).attr("id","svgcontainer").attr("class","svgcontainer"),b.group=b.svgContainer.append("g").attr("id","funnel"),this},createChart:function(){b.per_values=b.percentageValues(b.new_data),b.funnel=b.funnelLayout().data(b.new_data).size([b.width,b.height]).mouth([b.rect_width,b.rect_height]),b.coordinates=b.funnel.coordinates();var c=d3.svg.line().interpolate("linear-closed").x(function(a){return a.x}).y(function(a){return a.y});b.chart_data=b.group.selectAll(".fun-path").data(b.coordinates);var d=[{x:0,y:0},{x:b.width,y:0},{x:0,y:0},{x:b.width,y:0},{x:0,y:0},{x:b.width,y:0}];return b.chart_data.enter().append("path").attr("class","fun-path"),b.chart_data.attr("class","fun-path").attr("d",function(){return c(d)}).attr("fill",function(a,c){return b.fillChart.selectColor(b.new_data[c])}).attr("stroke",b.border.color()).attr("stroke-width",b.border.width()).attr("stroke-dasharray",b.border.style()).attr("stroke-opacity",1).on("mouseover",function(c,d){b.onHoverEffect.highlight(a.selector+" .fun-path",this),tooltip=b.new_data[d].tooltip||"<table class='PykCharts'><tr><th colspan='3' class='tooltip-heading'>"+b.new_data[d].name+"</tr><tr><td class='tooltip-left-content'>"+b.k.appendUnits(b.new_data[d].weight)+"<td class='tooltip-right-content'>(&nbsp; "+b.per_values[d].toFixed(2)+"%&nbsp) </tr></table>",b.mouseEvent.tooltipPosition(c),b.mouseEvent.toolTextShow(tooltip)}).on("mouseout",function(c){b.onHoverEffect.highlightHide(a.selector+" .fun-path"),b.mouseEvent.tooltipHide(c)}).on("mousemove",function(a){b.mouseEvent.tooltipPosition(a)}).transition().duration(b.transitions.duration()).attr("d",function(a){return c(a.values)}),b.chart_data.exit().remove(),this},label:function(){return b.chart_text=b.group.selectAll("text").data(b.coordinates),b.chart_text.enter().append("text"),b.chart_text.attr("y",function(a){return 4===a.values.length?(a.values[0].y-a.values[1].y)/2+a.values[1].y+5:(a.values[0].y-a.values[2].y)/2+a.values[2].y+5}).attr("x",function(){return b.width/2}),b.chart_text.text(""),setTimeout(function(){b.chart_text.text(function(a,c){return b.per_values[c].toFixed(2)+"%"}).attr("text-anchor","middle").attr("pointer-events","none").style("font-weight",b.label_weight).style("font-size",b.label_size).attr("fill",b.label_color).style("font-family",b.label_family).text(function(a,c){return this.getBBox().width<a.values[3].x-a.values[1].x&&this.getBBox().height<a.values[2].y-a.values[0].y?b.per_values[c].toFixed(2)+"%":""})},b.transitions.duration()),b.chart_text.exit().remove(),this},ticks:function(){PykCharts.boolean(b.pointer_overflow_enable)&&b.svgContainer.style("overflow","visible");var a=[],c=b.group.selectAll(".ticks_label").data(b.coordinates);c.attr("class","ticks_label"),c.enter().append("text").attr("x",0).attr("y",0);var d,e;c.attr("transform",function(a){return 4===a.values.length?(d=(a.values[3].x+a.values[2].x)/2+10,e=(a.values[0].y+a.values[2].y)/2+5):(d=a.values[4].x+10,e=a.values[4].y+5),"translate("+d+","+e+")"}),c.text(""),setTimeout(function(){c.text(function(a,c){return b.new_data[c].name}).text(function(c,d){return a[d]=this.getBBox().height,this.getBBox().height<c.values[2].y-c.values[0].y?b.new_data[d].name:""}).attr("font-size",b.pointer_size).attr("text-anchor","start").attr("fill",b.pointer_color).attr("pointer-events","none").attr("font-family",b.pointer_family)},b.transitions.duration()),c.exit().remove();var f=b.group.selectAll(".funnel-ticks").data(b.coordinates);return f.enter().append("line").attr("class","funnel-ticks"),f.attr("x1",function(a){return 4===a.values.length?(a.values[3].x+a.values[2].x)/2:a.values[4].x}).attr("y1",function(a){return 4===a.values.length?(a.values[0].y+a.values[2].y)/2:a.values[4].y}).attr("x2",function(a){return 4===a.values.length?(a.values[3].x+a.values[2].x)/2:a.values[4].x}).attr("y2",function(a){return 4===a.values.length?(a.values[0].y+a.values[2].y)/2:a.values[4].y}).attr("stroke-width",b.pointer_thickness).attr("stroke",b.pointer_color),setTimeout(function(){f.attr("x2",function(b,c){return b.values[2].y-b.values[0].y>a[c]?4===b.values.length?(b.values[3].x+b.values[2].x)/2+5:b.values[4].x+5:4===b.values.length?(b.values[3].x+b.values[2].x)/2:b.values[4].x})},b.transitions.duration()),f.exit().remove(),this},clubData:function(){if(PykCharts.boolean(b.clubData_enable)){var a=[];if(0!==b.clubData_alwaysIncludeDataPoints.length){var c=b.clubData_alwaysIncludeDataPoints.length;for(i=0;c>i;i++)a[i]=b.clubData_alwaysIncludeDataPoints[i]}var d=[];for(i=0;i<a.length;i++)for(j=0;j<b.data.length;j++)a[i].toUpperCase()===b.data[j].name.toUpperCase()&&d.push(b.data[j]);b.data.sort(function(a,b){return b.weight-a.weight});for(var e=0;d.length<b.clubData_maximumNodes-1;){for(i=0;i<a.length;i++)b.data[e].name.toUpperCase()===a[i].toUpperCase()&&e++;d.push(b.data[e]),e++}var f=0;for(j=e;j<b.data.length;j++){for(i=0;i<d.length&&j<b.data.length;i++)b.data[j].name.toUpperCase()===d[i].name.toUpperCase()&&(f+=0,j++,i=-1);j<b.data.length&&(f+=b.data[j].weight)}for(var g=function(a,b){return b.weight-a.weight};d.length>b.clubData_maximumNodes;){d.sort(g);{d.pop()}}var h={name:b.clubData_text,weight:f,color:b.clubData_color,tooltip:b.clubData_tooltip};d.length<b.clubData_maximumNodes&&d.push(h),d.sort(function(a,b){return b.weight-a.weight}),b.new_data=d}else b.data.sort(function(a,b){return b.weight-a.weight}),b.new_data=b.data;return this}};return c}},PykCharts.oneD.percentageColumn=function(a){{var b=this;new PykCharts.Configuration.Theme({})}this.execute=function(){var b=this;b=new PykCharts.oneD.processInputs(b,a,"percentageColumn"),"default"===b.mode&&b.k.loading(),d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove(),b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",b.render()})},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("oned"),b.refresh_data=c.groupBy("oned");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.optionalFeatures().clubData().createChart().label().ticks()})},this.render=function(){var b=this;b.fillChart=new PykCharts.Configuration.fillChart(b),b.onHoverEffect=new PykCharts.oneD.mouseEvent(a),b.transitions=new PykCharts.Configuration.transition(b),b.border=new PykCharts.Configuration.border(b),"default"===b.mode&&b.k.title().subtitle(),"infographics"===b.mode&&(b.new_data=b.data),b.k.tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),"default"===b.mode&&(percent_column=b.optionalFeatures().clubData()),b.optionalFeatures().svgContainer().createChart().label(),"default"===b.mode&&(b.optionalFeatures().ticks(),b.k.liveData(b).createFooter().lastUpdatedAt().credits().dataSource()),$(window).on("load",function(){return b.k.resize(b.svgContainer)}).on("resize",function(){return b.k.resize(b.svgContainer)})},this.optionalFeatures=function(){var c={createChart:function(){var a=b.new_data.map(function(a){return a.weight});a.sum=function(){for(var a=0,b=0;b<this.length;++b)a+=this[b];return a};var c=a.sum();return b.new_data.forEach(function(a,b){this[b].percentValue=100*a.weight/c},b.new_data),b.new_data.sort(function(a,b){return b.weight-a.weight}),b.chart_data=b.group.selectAll(".per-rect").data(b.new_data),b.chart_data.enter().append("rect").attr("class","per-rect"),b.chart_data.attr("x",b.width/3).attr("y",function(a,c){if(0===c)return 0;var d=0,e=b.new_data.slice(0,c);return e.forEach(function(a,b){d+=this[b].percentValue},e),d*b.height/100}).attr("width",b.width/4).attr("height",0).attr("fill",function(a){return b.fillChart.selectColor(a)}).attr("stroke",b.border.color()).attr("stroke-width",b.border.width()).attr("stroke-dasharray",b.border.style()).on("mouseover",function(a){a.tooltip=a.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+a.name+"</tr><tr><td class='tooltip-left-content'>"+b.k.appendUnits(a.weight)+"<td class='tooltip-right-content'>(&nbsp;"+a.percentValue.toFixed(2)+"%&nbsp)</tr></table>",b.onHoverEffect.highlight(".per-rect",this),b.mouseEvent.tooltipPosition(a),b.mouseEvent.toolTextShow(a.tooltip)}).on("mouseout",function(a){b.onHoverEffect.highlightHide(".per-rect"),b.mouseEvent.tooltipHide(a)}).on("mousemove",function(a){b.mouseEvent.tooltipPosition(a)}).transition().duration(b.transitions.duration()).attr("height",function(a){return a.percentValue*b.height/100}),b.chart_data.exit().remove(),this},svgContainer:function(){return $(a.selector).css("background-color",b.bg),b.svgContainer=d3.select(a.selector).append("svg").attr("width",b.width).attr("height",b.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height).attr("id","svgcontainer").attr("class","svgcontainer"),b.group=b.svgContainer.append("g").attr("id","funnel"),this},label:function(){b.chart_text=b.group.selectAll(".per-text").data(b.new_data);var a=0;return b.chart_text.enter().append("text").attr("class","per-text"),b.chart_text.attr("class","per-text").attr("x",b.width/3+b.width/8).attr("y",function(c,d){return a+=c.percentValue,0===d?(0+a*b.height/100)/2+5:((a-c.percentValue)*b.height/100+a*b.height/100)/2+5}),a=0,b.chart_text.text("").attr("fill",b.label_color).style("font-size",b.label_size).attr("text-anchor","middle").attr("pointer-events","none").style("font-weight",b.label_weight).style("font-family",b.label_family),setTimeout(function(){b.chart_text.text(function(a){return b.k.appendUnits(a.weight)}).text(function(a){return this.getBBox().width<b.width/4&&this.getBBox().height<a.percentValue*b.height/100?a.percentValue.toFixed(2)+"%":""})},b.transitions.duration()),b.chart_text.exit().remove(),this},ticks:function(){PykCharts.boolean(b.pointer_overflow_enable)&&b.svgContainer.style("overflow","visible");var a,c,d=0,e=0,f=[];d=0;var g=b.group.selectAll(".per-ticks").data(b.new_data);g.enter().append("line").attr("class","per-ticks");var h=b.group.selectAll(".ticks_label").data(b.new_data);return h.enter().append("text").attr("class","ticks_label"),h.attr("class","ticks_label").attr("transform",function(e){return d+=e.percentValue,a=b.width/3+b.width/4+10,c=((d-e.percentValue)*b.height/100+d*b.height/100)/2+5,"translate("+a+","+c+")"}),h.text(function(){return""}).attr("font-size",b.pointer_size).attr("text-anchor","start").attr("fill",b.pointer_color).attr("font-family",b.pointer_family).attr("pointer-events","none"),setTimeout(function(){h.text(function(a){return a.name}).text(function(a,c){return f[c]=this.getBBox().height,this.getBBox().height<a.percentValue*b.height/100?a.name:""}),d=0,g.attr("x1",function(){return b.width/3+b.width/4}).attr("y1",function(a,c){return d+=a.percentValue,0===c?(0+d*b.height/100)/2:((d-a.percentValue)*b.height/100+d*b.height/100)/2}).attr("x2",function(){return b.width/3+b.width/4}).attr("y2",function(a,c){return e+=a.percentValue,0===c?(0+e*b.height/100)/2:((e-a.percentValue)*b.height/100+e*b.height/100)/2}).attr("stroke-width",b.pointer_thickness).attr("stroke",b.pointer_color).attr("x2",function(a,c){return a.percentValue*b.height/100>f[c]?b.width/3+b.width/4+5:b.width/3+b.width/4})},b.transitions.duration()),h.exit().remove(),g.exit().remove(),this},clubData:function(){if(PykCharts.boolean(b.clubData_enable)){var a=[];if(0!==b.clubData_alwaysIncludeDataPoints.length){var c=b.clubData_alwaysIncludeDataPoints.length;for(i=0;c>i;i++)a[i]=b.clubData_alwaysIncludeDataPoints[i]}var d=[];for(i=0;i<a.length;i++)for(j=0;j<b.data.length;j++)a[i].toUpperCase()===b.data[j].name.toUpperCase()&&d.push(b.data[j]);b.data.sort(function(a,b){return b.weight-a.weight});for(var e=0;d.length<b.clubData_maximumNodes-1;){for(i=0;i<a.length;i++)b.data[e].name.toUpperCase()===a[i].toUpperCase()&&e++;d.push(b.data[e]),e++}var f=0;for(j=e;j<b.data.length;j++){for(i=0;i<d.length&&j<b.data.length;i++)b.data[j].name.toUpperCase()===d[i].name.toUpperCase()&&(f+=0,j++,i=-1);j<b.data.length&&(f+=b.data[j].weight)}for(var g=function(a,b){return b.weight-a.weight};d.length>b.clubData_maximumNodes;){d.sort(g);{d.pop()}}var h={name:b.clubData_text,weight:f,color:b.clubData_color,tooltip:b.clubData_tooltip};d.length<b.clubData_maximumNodes&&d.push(h),b.new_data=d}else b.data.sort(function(a,b){return b.weight-a.weight}),b.new_data=b.data;return this}};return c}},PykCharts.oneD.pictograph=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.oneD.processInputs(b,a);var d=(a.optional,c.oneDimensionalCharts);b.showTotal=a.pictograph_showTotal?a.pictograph_showTotal:d.pictograph_showTotal,b.enableTotal=a.pictograph_enableTotal?a.pictograph_enableTotal:d.pictograph_enableTotal,b.enableCurrent=a.pictograph_enableCurrent?a.pictograph_enableCurrent:d.pictograph_enableCurrent,b.imgperline=a.pictograph_imagePerLine?a.pictograph_imagePerLine:d.pictograph_imagePerLine,b.activeText_size=a.pictograph_activeText_size?a.pictograph_activeText_size:d.pictograph_activeText_size,b.activeText_color=a.pictograph_activeText_color?a.pictograph_activeText_color:d.pictograph_activeText_color,b.activeText_weight=a.pictograph_activeText_weight?a.pictograph_activeText_weight:d.pictograph_activeText_weight,b.activeText_family=a.pictograph_activeText_family?a.pictograph_activeText_family:d.pictograph_activeText_family,b.inactiveText_size=a.pictograph_inactiveText_size?a.pictograph_inactiveText_size:d.pictograph_inactiveText_size,b.inactiveText_color=a.pictograph_inactiveText_color?a.pictograph_inactiveText_color:d.pictograph_inactiveText_color,b.inactiveText_weight=a.pictograph_inactiveText_weight?a.pictograph_inactiveText_weight:d.pictograph_inactiveText_weight,b.inactiveText_family=a.pictograph_inactiveText_family?a.pictograph_inactiveText_family:d.pictograph_inactiveText_family,b.imageWidth=a.pictograph_imageWidth?a.pictograph_imageWidth:d.pictograph_imageWidth,b.imageHeight=a.pictograph_imageHeight?a.pictograph_imageHeight:d.pictograph_imageHeight,"default"===b.mode&&b.k.loading(),d3.json(a.data,function(c,d){b.data=d.sort(function(a,b){return b.weight-a.weight}),$(a.selector+" #chart-loader").remove(),b.render()})},this.render=function(){b.transitions=new PykCharts.Configuration.transition(b),"default"===b.mode&&(b.k.title(),b.k.subtitle()),b.optionalFeatures().svgContainer().createChart().labelText().enableLabel(),"default"===b.mode&&b.k.createFooter().credits().dataSource(),$(window).on("load",function(){return b.k.resize(b.svgContainer)}).on("resize",function(){return b.k.resize(b.svgContainer)})},this.optionalFeatures=function(){var c={svgContainer:function(){return $(a.selector).css("background-color",b.bg),b.svgContainer=d3.select(a.selector).append("svg").attr("width",b.width).attr("height",b.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height),b.group=b.svgContainer.append("g").attr("transform","translate("+b.imageWidth+",0)"),b.group1=b.svgContainer.append("g").attr("transform","translate(0,"+b.imageHeight+")"),this},createChart:function(){var a=1,c=1;b.optionalFeatures().showTotal();for(var d=0,e=1;e<=b.weight;e++)e<=b.data[1].weight?b.group.append("image").attr("xlink:href",b.data[1].image).attr("x",c*(b.imageWidth+1)).attr("y",a*(b.imageHeight+10)).attr("width",0).attr("height",b.imageHeight+"px").transition().duration(b.transitions.duration()).attr("width",b.imageWidth+"px"):b.group.append("image").attr("xlink:href",b.data[0].image).attr("x",c*(b.imageWidth+1)).attr("y",a*(b.imageHeight+10)).attr("width",0).attr("height",b.imageHeight+"px").transition().duration(b.transitions.duration()).attr("width",b.imageWidth+"px"),d++,c++,d>=b.imgperline&&(a++,c=1,d=0,b.group.append("text").html("<br><br>"));return this},showTotal:function(){return b.weight=PykCharts.boolean(b.showTotal)?b.data[0].weight:b.data[1].weight,this},enableLabel:function(){if(PykCharts.boolean(b.enableTotal)){var a;this.labelText(),b.group1.append("text").attr("font-family",b.inactiveText_family).attr("font-size",b.inactiveText_size).attr("fill",b.inactiveText_color).text("/"+b.data[0].weight).text(function(){return a=this.getBBox().height,"/"+b.data[0].weight}).attr("x",b.textWidth+5).attr("y",b.height/2-a)}return this},labelText:function(){if(PykCharts.boolean(b.enableCurrent)){var a;b.group1.append("text").attr("x",0).attr("font-family",b.activeText_family).attr("font-size",b.activeText_size).attr("fill",b.activeText_color).text(b.data[1].weight).text(function(){return a=this.getBBox().height,b.textWidth=this.getBBox().width,b.data[1].weight}).attr("y",b.height/2-a)}return this}};return c}},PykCharts.oneD.pie=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.oneD.processInputs(b,a,"pie"),b.radiusPercent=a.pie_radiusPercent&&_.isNumber(a.pie_radiusPercent)?a.pie_radiusPercent:c.oneDimensionalCharts.pie_radiusPercent,b.innerRadiusPercent=0,"default"===b.mode&&b.k.loading(),d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove();var e=new PykCharts.oneD.pieFunctions(a,b,"pie");b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",e.render()})}},PykCharts.oneD.donut=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.oneD.processInputs(b,a,"pie"),b.radiusPercent=a.donut_radiusPercent&&_.isNumber(a.donut_radiusPercent)?a.donut_radiusPercent:c.oneDimensionalCharts.donut_radiusPercent,b.innerRadiusPercent=a.donut_innerRadiusPercent&&_.isNumber(a.donut_innerRadiusPercent)?a.donut_innerRadiusPercent:c.oneDimensionalCharts.donut_innerRadiusPercent,d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove();var e=new PykCharts.oneD.pieFunctions(a,b,"donut");b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",e.render()
})}},PykCharts.oneD.election_pie=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.oneD.processInputs(b,a,"pie"),b.radiusPercent=a.pie_radiusPercent&&_.isNumber(a.pie_radiusPercent)?a.pie_radiusPercent:c.oneDimensionalCharts.pie_radiusPercent,b.innerRadiusPercent=0,d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove();var e=new PykCharts.oneD.pieFunctions(a,b,"election pie");b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",e.render()})}},PykCharts.oneD.election_donut=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.oneD.processInputs(b,a,"pie"),b.radiusPercent=a.donut_radiusPercent&&_.isNumber(a.donut_radiusPercent)?a.donut_radiusPercent:c.oneDimensionalCharts.donut_radiusPercent,b.innerRadiusPercent=a.donut_innerRadiusPercent&&_.isNumber(a.donut_innerRadiusPercent)&&a.donut_innerRadiusPercent?a.donut_innerRadiusPercent:c.oneDimensionalCharts.donut_innerRadiusPercent,d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove();var e=new PykCharts.oneD.pieFunctions(a,b,"election donut");b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",e.render()})}},PykCharts.oneD.pieFunctions=function(a,b,c){var d=b;d.refresh=function(){d3.json(a.data,function(a,b){d.data=b.groupBy("oned"),d.refresh_data=b.groupBy("oned");var c=d.k.checkChangeInData(d.refresh_data,d.compare_data);d.compare_data=c[0];var e=c[1];e&&d.k.lastUpdatedAt("liveData"),d.new_data=d.optionalFeatures().clubData(),d.optionalFeatures().createChart().label().ticks().centerLabel()})},this.render=function(){d.count=1,d.fillChart=new PykCharts.Configuration.fillChart(d),d.onHoverEffect=new PykCharts.oneD.mouseEvent(a),d.border=new PykCharts.Configuration.border(d),d.transitions=new PykCharts.Configuration.transition(d),"default"==d.mode.toLowerCase()?(d.k.title().subtitle(),d.optionalFeatures().svgContainer(),d.new_data=d.optionalFeatures().clubData(),d.k.createFooter().lastUpdatedAt().credits().dataSource().tooltip(),d.mouseEvent=new PykCharts.Configuration.mouseEvent(d),d.optionalFeatures().set_start_end_angle().createChart().label().ticks().centerLabel(),d.k.liveData(d)):"infographics"==d.mode.toLowerCase()&&(d.new_data=d.data,d.optionalFeatures().svgContainer().set_start_end_angle().createChart().label(),d.k.tooltip(),d.mouseEvent=new PykCharts.Configuration.mouseEvent(d)),$(window).on("load",function(){return d.k.resize(d.svgContainer)}).on("resize",function(){return d.k.resize(d.svgContainer)})},d.optionalFeatures=function(){var b={svgContainer:function(){return $(a.selector).css("background-color",d.bg),d.svgContainer=d3.select(d.selector).append("svg").attr("width",d.width).attr("height",d.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+d.width+" "+d.height).attr("id","container").attr("class","svgcontainer"),d.group=d.svgContainer.append("g").attr("transform","translate("+d.width/2+","+(d.k._radiusCalculation(d.radiusPercent)+20)+")").attr("id","pieGroup"),this},createChart:function(){if(d3.select(d.selector+" #pieGroup").node().innerHTML="","pie"==c.toLowerCase()||"donut"==c.toLowerCase()){d.new_data.sort(function(a,b){return a.weight-b.weight});var b=d.new_data.pop();d.new_data.unshift(b)}else("election pie"==c.toLowerCase()||"election donut"==c.toLowerCase())&&d.new_data.sort(function(a,b){return b.weight-a.weight});return d.sum=_.reduce(d.data,function(a,b){return a+b.weight},0),d.inner_radius=d.k._radiusCalculation(d.innerRadiusPercent),d.outer_radius=d.k._radiusCalculation(d.radiusPercent),d.arc=d3.svg.arc().innerRadius(d.inner_radius).outerRadius(d.outer_radius),d.pie=d3.layout.pie().value(function(a){return a.weight}).sort(null).startAngle(d.start_angle).endAngle(d.end_angle),d.chart_data=d.group.selectAll("path").data(d.pie(d.new_data)),d.chart_data.enter().append("path"),d.chart_data.attr("class","pie"),d.chart_data.attr("fill",function(a){return d.fillChart.selectColor(a.data)}).on("mouseover",function(b){b.data.tooltip=b.data.tooltip||"<table class='PykCharts'><tr><th colspan='3' class='tooltip-heading'>"+b.data.name+"</tr><tr><td class='tooltip-left-content'>"+d.k.appendUnits(b.data.weight)+"<td class='tooltip-right-content'>( "+(100*b.data.weight/d.sum).toFixed(2)+"% ) </tr></table>",d.onHoverEffect.highlight(a.selector+" .pie",this),d.mouseEvent.tooltipPosition(b),d.mouseEvent.toolTextShow(b.data.tooltip)}).on("mouseout",function(b){d.onHoverEffect.highlightHide(a.selector+" .pie"),d.mouseEvent.tooltipHide(b)}).on("mousemove",function(a){d.mouseEvent.tooltipPosition(a)}).attr("stroke",d.border.color()).attr("stroke-width",d.border.width()).attr("stroke-dasharray",d.border.style()),d.chart_data.transition().delay(function(a,b){return d.transition_duration&&"default"==d.mode?b*d.transition_duration/d.new_data.length:0}).duration(d.transitions.duration()/d.new_data.length).attrTween("d",function(a){var b=d3.interpolate(a.startAngle,a.endAngle);return function(c){return a.endAngle=b(c),d.arc(a)}}),d.chart_data.exit().remove(),this},label:function(){return d.chart_text=d.group.selectAll("text").data(d.pie(d.new_data)),d.chart_text.enter().append("text").attr("class","pie-label").attr("transform",function(a){return"translate("+d.arc.centroid(a)+")"}),d.chart_text.attr("transform",function(a){return"translate("+d.arc.centroid(a)+")"}),d.chart_text.text("").attr("fill","red"),setTimeout(function(){d.chart_text.text(function(a){return d.k.appendUnits(a.data.weight)}).attr("text-anchor","middle").attr("pointer-events","none").text(function(a){return"pie"===c.toLowerCase()||"election pie"===c.toLowerCase()?this.getBBox().width<(a.endAngle-a.startAngle)*(d.outer_radius/2)*.9?(100*a.data.weight/d.sum).toFixed(2)+"%":"":this.getBBox().width<Math.abs(a.endAngle-a.startAngle)*d.outer_radius*.9&&this.getBBox().height<.75*(d.outer_radius-d.inner_radius)?(100*a.data.weight/d.sum).toFixed(2)+"%":""}).attr("dy",5).style("font-weight",d.label_weight).style("font-size",d.label_size).attr("fill",d.label_color).style("font-family",d.label_family),d.chart_text.exit().remove()},d.transitions.duration()),this},clubData:function(){if(PykCharts.boolean(d.clubData_enable)){d.displayData=[],d.sorted_weight=_.map(d.data,function(a){return a.weight}),d.sorted_weight.sort(function(a,b){return b-a}),d.checkDuplicate=[];var a,b,c={name:d.clubData_text,color:d.clubData_color,tooltip:d.clubData_tooltipText,highlight:!1};d.getIndexByName=function(a){for(b=0;b<d.data.length;b++)if(d.data[b].name==a)return b};var e=function(a){var b=_.reject(d.sorted_weight,function(b){return b==d.data[a].weight});return b};if(0!==d.clubData_alwaysIncludeDataPoints.length)for(var f=0;f<d.clubData_alwaysIncludeDataPoints.length;f++)a=d.getIndexByName(d.clubData_alwaysIncludeDataPoints[f]),void 0!=a&&(d.displayData.push(d.data[a]),d.sorted_weight=e(a));d.getIndexByWeight=function(a){for(var b=0;b<d.data.length;b++)if(d.data[b].weight!=a);else if(_.contains(d.checkDuplicate,b)===!1)return d.checkDuplicate.push(b),b};var g=d.clubData_maximumNodes-d.displayData.length,h=d3.sum(d.sorted_weight,function(a,b){return b>=g-1?a:void 0});if(c.weight=h,g>0)for(d.displayData.push(c),b=0;g-1>b;b++)a=d.getIndexByWeight(d.sorted_weight[b]),d.displayData.push(d.data[a])}else d.displayData=d.data;return d.displayData},ticks:function(){PykCharts.boolean(d.pointer_overflow_enable)&&d.svgContainer.style("overflow","visible");var a=d.group.selectAll(".ticks_label").data(d.pie(d.new_data));a.attr("class","ticks_label"),a.enter().append("text").attr("x",0).attr("y",0);var b,c;a.attr("transform",function(a){return a.endAngle-a.startAngle<.2?(b=1*(d.outer_radius+30)*Math.cos((a.startAngle+a.endAngle-Math.PI)/2),c=1*(d.outer_radius/1+20)*Math.sin((a.startAngle+a.endAngle-Math.PI)/2)):(b=1*(d.outer_radius+22)*Math.cos((a.startAngle+a.endAngle-Math.PI)/2),c=1*(d.outer_radius/1+24)*Math.sin((a.startAngle+a.endAngle-Math.PI)/2)),"translate("+b+","+c+")"}),a.text(""),setTimeout(function(){a.text(function(a){return a.data.name}).attr("text-anchor",function(a){var b=(a.endAngle-a.startAngle)/2+a.startAngle;return b>0&&1.5>b?"start":b>=1.5&&3.5>b?"middle":b>=3.5&&6>b?"end":b>=6?"middle":0>b?"middle":void 0}).attr("dy",5).attr("pointer-events","none").style("fill",d.pointer_color).style("font-size",d.pointer_size).style("font-family",d.pointer_family),a.exit().remove()},d.transitions.duration());var e=d.group.selectAll("line").data(d.pie(d.new_data));return e.enter().append("line").attr("class","ticks"),e.attr("x1",function(a){return 1*d.outer_radius*Math.cos((a.startAngle+a.endAngle)/2)}).attr("y1",function(a){return 1*d.outer_radius*Math.sin((a.endAngle+a.startAngle)/2)}).attr("x2",function(a){return 1*d.outer_radius*Math.cos((a.startAngle+a.endAngle)/2)}).attr("y2",function(a){return 1*d.outer_radius*Math.sin((a.endAngle+a.startAngle)/2)}),setTimeout(function(){e.attr("x2",function(a){return 1*(d.outer_radius/1+12)*Math.cos((a.startAngle+a.endAngle)/2)}).attr("y2",function(a){return 1*(d.outer_radius/1+12)*Math.sin((a.startAngle+a.endAngle)/2)}).attr("transform","rotate(-90)").attr("stroke-width",d.pointer_thickness).attr("stroke",d.pointer_color),e.exit().remove()},d.transitions.duration()),this},centerLabel:function(){if(PykCharts.boolean(d.showTotalAtTheCenter)&&("donut"==c||"election donut"==c)){var b=d.group.selectAll(a.selector+" .centerLabel").data([d.sum]);b.enter().append("text"),b.attr("class","centerLabel").text("").transition().delay(function(){return PykCharts.boolean(d.transitions.duration())?d.transitions.duration():void 0}).text(function(){return d.k.appendUnits(d.sum)}).attr("pointer-events","none").attr("text-anchor","middle").attr("y",function(){return"donut"==c?.2*d.inner_radius:-.25*d.inner_radius}).attr("font-size",function(){return"donut"==c?.4*d.inner_radius:.2*d.inner_radius}).style("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("fill","#484848"),b.exit().remove()}return this},set_start_end_angle:function(){return d.startAngle,d.endAngle,"pie"==c||"donut"==c?(d.start_angle=0*(Math.PI/180),d.end_angle=360*(Math.PI/180)):("election pie"==c||"election donut"==c)&&(d.start_angle=-90*(Math.PI/180),d.end_angle=90*(Math.PI/180)),this}};return b}},PykCharts.oneD.pyramid=function(a){{var c=this;new PykCharts.Configuration.Theme({})}this.execute=function(){c=new PykCharts.oneD.processInputs(c,a,"pyramid"),"default"===c.mode&&c.k.loading(),d3.json(a.data,function(b,d){c.data=d.groupBy("oned"),c.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove(),c.clubData_enable=c.data.length>c.clubData_maximumNodes?c.clubData_enable:"no",c.render()})},this.refresh=function(){d3.json(a.data,function(a,b){c.data=b.groupBy("oned"),c.refresh_data=b.groupBy("oned");var d=c.k.checkChangeInData(c.refresh_data,c.compare_data);c.compare_data=d[0];var e=d[1];e&&c.k.lastUpdatedAt("liveData"),c.new_data=c.optionalFeatures().clubData(),c.optionalFeatures().createChart().label().ticks()})},this.render=function(){c.fillChart=new PykCharts.Configuration.fillChart(c),c.onHoverEffect=new PykCharts.oneD.mouseEvent(a),c.transitions=new PykCharts.Configuration.transition(c),c.border=new PykCharts.Configuration.border(c),"default"===c.mode?(c.k.title(),c.k.subtitle(),c.new_data=c.optionalFeatures().clubData(),c.optionalFeatures().svgContainer().createChart().label().ticks(),c.k.createFooter().lastUpdatedAt().credits().dataSource().tooltip().liveData(c),c.mouseEvent=new PykCharts.Configuration.mouseEvent(c)):"infographics"===c.mode&&(c.new_data=c.data,c.optionalFeatures().svgContainer().createChart().label(),c.k.tooltip(),c.mouseEvent=new PykCharts.Configuration.mouseEvent(c)),$(window).on("load",function(){return c.k.resize(c.svgContainer)}).on("resize",function(){return c.k.resize(c.svgContainer)})},this.percentageValues=function(a){c.sum=d3.sum(a,function(a){return a.weight});var b=a.map(function(a){return a.weight/c.sum*100});return b.sort(function(a,b){return b-a}),b},this.pyramidLayout=function(){var a,b,d={data:function(b){return 0===b.length||(a=b),this},size:function(a){return 2!==a.length||(b=a),this},coordinates:function(){function d(a){return d3.sum(h,function(b,c){return c>=a?b:void 0})}for(var e=b[0],f=b[1],g=e/2/f,h=c.percentageValues(a),i=[],j=e*f/2,k=0;k<a.length;k++){var l=d(k),m=l/100*j,n=Math.sqrt(m/g),o=2*g*n,p=(e-o)/2;i[k]=0===k?{values:[{x:e/2,y:0},{x:p,y:n},{x:o+p,y:n}]}:{values:[i[k-1].values[1],{x:p,y:n},{x:o+p,y:n},i[k-1].values[2]]}}return i}};return d},this.optionalFeatures=function(){var d={svgContainer:function(){return $(a.selector).css("background-color",c.bg),c.svgContainer=d3.select(a.selector).append("svg").attr("width",c.width).attr("height",c.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+c.width+" "+c.height).attr("id","svgcontainer").attr("class","svgcontainer"),c.group=c.svgContainer.append("g").attr("id","pyrgrp"),this},createChart:function(){c.pyramid=c.pyramidLayout().data(c.new_data).size([c.width,c.height]),c.coordinates=c.pyramid.coordinates(),c.coordinates[0].values[1]=c.coordinates[c.coordinates.length-1].values[1],c.coordinates[0].values[2]=c.coordinates[c.coordinates.length-1].values[2];var d=c.new_data.length-1,e=(c.new_data.length-1,[]);for(i=0;i<c.new_data.length;i++)0==i?e[i]=c.new_data[i].tooltip||"<table class='PykCharts'><tr><th colspan='3'  class='tooltip-heading'>"+c.new_data[i].name+"</tr><tr><td class='tooltip-left-content'>"+c.k.appendUnits(c.new_data[i].weight)+"<td class='tooltip-right-content'>( "+(100*c.new_data[i].weight/c.sum).toFixed(2)+"% ) </tr></table>":(e[i]=c.new_data[d].tooltip||"<table class='PykCharts'><tr><th colspan='3'  class='tooltip-heading'>"+c.new_data[d].name+"</tr><tr><td class='tooltip-left-content'>"+c.k.appendUnits(c.new_data[d].weight)+"<td class='tooltip-right-content'>( "+(100*c.new_data[d].weight/c.sum).toFixed(2)+"% ) </tr></table>",d--);var f=d3.svg.line().interpolate("linear-closed").x(function(a){return a.x}).y(function(a){return a.y}),g=[{x:0,y:c.height},{x:c.width,y:c.height},{x:0,y:c.height},{x:c.width,y:c.height},{x:0,y:c.height},{x:c.width,y:c.height}],d=c.new_data.length;return c.chart_data=c.group.selectAll(".pyr-path").data(c.coordinates),c.chart_data.enter().append("path"),c.chart_data.attr("class","pyr-path").attr("d",function(){return f(g)}).attr("stroke",c.border.color()).attr("stroke-width",c.border.width()).attr("stroke-dasharray",c.border.style()).attr("fill",function(a,e){return 0===e?b=c.new_data[e]:(d--,b=c.new_data[d]),c.fillChart.selectColor(b)}).on("mouseover",function(b,d){c.onHoverEffect.highlight(a.selector+" .pyr-path",this),c.mouseEvent.tooltipPosition(b),c.mouseEvent.toolTextShow(e[d])}).on("mouseout",function(b){c.onHoverEffect.highlightHide(a.selector+" .pyr-path"),c.mouseEvent.tooltipHide(b)}).on("mousemove",function(a){c.mouseEvent.tooltipPosition(a)}).transition().duration(c.transitions.duration()).attr("d",function(a){return f(a.values)}),c.chart_data.exit().remove(),this},label:function(){var a=c.new_data.length,b=c.new_data.length;return c.chart_text=c.group.selectAll("text").data(c.coordinates),c.chart_text.enter().append("text"),c.chart_text.attr("y",function(a){return 4===a.values.length?(a.values[0].y-a.values[1].y)/2+a.values[1].y+2:(a.values[0].y+c.coordinates[c.coordinates.length-1].values[1].y)/2+10}).attr("x",function(){return c.width/2}).text("").attr("text-anchor","middle").attr("pointer-events","none").style("font-weight",c.label_weight).style("font-size",c.label_size).attr("fill",c.label_color).style("font-family",c.label_family),setTimeout(function(){c.chart_text.text(function(b,d){return 0===d?(100*c.new_data[d].weight/c.sum).toFixed(2)+"%":(a--,(100*c.new_data[a].weight/c.sum).toFixed(2)+"%")}).text(function(a,d){return this.getBBox().width<a.values[2].x-a.values[1].x&&this.getBBox().height<Math.abs(a.values[1].y-a.values[0].y)?0===d?(100*c.new_data[d].weight/c.sum).toFixed(2)+"%":(b--,(100*c.new_data[b].weight/c.sum).toFixed(2)+"%"):""})},c.transitions.duration()),c.chart_text.exit().remove(),this},ticks:function(){PykCharts.boolean(c.pointer_overflow_enable)&&c.svgContainer.style("overflow","visible");var a=c.group.selectAll(".ticks_label").data(c.coordinates);a.enter().append("text").attr("x",0).attr("y",0).attr("class","ticks_label");var b,d,e=[],f=c.new_data.length,g=c.new_data.length;a.attr("transform",function(a){return b=3===a.values.length?(a.values[0].x+c.coordinates[c.coordinates.length-1].values[2].x)/2+30:(a.values[2].x+a.values[3].x)/2+30,d=4===a.values.length?(a.values[0].y-a.values[1].y)/2+a.values[1].y+2:(a.values[0].y+c.coordinates[c.coordinates.length-1].values[1].y)/2,"translate("+b+","+(d+5)+")"}),a.text(""),setTimeout(function(){a.text(function(a,b){return 0===b?c.new_data[b].name:(g--,c.new_data[g].name)}).text(function(a,b){return 0===b?(e[b]=this.getBBox().height,this.getBBox().height<a.values[1].y-a.values[0].y?c.new_data[b].name:""):(e[b]=this.getBBox().height,this.getBBox().height<a.values[0].y-a.values[1].y?(f--,c.new_data[f].name):"")}).style("fill",c.pointer_color).style("font-size",c.pointer_size).style("font-family",c.pointer_family).attr("text-anchor","start")},c.transitions.duration()),a.exit().remove();var h=c.group.selectAll(".pyr-ticks").data(c.coordinates);return h.enter().append("line").attr("class","pyr-ticks"),h.attr("x1",function(a){return 3===a.values.length?(a.values[0].x+c.coordinates[c.coordinates.length-1].values[2].x)/2:(a.values[2].x+a.values[3].x)/2}).attr("y1",function(a){return 4===a.values.length?(a.values[0].y-a.values[1].y)/2+a.values[1].y+2:(a.values[0].y+c.coordinates[c.coordinates.length-1].values[1].y)/2}).attr("x2",function(a){return 3===a.values.length?(a.values[0].x+c.coordinates[c.coordinates.length-1].values[2].x)/2:(a.values[2].x+a.values[3].x)/2}).attr("y2",function(a){return 4===a.values.length?(a.values[0].y-a.values[1].y)/2+a.values[1].y+2:(a.values[0].y+c.coordinates[c.coordinates.length-1].values[1].y)/2}).attr("stroke-width",c.pointer_thickness).attr("stroke",c.pointer_color),setTimeout(function(){h.attr("x2",function(a,b){return Math.abs(a.values[0].y-a.values[1].y)>e[b]?3===a.values.length?(a.values[0].x+c.coordinates[c.coordinates.length-1].values[2].x)/2+20:(a.values[2].x+a.values[3].x)/2+20:3===a.values.length?(a.values[0].x+c.coordinates[c.coordinates.length-1].values[2].x)/2:(a.values[2].x+a.values[3].x)/2})},c.transitions.duration()),h.exit().remove(),this},clubData:function(){if(PykCharts.boolean(c.clubData_enable)){c.displayData=[],c.sorted_weight=_.map(c.data,function(a){return a.weight}),c.sorted_weight.sort(function(a,b){return b-a}),c.checkDuplicate=[];var a,b,d={name:c.clubData_text,color:c.clubData_color,tooltip:c.clubData_tooltipText,highlight:!1};c.getIndexByName=function(a){for(b=0;b<c.data.length;b++)if(c.data[b].name==a)return b};var e=function(a){var b=_.reject(c.sorted_weight,function(b){return b==c.data[a].weight});return b};if(0!==c.clubData_alwaysIncludeDataPoints.length)for(var f=0;f<c.clubData_alwaysIncludeDataPoints.length;f++)a=c.getIndexByName(c.clubData_alwaysIncludeDataPoints[f]),void 0!=a&&(c.displayData.push(c.data[a]),c.sorted_weight=e(a));c.getIndexByWeight=function(a){for(var b=0;b<c.data.length;b++)if(c.data[b].weight!=a);else if(_.contains(c.checkDuplicate,b)===!1)return c.checkDuplicate.push(b),b};var g=c.clubData_maximumNodes-c.displayData.length;if(g>0)for(c.displayData.push(d),b=0;g-1>b;b++)a=c.getIndexByWeight(c.sorted_weight[b]),c.displayData.push(c.data[a]);var h=d3.sum(c.sorted_weight,function(a,b){return b>=g-1?a:void 0});d.weight=h}else c.displayData=c.data;return c.displayData.sort(function(a,b){return a.weight-b.weight}),c.displayData}};return d}},PykCharts.oneD.treemap=function(a){{var b=this;new PykCharts.Configuration.Theme({})}this.execute=function(){b=new PykCharts.oneD.processInputs(b,a),optional=a.optional,b.selector=a.selector,"default"===b.mode&&b.k.loading(),d3.json(a.data,function(c,d){b.data=d.groupBy("oned"),b.compare_data=d.groupBy("oned"),$(a.selector+" #chart-loader").remove(),b.clubData_enable=b.data.length>b.clubData_maximumNodes?b.clubData_enable:"no",b.render()})},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("oned"),b.refresh_data=c.groupBy("oned");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.optionalFeatures().clubData().createChart().label()})},this.render=function(){b.fillChart=new PykCharts.Configuration.fillChart(b),b.onHoverEffect=new PykCharts.oneD.mouseEvent(a),b.transitions=new PykCharts.Configuration.transition(b),b.border=new PykCharts.Configuration.border(b),"default"===b.mode&&(b.k.title(),b.k.subtitle()),b.k.tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),"infographics"===b.mode&&(b.new_data={children:b.data}),"default"===b.mode&&b.optionalFeatures().clubData(),b.optionalFeatures().svgContainer().createChart().label(),"default"===b.mode&&b.k.liveData(b).createFooter().lastUpdatedAt().credits().dataSource(),$(window).on("load",function(){return b.k.resize(b.svgContainer)}).on("resize",function(){return b.k.resize(b.svgContainer)})},this.optionalFeatures=function(){var c={svgContainer:function(){return $(a.selector).css("background-color",b.bg),b.svgContainer=d3.select(b.selector).append("svg:svg").attr("width",b.width).attr("height",b.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height).attr("id","svgcontainer").attr("class","svgcontainer"),b.group=b.svgContainer.append("g").attr("id","treemap"),this},createChart:function(){b.treemap=d3.layout.treemap().sort(function(a,b){return a.weight-b.weight}).size([b.width,b.height]).value(function(a){return a.weight}).sticky(!1),b.sum=d3.sum(b.new_data.children,function(a){return a.weight});var c;return b.node=b.treemap.nodes(b.new_data),c=b.new_data.children.length,b.chart_data=b.group.selectAll(".cell").data(b.node),b.chart_data.enter().append("svg:g").attr("class","cell").append("svg:rect").attr("class","treemap-rect"),b.chart_data.attr("class","cell").select("rect").attr("class","treemap-rect").attr("id",function(a,b){return b}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx-1}).attr("height",0).attr("fill",function(a){return a.children?"white":b.fillChart.selectColor(a)}).on("mouseover",function(c){c.children||(c.tooltip=c.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+c.name+"</tr><tr><td class='tooltip-left-content'>"+b.k.appendUnits(c.weight)+"<td class='tooltip-right-content'>(&nbsp;"+(100*c.weight/b.sum).toFixed(2)+"%&nbsp;)</tr></table>",b.onHoverEffect.highlight(a.selector+" .treemap-rect",this),b.mouseEvent.tooltipPosition(c),b.mouseEvent.toolTextShow(c.tooltip))}).on("mouseout",function(c){b.mouseEvent.tooltipHide(c),b.onHoverEffect.highlightHide(a.selector+" .treemap-rect")}).on("mousemove",function(a){a.children||b.mouseEvent.tooltipPosition(a)}).transition().duration(b.transitions.duration()).attr("height",function(a){return a.dy-1}),b.chart_data.exit().remove(),this},label:function(){return b.chart_text=b.group.selectAll(".name").data(b.node),b.chart_text1=b.group.selectAll(".weight").data(b.node),b.chart_text.enter().append("svg:text").attr("class","name"),b.chart_text1.enter().append("svg:text").attr("class","weight"),b.chart_text.attr("class","name").attr("x",function(a){return a.x+a.dx/2}).attr("y",function(a){return a.y+a.dy/2}),b.chart_text1.attr("class","weight").attr("x",function(a){return a.x+a.dx/2}).attr("y",function(a){return a.y+a.dy/2+15}),b.chart_text.attr("text-anchor","middle").style("font-weight",b.label_weight).style("font-size",b.label_size).attr("fill",b.label_color).style("font-family",b.label_family).text(""),setTimeout(function(){b.chart_text.text(function(a){return a.children?" ":a.name}).attr("pointer-events","none").text(function(a){return this.getBBox().width<a.dx&&this.getBBox().height<a.dy-15?a.children?" ":a.name:""})},b.transitions.duration()),b.chart_text1.attr("text-anchor","middle").style("font-weight",b.label_weight).style("font-size",b.label_size).attr("fill",b.label_color).style("font-family",b.label_family).text("").attr("pointer-events","none"),setTimeout(function(){b.chart_text1.text(function(a){return a.children?" ":b.k.appendUnits(a.weight)}).text(function(a){return this.getBBox().width<a.dx&&this.getBBox().height<a.dy-15?a.children?" ":(100*a.weight/b.sum).toFixed(2)+"%":""})},b.transitions.duration()),b.chart_text.exit().remove(),b.chart_text1.exit().remove(),this},clubData:function(){if(PykCharts.boolean(b.clubData_enable)){var a=[],c=0,d=0;if(b.data.length<=b.clubData_maximumNodes)return b.new_data={children:b.data},this;if(0!==b.clubData_alwaysIncludeDataPoints.length){var e=b.clubData_alwaysIncludeDataPoints.length;for(i=0;e>i;i++)a[i]=b.clubData_alwaysIncludeDataPoints[i]}var f=[];for(i=0;i<a.length;i++)for(j=0;j<b.data.length;j++)a[i].toUpperCase()===b.data[j].name.toUpperCase()&&f.push(b.data[j]);for(b.data.sort(function(a,b){return b.weight-a.weight});f.length<b.clubData_maximumNodes-1;){for(i=0;i<a.length;i++)b.data[d].name.toUpperCase()===a[i].toUpperCase()&&d++;f.push(b.data[d]),d++}for(j=d;j<b.data.length;j++){for(i=0;i<f.length&&j<b.data.length;i++)b.data[j].name.toUpperCase()===f[i].name.toUpperCase()&&(c+=0,j++,i=-1);j<b.data.length&&(c+=b.data[j].weight)}for(var g=function(a,b){return b.weight-a.weight};f.length>b.clubData_maximumNodes;){f.sort(g);{f.pop()}}var h={name:b.clubData_text,weight:c,color:b.clubData_color,tooltip:b.clubData_tooltip};f.length<b.clubData_maximumNodes&&f.push(h),b.new_data={children:f}}else b.new_data={children:b.data};return this}};return c}},PykCharts.multiD={};var theme=new PykCharts.Configuration.Theme({});PykCharts.multiD.configuration=function(a){var b=this,c=new PykCharts.Configuration.fillChart(a),d={magnify:function(a,b,c){b.on("mousemove",function(){var b=d3.mouse(this);c.focus(b[0]),a.attr("x",function(a){return c(a.x)}).attr("width",function(a){return c.rangeBand(a.x)})})},checkChangeInData:function(a,c){var d=Object.keys(c[0]),e=Object.keys(a[0]),f=!1;if(b.data=a.groupBy("oned"),d.length===e.length&&c.length===a.length){for(i=0;i<a.length;i++)for(j=0;j<d.length;j++)if(a[i][e[j]]!==c[i][d[j]]||d[j]!==e[j]){f=!0;break}}else f=!0;return b.compare_data=a,[b.compare_data,f]},opacity:function(b,c,d){if(PykCharts.boolean(a.size_enable))return.6;var e=d3.scale.linear().domain(d3.extent(d,function(a){return a.weight})).range([.1,1]);return e(b?b:_.min(c))},legendsPosition:function(a){return status?a.optionalFeatures().legendsContainer().svgContainer():a.optionalFeatures().svgContainer(),this},legends:function(d,e,f,g){if(status){var h=0,i=0;if(h=d.length,i=d.length,"vertical"===a.legends_display){g.attr("height",30*d.length+20),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,l=function(){return a.chart_width-75},m=function(){return a.chart_width-100};var j=function(a,b){return 24*b+12},k=function(a,b){return 24*b+26}}if("horizontal"===a.legends_display){g.attr("height",70),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y";var l=function(){return h--,a.chart_width-(100*h+75)};k=30,rect_parameter1value=13,rect_parameter2value=13;var m=function(){return i--,a.chart_width-(100*i+100)};j=18}b.legends_text=e.selectAll(".legends_text").data(d),b.legends_text.enter().append("text").attr("class","legends_text").attr("fill","#1D1D1D").attr("pointer-events","none").style("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif"),b.legends_text.attr("class","legends_text").attr("fill","black").attr(text_parameter1,l).attr(text_parameter2,k).text(function(a){return a}),b.legends_text.exit().remove(),b.legends_rect=e.selectAll(".legends_rect").data(d),b.legends_rect.enter().append("rect").attr("class","legends_rect"),b.legends_rect.attr("class","legends_rect").attr("fill",function(a,b){return c(f[b])}).attr("fill-opacity",function(b,c){return"yes"===a.saturation_enable?(c+1)/d.length:1}).attr(rect_parameter1,rect_parameter1value).attr(rect_parameter2,rect_parameter2value).attr(rect_parameter3,m).attr(rect_parameter4,j),b.legends_rect.exit().remove()}return this},legendsGroupStacked:function(b,c,d,e){if(status){var f,g,h,k=0,l=[];for(i=0;i<d.length;i++)for(j=0;j<d[i].length;j++)l[k]=d[i][j],k++;g=l.length,f=l.length,h=-1,b.attr("height",90);var m=c.selectAll(".legends_g").data(d).enter().append("g").attr("class","legends_g").attr("fill",function(){return h++,e[h]});m.selectAll(".legends_rect").data(d[h]).enter().append("rect").attr("class","legends_rect").attr("x",function(){return f--,a.chart_width-(80*f+75)}).attr("y",20).attr("height",13).attr("width",13).attr("fill-opacity",function(b,c){return"yes"===a.saturation_enable?(d[c].length-c)/d[c].length:1}),c.selectAll(".legends_text").data(l).enter().append("text").attr("class","legends_text").attr("pointer-events","none").attr("x",function(){return g--,a.chart_width-(80*g+55)}).attr("y",32).attr("fill","#1D1D1D").attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").text(function(a){return a})}return this},mapGroup:function(b){var c=[],d={},e=0,f=!0,g=!0;if(b.forEach(function(b){b.group?f=!0:(f=!1,b.color?(f=!1,b.color=b.color):a.color?(g=!1,b.color=a.color[0]):(g=!1,b.color=a.colorPalette[0]))}),f){b.forEach(function(b){d[b.group]||(b.color?b.color=b.color:a.color?(b.color=a.color[e],e++):(b.color=a.colorPalette[e],e++),c.push(b),d[b.group]=b)});var h=[],i={};e=0,c.forEach(function(b){i[b.color]?(b.color=a.colorPalette[e],e++,h.push(b),i[b.color]=b):(h.push(b),i[b.color]=b)});for(var j=h.length,k=b.length,l=0;j>l;l++)for(var m=0;k>m;m++)b[m].group===h[l].group&&(b[m].color=h[l].color);return[h,f]}return[b,f]}};return d},PykCharts.multiD.mouseEvent=function(){var a={highlight:function(a,b){var c=d3.select(b);return d3.selectAll(a).attr("opacity",.5),c.attr("opacity",1),this},highlightHide:function(a){return d3.selectAll(a).attr("opacity",1),this}};return a},PykCharts.multiD.bubbleSizeCalculation=function(a,b,c){var d=function(d){if(d&&PykCharts.boolean(a.size_enable)){var e=d3.scale.linear().domain(d3.extent(b,function(a){return a.weight})).range(c);return e(d)}return a.bubbleRadius};return d},PykCharts.multiD.processInputs=function(a,b){{var c=new PykCharts.Configuration.Theme({}),d=c.stylesheet,e=c.functionality,f=c.multiDimensionalCharts;b.optional}switch(a.yAxisDataFormat=b.yAxisDataFormat?b.yAxisDataFormat:f.yAxisDataFormat,a.xAxisDataFormat=b.xAxisDataFormat?b.xAxisDataFormat:f.xAxisDataFormat,a.selector=b.selector?b.selector:"body",a.width=b.chart_width&&_.isNumber(b.chart_width)?b.chart_width:d.chart_width,a.height=b.chart_height&&_.isNumber(b.chart_height)?b.chart_height:d.chart_height,a.margin_left=b.chart_margin_left&&_.isNumber(b.chart_margin_left)?b.chart_margin_left:d.chart_margin_left,a.margin_right=b.chart_margin_left&&_.isNumber(b.chart_margin_right)?b.chart_margin_right:d.chart_margin_right,a.margin_top=b.chart_margin_top&&_.isNumber(b.chart_margin_top)?b.chart_margin_top:d.chart_margin_top,a.margin_bottom=b.chart_margin_bottom&&_.isNumber(b.chart_margin_bottom)?b.chart_margin_bottom:d.chart_margin_bottom,a.grid_xEnabled=b.chart_grid_xEnabled?b.chart_grid_xEnabled:d.chart_grid_xEnabled,a.grid_yEnabled=b.chart_grid_yEnabled?b.chart_grid_yEnabled:d.chart_grid_yEnabled,a.grid_color=b.chart_grid_color?b.chart_grid_color:d.chart_grid_color,a.mode=b.mode?b.mode:"default",a.color_mode=b.color_mode?b.color_mode:f.color_mode,a.color=b.color?b.color:f.color,b&&PykCharts.boolean(b.title_text)?(a.title_text=b.title_text,a.title_size="title_size"in b?b.title_size:d.title_size,a.title_color=b.title_color?b.title_color:d.title_color,a.title_weight=b.title_weight?b.title_weight:d.title_weight,a.title_family=b.title_family?b.title_family:d.title_family):(a.title_size=d.title_size,a.title_color=d.title_color,a.title_weight=d.title_weight,a.title_family=d.title_family),b&&PykCharts.boolean(b.subtitle_text)?(a.subtitle_text=b.subtitle_text,a.subtitle_size="subtitle_size"in b?b.subtitle_size:d.subtitle_size,a.subtitle_color=b.subtitle_color?b.subtitle_color:d.subtitle_color,a.subtitle_weight=b.subtitle_weight?b.subtitle_weight:d.subtitle_weight,a.subtitle_family=b.subtitle_family?b.subtitle_family:d.subtitle_family):(a.subtitle_size=d.subtitle_size,a.subtitle_color=d.subtitle_color,a.subtitle_weight=d.subtitle_weight,a.subtitle_family=d.subtitle_family),a.axis_onHoverHighlightenable=PykCharts.boolean(b.axis_x_enable)&&b.axis_onHoverHighlightenable?b.axis_onHoverHighlightenable:f.axis_onHoverHighlightenable,a.axis_x_enable=b.axis_x_enable?b.axis_x_enable:f.axis_x_enable,a.axis_x_title=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_title?b.axis_x_title:f.axis_x_title,a.axis_x_value_position=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_value_position?b.axis_x_value_position:f.axis_x_value_position,a.axis_x_position=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_position?b.axis_x_position:f.axis_x_position,a.axis_x_axisColor=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_axisColor?b.axis_x_axisColor:f.axis_x_axisColor,a.axis_x_labelColor=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_labelColor?b.axis_x_labelColor:f.axis_x_labelColor,a.axis_x_no_of_axis_value=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_no_of_axis_value?b.axis_x_no_of_axis_value:f.axis_x_no_of_axis_value,a.axis_x_pointer_padding=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_pointer_padding?b.axis_x_pointer_padding:f.axis_x_pointer_padding,a.axis_x_pointer_size="axis_x_pointer_size"in b&&PykCharts.boolean(b.axis_x_enable)?b.axis_x_pointer_size:f.axis_x_pointer_size,a.axis_x_value_format=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_value_format?b.axis_x_value_format:f.axis_x_value_format,a.axis_x_pointer_values=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_pointer_values?b.axis_x_pointer_values:f.axis_x_pointer_values,a.axis_x_outer_pointer_size="axis_x_outer_pointer_size"in b&&PykCharts.boolean(b.axis_x_enable)?b.axis_x_outer_pointer_size:f.axis_x_outer_pointer_size,a.axis_x_time_value_datatype=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_time_value_datatype?b.axis_x_time_value_datatype:f.axis_x_time_value_datatype,a.axis_x_time_value_interval=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_time_value_interval?b.axis_x_time_value_interval:f.axis_x_time_value_interval,a.axis_y_enable=b.axis_y_enable?b.axis_y_enable:f.axis_y_enable,a.axis_y_title=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_title?b.axis_y_title:f.axis_y_title,a.axis_y_value_position=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_value_position?b.axis_y_value_position:f.axis_y_value_position,a.axis_y_position=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_position?b.axis_y_position:f.axis_y_position,a.axis_y_axisColor=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_axisColor?b.axis_y_axisColor:f.axis_y_axisColor,a.axis_y_labelColor=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_labelColor?b.axis_y_labelColor:f.axis_y_labelColor,a.axis_y_no_of_axis_value=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_no_of_axis_value?b.axis_y_no_of_axis_value:f.axis_y_no_of_axis_value,a.axis_y_pointer_padding=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_pointer_padding?b.axis_y_pointer_padding:f.axis_y_pointer_padding,a.axis_y_pointer_size="axis_y_pointer_size"in b&&PykCharts.boolean(b.axis_y_enable)?b.axis_y_pointer_size:f.axis_y_pointer_size,a.axis_y_value_format=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_value_format?b.axis_y_value_format:f.axis_y_value_format,a.axis_y_pointer_values=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_pointer_values?b.axis_y_pointer_values:f.axis_y_pointer_values,a.axis_y_outer_pointer_size="axis_y_outer_pointer_size"in b&&PykCharts.boolean(b.axis_y_enable)?b.axis_y_outer_pointer_size:f.axis_y_outer_pointer_size,a.axis_y_time_value_datatype=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_time_value_datatype?b.axis_y_time_value_datatype:f.axis_y_time_value_datatype,a.axis_y_time_value_interval=PykCharts.boolean(b.axis_y_enable)&&b.axis_y_time_value_interval?b.axis_y_time_value_interval:f.axis_y_time_value_interval,a.legends_enable=b.legends_enable?b.legends_enable:f.legends_enable,a.legends_display=b.legends_display?b.legends_display:f.legends_display,a.creditMySite_name=b.creditMySite_name?b.creditMySite_name:d.creditMySite_name,a.creditMySite_url=b.creditMySite_url?b.creditMySite_url:d.creditMySite_url,a.dataSource_name=b.dataSource_name?b.dataSource_name:"",a.dataSource_url=b.dataSource_url?b.dataSource_url:"",a.bg=b.backgroundColor?b.backgroundColor:d.backgroundColor,a.chartColor=b.chartColor?b.chartColor:d.chartColor,a.highlightColor=b.highlightColor?b.highlightColor:d.highlightColor,a.fullscreen=b.buttons_enableFullScreen?b.buttons_enableFullScreen:d.buttons_enableFullScreen,a.loading=b.loading_animationGifUrl?b.loading_animationGifUrl:d.loading_animationGifUrl,a.realTimeCharts_refreshFrequency=b.realTimeCharts_refreshFrequency?b.realTimeCharts_refreshFrequency:e.realTimeCharts_refreshFrequency,a.realTimeCharts_enableLastUpdatedAt=b.realTimeCharts_enableLastUpdatedAt?b.realTimeCharts_enableLastUpdatedAt:e.realTimeCharts_enableLastUpdatedAt,a.transition_duration=b.transition_duration?b.transition_duration:e.transition_duration,a.saturationEnable=b.saturation_enable?b.saturation_enable:"no",a.saturationColor=b.saturationColor?b.saturationColor:d.saturationColor,a.borderBetweenChartElements_thickness="borderBetweenChartElements_thickness"in b?b.borderBetweenChartElements_thickness:d.borderBetweenChartElements_thickness,a.borderBetweenChartElements_color=b.borderBetweenChartElements_color?b.borderBetweenChartElements_color:d.borderBetweenChartElements_color,a.borderBetweenChartElements_style=b.borderBetweenChartElements_style?b.borderBetweenChartElements_style:d.borderBetweenChartElements_style,a.borderBetweenChartElements_style){case"dotted":a.borderBetweenChartElements_style="1,3";
break;case"dashed":a.borderBetweenChartElements_style="5,5";break;default:a.borderBetweenChartElements_style="0"}return a.pointer_thickness="pointer_thickness"in b?b.pointer_thickness:d.pointer_thickness,a.pointer_size="pointer_size"in b?b.pointer_size:d.pointer_size,a.pointer_color=b.pointer_color?b.pointer_color:d.pointer_color,a.pointer_family=b.pointer_family?b.pointer_family:d.pointer_family,a.pointer_weight="thick"===a.pointer_weight?"bold":"normal",a.zoom_enable=b.zoom_enable?b.zoom_enable:f.zoom_enable,a.label_size="label_size"in b?b.label_size:d.label_size,a.label_color=b.label_color?b.label_color:d.label_color,a.label_weight=b.label_weight?b.label_weight:d.label_weight,a.label_weight="thick"===a.label_weight?"bold":"normal",a.label_family=b.label_family?b.label_family:d.label_family,a.tooltip_enable=b.tooltip_enable?b.tooltip_enable:f.tooltip_enable,a.tooltip_mode=b.tooltip_mode?b.tooltip_mode:f.tooltipmode,a.legendsText_size=b.legendsText_size?b.legendsText_size:d.legendsText_size,a.legendsText_color=b.legendsText_color?b.legendsText_color:d.legendsText_color,a.legendsText_weight=b.legendsText_weight?b.legendsText_weight:d.legendsText_weight,a.legendsText_weight="thick"===a.legendsText_weight?"bold":"normal",a.legendsText_family=b.legendsText_family?b.legendsText_family:d.legendsText_family,a.highlight=b.highlight?b.highlight:d.highlight,a.size_enable=b.size_enable?b.size_enable:f.size_enable,a.units=b.units?b.units:!1,a.multiple_containers_enable=b.multiple_containers_enable?b.multiple_containers_enable:f.multiple_containers_enable,a.colorPalette=["#b2df8a","#1f78b4","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928","#a6cee3"],a.k=new PykCharts.Configuration(a),a},PykCharts.multiD.lineChart=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.multiD.processInputs(b,a,"line"),"default"===b.mode&&b.k.loading();{var d=c.multiDimensionalCharts;c.stylesheet,a.optional}b.enableCrossHair=a.enableCrossHair?a.enableCrossHair:d.enableCrossHair,b.curvy_lines=a.line_curvy_lines?a.line_curvy_lines:d.line_curvy_lines,b.interpolate=PykCharts.boolean(b.curvy_lines)?"cardinal":"linear",b.color_from_data=a.line_color_from_data?a.line_color_from_data:d.line_color_from_data,d3.json(a.data,function(c,d){b.data=d.groupBy("line"),b.yAxisDataFormat=a.yAxisDataFormat?a.yAxisDataFormat:b.k.yAxisDataFormatIdentification(b.data),b.xAxisDataFormat=a.xAxisDataFormat?a.xAxisDataFormat:b.k.xAxisDataFormatIdentification(b.data),b.compare_data=b.data,b.data_length=b.data.length,b.dataTransformation(),$(b.selector+" #chart-loader").remove(),b.render()})},this.dataTransformation=function(){for(b.group_arr=[],b.color_arr=[],b.new_data=[],b.ticks=[],j=0;j<b.data_length;j++)b.group_arr[j]=b.data[j].name,b.data[j].color?b.data[j].color?b.color_arr[j]=b.data[j].color:b.hover=!0:b.color_arr[j]=b.color[j];b.uniq_group_arr=b.group_arr.slice(),b.uniq_color_arr=b.color_arr.slice(),$.unique(b.uniq_group_arr),$.unique(b.uniq_color_arr);var a=b.uniq_group_arr.length;if(PykCharts.boolean(b.group_arr[0]))for(k=0;a>k;k++)for(b.new_data[k]={name:b.uniq_group_arr[k],data:[],color:b.uniq_color_arr[k]},l=0;l<b.data_length;l++)b.uniq_group_arr[k]===b.data[l].name&&b.new_data[k].data.push({x:b.data[l].x,y:b.data[l].y,tooltip:b.data[l].tooltip,annotation:b.data[l].annotations||""});else for(b.new_data[0]={name:b.data[0].name||"",data:[]},l=0;l<b.data_length;l++)b.new_data[0].data.push({x:b.data[l].x,y:b.data[l].y,tooltip:b.data[l].tooltip,annotation:b.data[l].annotations||""});b.new_data_length=b.new_data.length},this.render=function(){if(b.dataLineGroup=[],b.clicked,b.multid=new PykCharts.multiD.configuration(b),b.fillColor=new PykCharts.Configuration.fillChart(b,null,a),"default"===b.mode){if(b.transitions=new PykCharts.Configuration.transition(a),b.k.title().subtitle(),PykCharts.boolean(b.multiple_containers_enable)){for(b.w=b.width/3,b.height=b.height/2,b.reducedWidth=b.w-b.margin_left-b.margin_right,b.reducedHeight=b.height-b.margin_top-b.margin_bottom,b.fill_data=[],i=0;i<b.new_data_length;i++)b.k.liveData(b).makeMainDiv(b.selector,i).tooltip(!0,b.selector,i),b.new_data1=b.new_data[i],b.fill_data[0]=b.new_data1,b.optionalFeature().chartType().svgContainer(i),b.k.crossHair(b.svgContainer,1,b.fill_data,b.fillColor),b.optionalFeature().createChart(null,i).ticks(i).axisContainer(),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain).yGrid(b.svgContainer,b.group,b.yScale).xGrid(b.svgContainer,b.group,b.xScale).xAxisTitle(b.xGroup).yAxisTitle(b.yGroup),(i+1)%4===0&&0!==i&&b.k.emptyDiv();b.k.emptyDiv()}else b.w=b.width,b.reducedWidth=b.w-b.margin_left-b.margin_right,b.reducedHeight=b.height-b.margin_top-b.margin_bottom,b.k.liveData(b).makeMainDiv(b.selector,1).tooltip(!0,b.selector,1),b.optionalFeature().chartType().svgContainer(1).hightLightOnload(),b.k.crossHair(b.svgContainer,b.new_data_length,b.new_data,b.fillColor),b.optionalFeature().createChart().ticks().axisContainer(),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain).yGrid(b.svgContainer,b.group,b.yScale).xGrid(b.svgContainer,b.group,b.xScale).xAxisTitle(b.xGroup).yAxisTitle(b.yGroup);b.k.createFooter().lastUpdatedAt().credits().dataSource(),b.annotation()}else"infographics"===b.mode&&(b.w=b.width,b.reducedWidth=b.w-b.margin_left-b.margin_right,b.reducedHeight=b.height-b.margin_top-b.margin_bottom,b.k.liveData(b).makeMainDiv(b.selector,1),b.optionalFeature().chartType().svgContainer(1).createChart().axisContainer(),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain));PykCharts.boolean(b.multiple_containers_enable)?$(window).on("load",function(){return b.annotation()}).on("resize",function(){return b.annotation()}):$(window).on("load",function(){return b.k.resize(b.svgContainer,"yes")}).on("resize",function(){return b.k.resize(b.svgContainer,"yes")}),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b)},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("line"),b.data_length=b.data.length;var d=b.multid.checkChangeInData(b.data,b.compare_data);b.compare_data=d[0];var e=d[1];b.dataTransformation(),e&&(b.k.lastUpdatedAt("liveData"),b.mouseEvent.tooltipHide(null,b.multiple_containers_enable,b.type),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis")),b.optionalFeature().hightLightOnload().createChart("livedata"),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain).yGrid(b.svgContainer,b.group,b.yScale).xGrid(b.svgContainer,b.group,b.xScale),b.annotation()})},this.optionalFeature=function(){var c={chartType:function(){for(j=0;j<b.data_length;j++)for(k=j+1;k<b.data_length;k++)if(b.data[j].x===b.data[k].x){b.type="multilineChart";break}return b.type=b.type||"lineChart",this},hightLightOnload:function(){if("multilineChart"===b.type&&b.new_data_length>0&&b.highlight)for(var a=0;a<b.uniq_group_arr.length;a++)b.new_data[a].highlight=b.highlight.toLowerCase()===b.uniq_group_arr[a].toLowerCase()?!0:!1;return this},svgContainer:function(a){return"multilineChart"===b.type?$(b.selector).attr("class","PykCharts-twoD PykCharts-line-chart PykCharts-multi-series2D"):"lineChart"===b.type&&$(b.selector).attr("class","PykCharts-twoD PykCharts-line-chart"),$(b.selector).css({"background-color":b.bg,position:"relative"}),b.svgContainer=d3.select(b.selector+" #tooltip-svg-container-"+a).append("svg:svg").attr("id","svg-"+a).attr("width",b.w).attr("height",b.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.w+" "+b.height),b.group=b.svgContainer.append("g").attr("id","chartsvg").attr("transform","translate("+b.margin_left+","+b.margin_top+")"),PykCharts.boolean(b.grid_yEnabled)&&b.group.append("g").attr("id","ygrid").attr("class","y grid-line"),PykCharts.boolean(b.grid_xEnabled)&&b.group.append("g").attr("id","xgrid").attr("class","x grid-line"),b.clip=b.svgContainer.append("svg:clipPath").attr("id","clip"+a+b.selector).append("svg:rect").attr("width",b.reducedWidth).attr("height",b.reducedHeight),b.chartBody=b.svgContainer.append("g").attr("id","clipPath").attr("clip-path","url(#clip"+a+b.selector+")").attr("transform","translate("+b.margin_left+","+b.margin_top+")"),this},axisContainer:function(){return PykCharts.boolean(b.axis_x_enable)&&(b.xGroup=b.group.append("g").attr("id","xaxis").attr("class","x axis")),PykCharts.boolean(b.axis_y_enable)&&(b.yGroup=b.group.append("g").attr("id","yaxis").attr("class","y axis")),this},createChart:function(c,d){function e(a){b.dataLineGroup[0].transition().duration(b.transitions.duration()).attrTween("d",function(){var c=d3.scale.quantile().domain([0,1]).range(d3.range(1,b.new_data[a].data.length+1));return function(d){return b.chart_path(b.new_data[a].data.slice(0,c(d)))}})}var f,g,h,i,k,l=[];if("number"===b.yAxisDataFormat?(max=d3.max(b.new_data,function(a){return d3.max(a.data,function(a){return a.y})}),min=d3.min(b.new_data,function(a){return d3.min(a.data,function(a){return a.y})}),k=[min,max],g=b.k._domainBandwidth(k,2),h=[b.reducedHeight,0],b.yScale=b.k.scaleIdentification("linear",g,h)):"string"===b.yAxisDataFormat?(b.new_data[0].data.forEach(function(a){g.push(a.y)}),h=[0,b.reducedHeight],b.yScale=b.k.scaleIdentification("ordinal",g,h,0)):"time"===b.yAxisDataFormat&&(g=d3.extent(b.data,function(a){return new Date(a.x)}),h=[b.reducedHeight,0],b.yScale=b.k.scaleIdentification("time",g,h)),b.xdomain=[],"number"===b.xAxisDataFormat)max=d3.max(b.new_data,function(a){return d3.max(a.data,function(a){return a.x})}),min=d3.min(b.new_data,function(a){return d3.min(a.data,function(a){return a.x})}),f=[min,max],l=b.k._domainBandwidth(f,2),i=[0,b.reducedWidth],b.xScale=b.k.scaleIdentification("linear",l,i),b.extra_left_margin=0,b.ydomain=b.yScale.domain();else if("string"===b.xAxisDataFormat)b.new_data[0].data.forEach(function(a){l.push(a.x)}),i=[0,b.reducedWidth],b.xScale=b.k.scaleIdentification("ordinal",l,i,0),b.extra_left_margin=b.xScale.rangeBand()/2,b.xdomain=b.xScale.domain();else if("time"===b.xAxisDataFormat){for(max=d3.max(b.new_data,function(a){return d3.max(a.data,function(a){return new Date(a.x)})}),min=d3.min(b.new_data,function(a){return d3.min(a.data,function(a){return new Date(a.x)})}),l=[min,max],i=[0,b.reducedWidth],b.xScale=b.k.scaleIdentification("time",l,i),m=0;m<b.new_data_length;m++)b.new_data[m].data.forEach(function(a){a.x=new Date(a.x)}),b.data.forEach(function(a){a.x=new Date(a.x),b.xdomain.push(a.x)});b.extra_left_margin=0}if(b.cnt=0,b.zoom_event=d3.behavior.zoom(),"string"!==b.yAxisDataFormat&&"string"!==b.xAxisDataFormat?b.zoom_event.x(b.xScale).y(b.yScale).scaleExtent([1,4]).on("zoom",b.zoomed):b.zoom_event.y(b.yScale).scaleExtent([1,4]).on("zoom",b.zoomed),PykCharts.boolean(b.zoom_enable)&&"default"===b.mode)for(PykCharts.boolean(b.multiple_containers_enable)?(n=b.new_data_length,j=0):(n=2,j=1),m=j;n>m;m++)d3.selectAll(b.selector+" #svg-"+m).call(b.zoom_event),d3.selectAll(b.selector+" #svg-"+m).on("wheel.zoom",null).on("mousewheel.zoom",null);if(b.chart_path=d3.svg.line().x(function(a){return b.xScale(a.x)}).y(function(a){return b.yScale(a.y)}).interpolate(b.interpolate),b.chartPathClass="lineChart"===b.type?"line":"multi-line","livedata"===c){if(PykCharts.boolean(b.multiple_containers_enable)){t=b.type+b.svgContainer.attr("id");for(var m=0;m<b.new_data_length;m++){var o=d3.select(b.selector+" #svg-"+m),p=o.select("#xaxis"),q=o.select("#yaxis"),r=(o.select("#xgrid"),o.select("#ygrid"),t.length),s=t.substring(0,r-1);b.k.xAxis(b.svgContainer,p,b.xScale).yAxis(b.svgContainer,q,b.yScale).yGrid(b.svgContainer,b.group,b.yScale).xGrid(b.svgContainer,b.group,b.xScale),o.select(b.selector+" #"+s+m).datum(b.new_data[m].data).attr("transform","translate("+b.extra_left_margin+",0)").attr("d",b.chart_path)}}else for(var m=0;m<b.new_data_length;m++)t=b.type+"-svg-"+m,b.svgContainer.select(b.selector+" #"+t).datum(b.new_data[m].data).attr("d",b.chart_path).style("stroke",function(){return b.new_data[m].highlight&&"multilineChart"===b.type&&!b.clicked?b.highlightLine(this,null):b.clicked?b.highlightLine(b.selected,null):d3.select(this).classed({"multi-line-selected":!1,"multi-line":!0,"multi-line-hover":!1}),b.fillColor.colorPieMS(b.new_data[m])}),d3.selectAll(b.selector+" text#"+(b.type+"-svg-"+m)).style("fill",function(){return b.fillColor.colorPieMS(b.new_data[m])});"lineChart"===b.type&&"default"===b.mode&&b.svgContainer.on("mouseout",function(){b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis")}).on("mousemove",function(){PykCharts.boolean(b.multiple_containers_enable)?b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,b.dataLineGroup,b.extra_left_margin,b.xdomain):b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,b.dataLineGroup,b.extra_left_margin,b.xdomain,b.type,b.tooltipMode,b.color_from_data,null)})}else{if(PykCharts.boolean(b.multiple_containers_enable))t=b.type+b.svgContainer.attr("id"),b.dataLineGroup[0]=b.chartBody.append("path"),b.dataLineGroup[0].datum(b.new_data1.data).attr("class",b.chartPathClass).attr("id",t).attr("transform","translate("+b.extra_left_margin+",0)").style("stroke",function(){return b.fillColor.colorPieMS(b.new_data[d])}),e(d);else{var m;for(m=0;m<b.new_data_length;m++){var t=b.type+"-svg-"+m;b.dataLineGroup[m]=b.chartBody.append("path");{b.new_data[m].data}b.ticks[m]=b.svgContainer.append("text").attr("id",t).attr("class","legend-heading").style("visibility","hidden").html(b.new_data[m].name).style("fill",function(){return b.fillColor.colorPieMS(b.new_data[m])}),b.dataLineGroup[m].datum(b.new_data[m].data).attr("class",b.chartPathClass).attr("id",t).attr("transform","translate("+b.extra_left_margin+",0)").style("stroke",function(){return b.new_data[m].highlight&&"multilineChart"===b.type&&b.highlightLine(this,null,b.new_data[m].highlight),b.fillColor.colorPieMS(b.new_data[m])}).style("stroke-opacity",function(){return"multilineChart"===b.type&&"saturation"===b.color_mode?(m+1)/b.new_data.length:1}).on("click",function(){"multilineChart"===b.type&&(b.clicked=!0,b.highlightLine(d3.event.target,b.clicked))}).on("mouseover",function(){"multilineChart"!==b.type||this===b.selected||"saturation"!==b.color_mode&&!b.hover||d3.select(this).classed({"multi-line-hover":!0,"multi-line":!1}).style("stroke","orange")}).on("mouseout",function(){"multilineChart"!==b.type||this===b.selected||"saturation"!==b.color_mode&&!b.hover||d3.select(this).classed({"multi-line-hover":!1,"multi-line":!0}).style("stroke",b.chartColor)}).attr("d",b.chart_path)}}"lineChart"===b.type&&"default"===b.mode?b.svgContainer.on("mouseout",function(){b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis")}).on("mousemove",function(){b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,b.dataLineGroup,b.extra_left_margin,b.xdomain,b.type,b.tooltipMode,b.color_from_data,null)}):"multilineChart"===b.type&&"default"===b.mode&&b.svgContainer.on("mouseout",function(){b.mouseEvent.tooltipHide(null,b.multiple_containers_enable,b.type),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis");for(var c=0;c<b.new_data_length;c++)$(a.selector+" #svg-"+c).trigger("mouseout")}).on("mousemove",function(){var c=[];c[0]=d3.select(a.selector+" #"+this.id+" .multi-line"),b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,c,b.extra_left_margin,b.xdomain,b.type,b.tooltipMode,b.color_from_data,b.multiple_containers_enable);for(var d=0;d<b.new_data_length;d++)$(a.selector+" #svg-"+d).trigger("mousemove")})}return this},ticks:function(){return PykCharts.boolean(b.pointer_size)&&(PykCharts.boolean(b.multiple_containers_enable)?(type=b.type+b.svgContainer.attr("id"),"bottom"!==b.axis_x_position||"left"!==b.axis_y_position&&"right"!==b.axis_y_position?"top"!==b.axis_x_position||"left"!==b.axis_y_position&&"right"!==b.axis_y_position||(b.ticks[0]=b.svgContainer.append("text").attr("id",type).attr("x",b.w-b.margin_left).attr("y",b.height-b.margin_bottom).attr("dy",10).attr("text-anchor","end").style("font-size",b.pointer_size).style("font-weight",b.pointer_weight).style("font-family",b.pointer_family).html(b.new_data1.name).style("fill",function(){return b.fillColor.colorPieMS(b.new_data1)})):b.ticks[0]=b.svgContainer.append("text").attr("id",type).attr("x",b.margin_left).attr("y",b.margin_top).attr("dy",-5).style("font-size",b.pointer_size).style("font-weight",b.pointer_weight).style("font-family",b.pointer_family).html(b.new_data1.name).style("fill",function(){return b.fillColor.colorPieMS(b.new_data1)})):(tickPosition=function(a,c){var d=b.xScale(b.new_data[c].data[b.new_data[c].data.length-1].x)+b.extra_left_margin+b.margin_left,e=b.yScale(b.new_data[c].data[b.new_data[c].data.length-1].y)+b.margin_top;return"vertical"===b.legends_display?(text_x=d-b.margin_left+25,text_y=e-b.margin_top+20,text_rotate=-90):"horizontal"===b.legends_display&&(text_x=d,text_y=e,text_rotate=0),"translate("+text_x+","+text_y+") rotate("+text_rotate+")"},b.ticks=b.svgContainer.selectAll(".legend-heading").data(b.new_data),b.ticks.enter().append("text"),b.ticks.attr("id",function(a,c){return b.type+"-svg-"+c}).attr("class","legend-heading").html(function(a){return console.log(a.name),a.name}).attr("transform",tickPosition).style("font-size",b.pointer_size).style("font-weight",b.pointer_weight).style("font-family",b.pointer_family).style("visibility","visible").attr("text-anchor","start").attr("dx",5).attr("dy",5).style("fill",function(a,c){return b.fillColor.colorPieMS(b.new_data[c])}),b.ticks.exit().remove())),this}};return c},this.zoomed=function(){if(PykCharts.boolean(b.multiple_containers_enable))for(i=0;i<b.new_data_length;i++)type=b.type+"svg-"+i,currentContainer=d3.selectAll(b.selector+" #svg-"+i),b.k.isOrdinal(currentContainer,".x.axis",b.xScale,b.xdomain,b.extra_left_margin),b.k.isOrdinal(currentContainer,".x.grid",b.xScale),b.k.isOrdinal(currentContainer,".y.axis",b.yScale,b.ydomain),b.k.isOrdinal(currentContainer,".y.grid",b.yScale),currentContainer.select(b.selector+" #"+type).attr("class",b.chartPathClass).attr("d",b.chart_path);else for(b.k.isOrdinal(b.svgContainer,".x.axis",b.xScale,b.xdomain,b.extra_left_margin),b.k.isOrdinal(b.svgContainer,".x.grid",b.xScale),b.k.isOrdinal(b.svgContainer,".y.axis",b.yScale,b.ydomain),b.k.isOrdinal(b.svgContainer,".y.grid",b.yScale),i=0;i<b.new_data_length;i++)type=b.type+"-svg-"+i,b.svgContainer.select(b.selector+" #"+type).attr("class",b.chartPathClass).attr("d",b.chart_path);"dblclick"===event.type&&b.cnt++,b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis"),3===b.cnt&&b.zoomOut(),b.annotation(),b.optionalFeature().ticks()},this.zoomOut=function(){b.optionalFeature().createChart("livedata"),b.k.isOrdinal(b.svgContainer,".x.axis",b.xScale,b.xdomain,b.extra_left_margin),b.k.isOrdinal(b.svgContainer,".x.grid",b.xScale),b.k.isOrdinal(b.svgContainer,".y.axis",b.yScale,b.ydomain),b.k.isOrdinal(b.svgContainer,".y.grid",b.yScale)},this.highlightLine=function(c,d){b.selected_line=c,b.selected_line_data=b.selected_line.__data__,b.selected_line_data_len=b.selected_line_data.length,b.deselected=b.selected,d3.select(b.deselected).classed({"multi-line-selected":!1,"multi-line":!0,"multi-line-hover":!1}),b.selected=c,d3.select(b.selected).classed({"multi-line-selected":!0,"multi-line":!1,"multi-line-hover":!1}).style("opacity",1),d&&d3.selectAll(a.selector+" path.multi-line").style("opacity",.3)},this.annotation=function(){if(b.line=d3.svg.line().interpolate("linear-closed").x(function(a){return a.x}).y(function(a){return a.y}),PykCharts.boolean(b.multiple_containers_enable)||"default"!==b.mode){if(PykCharts.boolean(b.multiple_containers_enable))for(i=0;i<b.new_data_length;i++){var a=[],c=10;b.new_data[i].data.map(function(b){b.annotation&&a.push({annotation:b.annotation,x:b.x,y:b.y})});var d=d3.select(b.selector+" #svg-"+i).selectAll(b.selector+" .linechart-arrows").data(a);d.enter().append("path"),d.attr("class","linechart-arrows").attr("d",function(a){var d=[{x:parseInt(b.xScale(a.x)-.5*c)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(a.y)-c+b.margin_top)},{x:parseInt(b.xScale(a.x)+.5*c)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(a.y)-c+b.margin_top)},{x:parseInt(b.xScale(a.x))+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(a.y)+b.margin_top)}];return b.line(d)}).attr("fill","#eeeeee").call(b.k.annotation),d.exit().remove()}}else{var c=10,a=[];for(i=0;i<b.new_data_length;i++)b.new_data[i].data.map(function(b){b.annotation&&a.push({annotation:b.annotation,x:b.x,y:b.y})});var d=b.svgContainer.selectAll(b.selector+" .linechart-arrows").data(a);d.enter().append("path"),d.attr("class","linechart-arrows").attr("d",function(a){var d=[{x:parseInt(b.xScale(a.x)-.5*c)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(a.y)-c+b.margin_top)},{x:parseInt(b.xScale(a.x)+.5*c)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(a.y)-c+b.margin_top)},{x:parseInt(b.xScale(a.x))+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(a.y)+b.margin_top)}];return b.line(d)}).attr("fill","#eeeeee").call(b.k.annotation),d.exit().remove()}}},PykCharts.multiD.areaChart=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.multiD.processInputs(b,a,"area"),"default"===b.mode&&b.k.loading();{var d=c.multiDimensionalCharts;c.stylesheet,a.optional}b.enableCrossHair=a.enableCrossHair?a.enableCrossHair:d.enableCrossHair,b.curvy_lines=a.line_curvy_lines?a.line_curvy_lines:d.line_curvy_lines,b.color_from_data=a.line_color_from_data?a.line_color_from_data:d.line_color_from_data,b.interpolate=PykCharts.boolean(b.curvy_lines)?"cardinal":"linear",b.w=b.width-b.margin_left-b.margin_right,b.h=b.height-b.margin_top-b.margin_bottom,d3.json(a.data,function(c,d){b.data=d.groupBy("area"),b.yAxisDataFormat=a.yAxisDataFormat?a.yAxisDataFormat:b.k.yAxisDataFormatIdentification(b.data),b.xAxisDataFormat=a.xAxisDataFormat?a.xAxisDataFormat:b.k.xAxisDataFormatIdentification(b.data),b.compare_data=b.data,b.data_length=b.data.length,$(b.selector+" #chart-loader").remove(),b.render()})},this.render=function(){b.dataLineGroup=[],b.dataLineGroupBorder=[],b.multid=new PykCharts.multiD.configuration(b),b.fillColor=new PykCharts.Configuration.fillChart(b,null,a),"default"===b.mode?(b.transitions=new PykCharts.Configuration.transition(b),b.fillColor=new PykCharts.Configuration.fillChart(b,null,a),b.k.title().subtitle().liveData(b).makeMainDiv(a.selector,1).tooltip(!0,a.selector,1),b.optional_feature().chartType().svgContainer(1).createChart().axisContainer(),b.k.crossHair(b.svgContainer,b.new_data_length,b.new_data,b.fillColor),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain).yGrid(b.svgContainer,b.group,b.yScale).xGrid(b.svgContainer,b.group,b.xScale).xAxisTitle(b.xGroup).yAxisTitle(b.yGroup).createFooter().lastUpdatedAt().credits().dataSource()):"infographics"===b.mode&&(b.k.liveData(b).makeMainDiv(a.selector,1),b.optional_feature().chartType().svgContainer(1).createChart().axisContainer(),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain).xAxisTitle(b.xGroup).yAxisTitle(b.yGroup)),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),$(window).on("load",function(){return b.k.resize(b.svgContainer,"yes")}).on("resize",function(){return b.k.resize(b.svgContainer,"yes")})},this.refresh=function(){d3.json(a.data,function(c,d){b.data=d.groupBy("area"),b.data_length=b.data.length;var e=b.multid.checkChangeInData(b.data,b.compare_data);b.compare_data=e[0];var f=e[1];f&&(b.k.lastUpdatedAt("liveData"),b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis")),b.optional_feature().createChart("liveData"),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale,b.extra_left_margin,b.xdomain).yAxis(b.svgContainer,b.yGroup,b.yScale,b.ydomain).yGrid(b.svgContainer,b.group,b.yScale).xGrid(b.svgContainer,b.group,b.xScale).tooltip(!0,a.selector)})},this.optional_feature=function(){var c={chartType:function(){for(j=1;j<b.data_length;j++)if(b.data[0].x===b.data[j].x){b.type="stackedAreaChart";break}return b.type=b.type||"areaChart",this},svgContainer:function(c){return $(b.selector).attr("class","PykCharts-twoD PykCharts-multi-series2D PykCharts-line-chart"),$(a.selector).css({"background-color":b.bg,position:"relative"}),b.svgContainer=d3.select(a.selector+" #tooltip-svg-container-"+c).append("svg:svg").attr("id","svg-"+c).attr("width",b.width).attr("height",b.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height),b.group=b.svgContainer.append("g").attr("id","chartsvg").attr("transform","translate("+b.margin_left+","+b.margin_top+")"),PykCharts.boolean(b.chart_grid_yEnabled)&&b.group.append("g").attr("id","ygrid").attr("class","y grid-line"),PykCharts.boolean(b.chart_grid_xEnabled)&&b.group.append("g").attr("id","xgrid").attr("class","x grid-line"),b.clip=b.svgContainer.append("svg:clipPath").attr("id","clip"+c+b.selector).append("svg:rect").attr("width",b.w).attr("height",b.h),b.chartBody=b.svgContainer.append("g").attr("id","clipPath").attr("clip-path","url(#clip"+c+b.selector+" )").attr("transform","translate("+b.margin_left+","+b.margin_top+")"),b.stack_layout=d3.layout.stack().values(function(a){return a.data}),this},axisContainer:function(){return PykCharts.boolean(b.axis_x_enable)&&(b.xGroup=b.group.append("g").attr("id","xaxis").attr("class","x axis")),PykCharts.boolean(b.axis_y_enable)&&(b.yGroup=b.group.append("g").attr("id","yaxis").attr("class","y axis")),this},createChart:function(c){function d(a){b.dataLineGroup[a].transition().duration(b.transitions.duration()).attrTween("d",function(){var c=d3.scale.quantile().domain([0,1]).range(d3.range(1,q.length+1));return function(d){return b.chart_path(b.new_data[a].data.slice(0,c(d)))}})}function e(a){b.dataLineGroupBorder[a].transition().duration(b.transitions.duration()).attrTween("d",function(){var c=d3.scale.quantile().domain([0,1]).range(d3.range(1,b.layers[a].data.length+1));return function(d){return b.chart_path(b.layers[a].data.slice(0,c(d)))}})}if(b.group_arr=[],b.color_arr=[],b.new_data=[],b.legend_text=[],"areaChart"===b.type)for(b.new_data[0]={name:b.data[0].name||"",data:[],color:b.data[0].color||""},j=0;j<b.data_length;j++)b.new_data[0].data.push({x:b.data[j].x,y:b.data[j].y,tooltip:b.data[j].tooltip,color:b.data[j].color||"",annotation:b.data[j].annotations||""});else if("stackedAreaChart"===b.type){for(j=0;j<b.data_length;j++)b.group_arr[j]=b.data[j].name,b.color_arr[j]=b.data[j].color?b.data[j].color:b.color[j];b.uniq_group_arr=b.group_arr.slice(),b.uniq_color_arr=b.color_arr.slice(),$.unique(b.uniq_group_arr),$.unique(b.uniq_color_arr);var f=b.uniq_group_arr.length;for(k=0;f>k;k++)for(b.new_data[k]={name:b.uniq_group_arr[k],data:[],color:b.uniq_color_arr[k]},l=0;l<b.data_length;l++)b.uniq_group_arr[k]===b.data[l].name&&b.new_data[k].data.push({x:b.data[l].x,y:b.data[l].y,tooltip:b.data[l].tooltip,annotation:b.data[l].annotations||""})}b.new_data_length=b.new_data.length,b.layers=b.stack_layout(b.new_data);var g,h,i,m,n,o=[];if(b.cnt=0,"number"===b.yAxisDataFormat?(max=d3.max(b.layers,function(a){return d3.max(a.data,function(a){return a.y0+a.y})}),min=0,n=[min,max],h=b.k._domainBandwidth(n,1),i=[b.h,0],b.yScale=b.k.scaleIdentification("linear",h,i)):"string"===b.yAxisDataFormat?(b.new_data[0].data.forEach(function(a){h.push(a.y)}),i=[0,b.h],b.yScale=b.k.scaleIdentification("ordinal",h,i,0)):"time"===b.yAxisDataFormat&&(b.layers.data.forEach(function(a){a.y0=new Date(a.y0),a.y=new Date(a.y)}),max=d3.max(b.layers,function(a){return d3.max(a.data,function(a){return a.y0+a.y})}),min=0,h=[min,max],i=[b.h,0],b.yScale=b.k.scaleIdentification("time",h,i)),"number"===b.xAxisDataFormat)max=d3.max(b.new_data,function(a){return d3.max(a.data,function(a){return a.x})}),min=d3.min(b.new_data,function(a){return d3.min(a.data,function(a){return a.x})}),g=[min,max],o=b.k._domainBandwidth(g,2),m=[0,b.w],b.xScale=b.k.scaleIdentification("linear",o,m),b.extra_left_margin=0;else if("string"===b.xAxisDataFormat)b.new_data[0].data.forEach(function(a){o.push(a.x)}),m=[0,b.w],b.xScale=b.k.scaleIdentification("ordinal",o,m,0),b.extra_left_margin=b.xScale.rangeBand()/2;else if("time"===b.xAxisDataFormat){for(max=d3.max(b.new_data,function(a){return d3.max(a.data,function(a){return new Date(a.x)})}),min=d3.min(b.new_data,function(a){return d3.min(a.data,function(a){return new Date(a.x)})}),o=[min,max],m=[0,b.w],b.xScale=b.k.scaleIdentification("time",o,m),p=0;p<b.new_data_length;p++)b.new_data[p].data.forEach(function(a){a.x=new Date(a.x)});b.data.forEach(function(a){a.x=new Date(a.x)}),b.extra_left_margin=0}if(b.xdomain=b.xScale.domain(),b.ydomain=b.yScale.domain(),b.zoom_event=d3.behavior.zoom(),"string"!==b.yAxisDataFormat&&"string"!==b.xAxisDataFormat?b.zoom_event.x(b.xScale).y(b.yScale).scaleExtent([1,4]).on("zoom",b.zoomed):b.zoom_event.y(b.yScale).scaleExtent([1,4]).on("zoom",b.zoomed),PykCharts.boolean(b.zoom_enable)&&"default"===b.mode&&(console.log,b.svgContainer.call(b.zoom_event),b.svgContainer.on("wheel.zoom",null).on("mousewheel.zoom",null)),b.chart_path=d3.svg.area().x(function(a){return b.xScale(a.x)}).y0(function(a){return b.yScale(a.y0)}).y1(function(a){return b.yScale(a.y0+a.y)}).interpolate(b.interpolate),b.chart_path_border=d3.svg.line().x(function(a){return b.xScale(a.x)}).y(function(a){return b.yScale(a.y0+a.y)}).interpolate(b.interpolate),b.chartPathClass="areaChart"===b.type?"area":"stacked-area","liveData"===c){for(var p=0;p<b.new_data_length;p++)type=b.chartPathClass+p,b.svgContainer.select("#"+type).datum(b.layers[p].data).attr("d",b.chart_path),b.svgContainer.select("#border-stacked-area"+p).datum(b.layers[p].data).attr("d",b.chart_path_border);"areaChart"===b.type&&b.svgContainer.on("mouseout",function(){b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(type),b.mouseEvent.axisHighlightHide(a.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(a.selector+" .y.axis")}).on("mousemove",function(){b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,b.dataLineGroup,b.extra_left_margin,b.xdomain,b.type,b.tooltip_mode)})}else{for(var p=0;p<b.new_data_length;p++){var q=b.new_data[p].data;type=b.chartPathClass+p,b.dataLineGroup[p]=b.chartBody.append("path"),b.dataLineGroup[p].datum(b.layers[p].data).attr("class",b.chartPathClass).attr("id",type).style("fill",function(){return b.fillColor.colorPieMS(b.new_data[p])}).style("fill-opacity",function(){return"stackedAreaChart"===b.type&&"saturation"===b.color_mode?(p+1)/b.new_data.length:void 0}).attr("transform","translate("+b.extra_left_margin+",0)").attr("d",function(){return b.chart_path(q[0])}),d(p),b.dataLineGroupBorder[p]=b.chartBody.append("path"),b.dataLineGroupBorder[p].datum(b.layers[p].data).attr("class","area-border").attr("id","border-stacked-area"+p).style("stroke",b.borderBetweenChartElements_color).style("stroke-width",b.borderBetweenChartElements_width).style("stroke-dasharray",b.borderBetweenChartElements_style).attr("transform","translate("+b.extra_left_margin+",0)").attr("d",b.chart_path_border),e(p)}b.svgContainer.on("mouseout",function(){if(b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis"),"stackedAreaChart"===b.type)for(var c=0;c<b.new_data_length;c++)$(a.selector+" #svg-"+c).trigger("mouseout")
}).on("mousemove",function(){if("areaChart"===b.type)b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,b.dataLineGroup,b.extra_left_margin,b.xdomain,b.type,b.tooltip_mode);else if("stackedAreaChart"===b.type){var c=[];c[0]=d3.select(a.selector+" #"+this.id+" .stacked-area"),b.mouseEvent.crossHairPosition(b.data,b.new_data,b.xScale,b.yScale,c,b.extra_left_margin,b.xdomain,b.type,b.tooltipMode,b.color_from_data,"no");for(var d=0;d<b.new_data_length;d++)$(a.selector+" #svg-"+d).trigger("mousemove")}})}return b.annotation(),this}};return c},this.zoomed=function(){for(b.k.isOrdinal(b.svgContainer,".x.axis",b.xScale,b.xdomain,b.extra_left_margin),b.k.isOrdinal(b.svgContainer,".x.grid",b.xScale),b.k.isOrdinal(b.svgContainer,".y.axis",b.yScale,b.ydomain),b.k.isOrdinal(b.svgContainer,".y.grid",b.yScale),i=0;i<b.new_data_length;i++)type=b.chartPathClass+i,b.svgContainer.select(b.selector+" #"+type).attr("class",b.chartPathClass).attr("d",b.chart_path),b.svgContainer.select(b.selector+" #border-stacked-area"+i).attr("class","area-border").attr("d",b.chart_path_border);"dblclick"===event.type&&b.cnt++,b.mouseEvent.tooltipHide(),b.mouseEvent.crossHairHide(b.type),b.mouseEvent.axisHighlightHide(b.selector+" .x.axis"),b.mouseEvent.axisHighlightHide(b.selector+" .y.axis"),3===b.cnt&&b.zoomOut(),b.annotation()},b.zoomOut=function(){b.optional_feature().createChart("liveData"),b.k.isOrdinal(b.svgContainer,".x.axis",b.xScale,b.xdomain,b.extra_left_margin),b.k.isOrdinal(b.svgContainer,".x.grid",b.xScale),b.k.isOrdinal(b.svgContainer,".y.axis",b.yScale,b.ydomain),b.k.isOrdinal(b.svgContainer,".y.grid",b.yScale)},b.annotation=function(){if(b.line=d3.svg.line().interpolate("linear-closed").x(function(a){return a.x}).y(function(a){return a.y}),"areaChart"===b.type&&"default"===b.mode){var a=10,c=[];b.new_data[0].data.map(function(a){a.annotation&&c.push({annotation:a.annotation,x:a.x,y:a.y})});var d=b.svgContainer.selectAll(b.selector+" .linechart-arrows").data(c);d.enter().append("path"),d.attr("class","linechart-arrows").attr("d",function(c){var d=[{x:parseInt(b.xScale(c.x)-.5*a)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(c.y)-a+b.margin_top)},{x:parseInt(b.xScale(c.x)+.5*a)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(c.y)-a+b.margin_top)},{x:parseInt(b.xScale(c.x))+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(c.y)+b.margin_top)}];return b.line(d)}).attr("fill","#eeeeee").call(b.k.annotation),d.exit().remove()}else if("stackedAreaChart"===b.type&&"default"===b.mode){var a=10,c=[];for(i=0;i<b.new_data_length;i++)b.new_data[i].data.map(function(a){a.annotation&&c.push({annotation:a.annotation,x:a.x,y:a.y,y0:a.y0})});var d=b.svgContainer.selectAll(".linechart-arrows").data(c);d.enter().append("path"),d.attr("class","linechart-arrows").attr("d",function(c){var d=[{x:parseInt(b.xScale(c.x)-.5*a)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(c.y0+c.y)-a+b.margin_top)},{x:parseInt(b.xScale(c.x)+.5*a)+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(c.y0+c.y)-a+b.margin_top)},{x:parseInt(b.xScale(c.x))+b.extra_left_margin+b.margin_left,y:parseInt(b.yScale(c.y0+c.y)+b.margin_top)}];return b.line(d)}).attr("fill","#eeeeee").call(b.k.annotation),d.exit().remove()}}},PykCharts.multiD.barChart=function(a){var b=this,c=new PykCharts.Configuration.Theme({});return this.execute=function(){b=new PykCharts.multiD.processInputs(b,a,"column"),b.grid_yEnabled=a.chart_grid_yEnabled?a.chart_grid_yEnabled:c.stylesheet.chart_grid_yEnabled,b.grid_color=a.chart_grid_color?a.chart_grid_color:c.stylesheet.chart_grid_color,b.xAxisDataFormat="","default"===b.mode&&b.k.loading(),d3.json(a.data,function(a,c){b.data=c.groupBy("bar"),b.compare_data=c.groupBy("bar"),$(b.selector+" #chart-loader").remove(),b.render()})},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("bar"),b.refresh_data=c.groupBy("bar");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.data=b.dataTransformation(),b.data=b.emptygroups(b.data);var f=b.flattenData();b.the_bars=f[0],b.the_keys=f[1],b.the_layers=b.buildLayers(b.the_bars),1===b.no_of_groups&&(b.legends_enable="no"),b.optionalFeatures().createChart().legends().ticks(),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale)})},this.render=function(){var b=this;b.data=b.dataTransformation(),b.data=b.emptygroups(b.data);var c=b.flattenData();b.the_bars=c[0],b.the_keys=c[1],b.the_layers=b.buildLayers(b.the_bars),b.transitions=new PykCharts.Configuration.transition(b),b.mouseEvent1=new PykCharts.multiD.mouseEvent(b),b.fillColor=new PykCharts.Configuration.fillChart(b,null,a),b.border=new PykCharts.Configuration.border(b),1===b.no_of_groups&&(b.legends_enable="no"),"default"===b.mode?(b.k.title().subtitle().makeMainDiv(b.selector,1),b.optionalFeatures().legendsContainer(1).svgContainer(1),b.k.liveData(b).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),b.optionalFeatures().createChart().legends().axisContainer().ticks(),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale).xAxisTitle(b.xGroup)):"infographics"===b.mode&&(b.k.makeMainDiv(b.selector,1),b.optionalFeatures().svgContainer(1).createChart().axisContainer(),b.k.tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),b.k.xAxis(b.svgContainer,b.xGroup,b.xScale).xAxisTitle(b.xGroup)),PykCharts.boolean(b.legends_enable)?$(window).on("load",function(){return b.k.resize(b.svgContainer,"",b.legendsContainer)}).on("resize",function(){return b.k.resize(b.svgContainer,"",b.legendsContainer)}):$(window).on("load",function(){return b.k.resize(b.svgContainer,"")}).on("resize",function(){return b.k.resize(b.svgContainer,"")})},this.optionalFeatures=function(){var b=this,c={svgContainer:function(c){return $(b.selector).attr("class","PykCharts-twoD"),b.svgContainer=d3.select(a.selector+" #tooltip-svg-container-"+c).append("svg:svg").attr("width",b.width).attr("height",b.height).attr("id","svgcontainer").attr("class","svgcontainer").style("background-color",b.bg).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height),b.group=b.svgContainer.append("g").attr("id","svggroup").attr("class","svggroup").attr("transform","translate("+b.margin_left+","+b.margin_top+")"),this},legendsContainer:function(c){return PykCharts.boolean(b.legends_enable)&&(b.legendsContainer=d3.select(a.selector+" #tooltip-svg-container-"+c).append("svg:svg").attr("width",b.width).attr("height",50).attr("class","legendscontainer").attr("id","legendscontainer").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" 50"),b.legendsGroup=b.legendsContainer.append("g").attr("id","legends").attr("class","legends").attr("transform","translate(0,10)")),this},axisContainer:function(){if(PykCharts.boolean(b.axis_y_enable)){var c=b.group.selectAll(".axis-line").data(["line"]);c.enter().append("line"),c.attr("class","axis-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",b.height-b.margin_top-b.margin_bottom).attr("stroke",b.axis_x_axisColor).attr("stroke-width","1px"),c.exit().remove(),"left"===b.axis_y_position?b.yGroup=b.group.append("g").attr("id","yaxis").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("x",-(b.height-b.margin_top-b.margin_bottom)/2).attr("y",-60).attr("dy",".71em").style("text-anchor","end").style("fill",b.axis_x_labelColor).text(a.axis_y_title):"right"===b.axis_y_position&&(c.attr("x1",b.width-b.margin_left-b.margin_right).attr("x2",b.width-b.margin_left-b.margin_right),b.yGroup=b.group.append("g").attr("id","yaxis").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("x",-(b.height-b.margin_top-b.margin_bottom)/2).attr("y",b.width-b.margin_left-b.margin_right+12).attr("dy",".71em").style("text-anchor","end").style("fill",b.axis_x_labelColor).text(a.axis_y_title))}return PykCharts.boolean(b.axis_x_enable)&&(b.xGroup=b.group.append("g").attr("id","xaxis").attr("class","x axis")),this},createChart:function(){{var c=b.width-b.margin_left-b.margin_right,d=b.no_of_groups+1,e=b.height-b.margin_top-b.margin_bottom,f=b.the_bars;b.the_keys}b.layers=b.the_layers;var g=b.getGroups();b.stack_layout=d3.layout.stack().values(function(a){return a.values})(b.layers),b.layers=b.layers.map(function(a){return{name:a.name,values:a.values.map(function(a){return{x:a.y,y:a.x,x0:a.y0,tooltip:a.tooltip?a.tooltip:a.y,color:a.color,group:a.group,name:a.name}})}});var h=[];b.layers.map(function(a,b){for(b in a.values){var c=a.values[b];h.push(c.x+c.x0)}}),b.yScale=d3.scale.ordinal().domain(f.map(function(a,b){return a.id||b})).rangeBands([0,e]);var i=[0,d3.max(h)];b.xScale=d3.scale.linear().domain(b.k._domainBandwidth(i,1)).range([0,c]);var j=[];for(var k in g){var l=g[k],m=b.yScale(l[0]),n=b.yScale.rangeBand()*l.length;m+=n/2,j.push({y:m,name:k})}b.domain=j.map(function(a){return a.name}),b.y0=d3.scale.ordinal().domain(j.map(function(a){return a.name})).rangeRoundBands([0,e],.1),b.y1=d3.scale.ordinal().domain(b.barName.map(function(a){return a})).rangeRoundBands([0,b.y0.rangeBand()]),b.y_factor=0,b.height_factor=0,1===b.no_of_groups&&(b.y_factor=b.yScale.rangeBand()/4,b.height_factor=b.yScale.rangeBand()/(2*b.no_of_groups)),b.bars=b.group.selectAll(".bars").data(b.layers),b.bars.enter().append("g").attr("class","bars");var o=b.bars.selectAll("rect").data(function(a){return a.values});o.enter().append("svg:rect").attr("class","rect"),o.attr("width",0).attr("x",0).attr("fill",function(a){return b.fillColor.colorPieMS(a)}).attr("fill-opacity",function(a){return"saturation"===b.color_mode?b.highlight===a.name?(d--,1):d>1?(d--,d/b.no_of_groups):(d=b.no_of_groups+1,d--,d/b.no_of_groups):void 0}).attr("stroke",b.border.color()).attr("stroke-width",b.border.width()).attr("stroke-dasharray",b.border.style()).attr("stroke-opacity",1).on("mouseover",function(c){b.mouseEvent.tooltipPosition(c),b.mouseEvent.toolTextShow(c.tooltip?c.tooltip:c.y),b.mouseEvent.axisHighlightShow(c.name,a.selector+" .axis-text",b.domain,"bar")}).on("mouseout",function(c){b.mouseEvent.tooltipHide(c),b.mouseEvent.axisHighlightHide(a.selector+" .axis-text","bar")}).on("mousemove",function(a){b.mouseEvent.tooltipPosition(a)}),o.attr("x",function(a){return b.xScale(a.x0)}).attr("width",function(a){return b.xScale(a.x)}).attr("height",function(){return b.yScale.rangeBand()+b.height_factor}).attr("y",function(a){return b.yScale(a.y)-b.y_factor}),b.bars.exit().remove();var p=b.group.selectAll("text.axis-text").data(j);return p.enter().append("text"),p.attr("class","axis-text").attr("y",function(a){return a.y}).attr("x",function(){return-10}).attr("fill",b.axis_y_labelColor).text(function(a){return a.name}).text(function(a){return this.getBBox().width>.8*b.margin_left?a.name.substr(0,2)+"..":a.name}).on("mouseover",function(a){b.mouseEvent.tooltipPosition(a),b.mouseEvent.toolTextShow(a.name)}).on("mouseout",function(a){b.mouseEvent.tooltipHide(a)}).on("mousemove",function(a){b.mouseEvent.tooltipPosition(a)}),"right"===b.axis_y_position&&p.attr("x",function(){return b.width-b.margin_left-b.margin_right+10}),"left"===b.axis_y_position&&"right"===b.axis_y_value_position&&p.attr("x",function(){return 10}),"right"===b.axis_y_position&&"left"===b.axis_y_value_position&&p.attr("x",function(){return b.width-b.margin_left-b.margin_right-10}),"right"===b.axis_y_value_position?p.attr("text-anchor","start"):"left"===b.axis_y_value_position&&p.attr("text-anchor","end"),p.exit().remove(),this},ticks:function(){if(b.pointer_size){b.txt_width,b.txt_height,b.ticksElement=b.bars.selectAll("g").data(b.layers);var a=b.bars.selectAll(".ticksText").data(function(a){return a.values});a.enter().append("text").attr("class","ticksText"),a.attr("class","ticksText").text(function(a){return a.x?a.x:void 0}).style("font-weight",b.pointer_weight).style("font-size",b.pointer_size).attr("fill",b.pointer_color).style("font-family",b.pointer_family).text(function(a){return a.x&&(b.txt_width=this.getBBox().width,b.txt_height=this.getBBox().height,a.x&&b.txt_width<b.xScale(a.x)&&b.txt_height<b.yScale.rangeBand()+b.height_factor)?a.x:void 0}).attr("x",function(a){b.xScale(a.x);return b.xScale(a.x0)+b.xScale(a.x)+5}).attr("y",function(a){return b.yScale(a.y)-b.y_factor+b.yScale.rangeBand()/2}).attr("dy",function(){return 1===b.no_of_groups?b.yScale.rangeBand()/2:b.yScale.rangeBand()/4}).style("font-size",function(){return b.pointer_size}),a.exit().remove()}return this},legends:function(){if(PykCharts.boolean(b.legends_enable)){var a,c=b.getParameters();a=c[0].color,c=c.map(function(a){return a.name}),c=_.uniq(c);var d=0,e=0;if(d=c.length,e=c.length,"vertical"===b.legends_display){b.legendsContainer.attr("height",30*c.length+20),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,h=function(){return b.width-b.width/4+16},i=function(){return b.width-b.width/4};var f=function(a,b){return 24*b+12},g=function(a,b){return 24*b+23}}else if("horizontal"===b.legends_display){text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y";var h=function(){return d--,b.width-(100*d+75)};g=30,rect_parameter1value=13,rect_parameter2value=13;var i=function(){return e--,b.width-(100*e+100)};f=18}var j=b.legendsGroup.selectAll("rect").data(c);j.enter().append("rect"),j.attr(rect_parameter1,rect_parameter1value).attr(rect_parameter2,rect_parameter2value).attr(rect_parameter3,i).attr(rect_parameter4,f).attr("fill",function(){return a}).attr("fill-opacity",function(a,c){return"saturation"===b.color_mode?(b.no_of_groups-c)/b.no_of_groups:void 0}),j.exit().remove(),b.legends_text=b.legendsGroup.selectAll(".legends_text").data(c),b.legends_text.enter().append("text").attr("class","legends_text").attr("fill","#1D1D1D").attr("pointer-events","none").style("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-size",12),b.legends_text.attr("class","legends_text").attr("fill","black").attr(text_parameter1,h).attr(text_parameter2,g).text(function(a){return a}),b.legends_text.exit().remove()}return this}};return c},this.getGroups=function(){var a={};for(var c in b.the_bars){var d=b.the_bars[c];d.id&&(a[d.group]?a[d.group].push(d.id):a[d.group]=[d.id])}return a},this.buildLayers=function(a){function c(a){for(var b in e){var c=e[b];if(c.name==a)return c}return d(a)}function d(a){var b={name:a,values:[]};return e.push(b),b}var e=[];for(var f in a){var g=a[f];if(g.id){var h=g.id;for(var i in g)if("id"!==i){var j=g[i];for(var k in j){var l=j[k];if(l.name){var m=c(l.name);m.values.push({x:h,y:l.val,color:l.color,tooltip:l.tooltip,group:b.keys[h],name:g.group})}}}}}return e},this.flattenData=function(){var a=[-1];b.keys={};for(var c in b.data){var d=b.data[c];for(var e in d){for(var f in d[e]){var g="i"+c+"j"+f;if("object"==typeof d[e][f]){var h=Object.keys(d[e][f])[0];b.keys[g]=h,d[e][f].id=g,d[e][f].group=e,a.push(d[e][f])}}a.push(c)}}return[a,b.keys]},this.getParameters=function(){var a=[];for(var c in b.the_layers)if(b.the_layers[c].name){var d,e=b.the_layers[c].name;for(var f in b.the_layers[c].values)if(PykCharts.boolean(b.the_layers[c].values[f].y)){var d,e=b.the_layers[c].values[f].group;d="saturation"===b.color_mode?b.saturationColor:"color"===b.color_mode&&b.the_layers[c].values[0].color?b.the_layers[c].values[0].color:"color"===b.color_mode&&b.color.length?b.color[0]:b.chartColor,a.push({name:e,color:d})}}return a},this.emptygroups=function(a){b.no_of_groups=d3.max(a,function(a){var b=_.values(a);return b[0].length});_.map(a,function(c,d){for(var e=_.values(c);e[0].length<b.no_of_groups;){var f=_.keys(c),g={name:"stack",tooltip:"null",color:"white",val:0},h={group3:[g]};a[d][f[0]].push(h),e=_.values(c)}});return a},this.dataTransformation=function(){var a=[];b.barName=[];var c=b.data.length;b.data.sort(function(a,b){return b.x-a.x});for(var d=0;c>d;d++){var e,f={},g={};if(b.data[d].group||(b.data[d].group="group"+d),b.data[d].stack||(b.data[d].stack="stack"),b.barName[d]=b.data[d].group,f[b.data[d].y]=[],g[b.data[d].group]=[],e={name:b.data[d].stack,tooltip:b.data[d].tooltip,color:b.data[d].color,val:b.data[d].x},0===d)a.push(f),a[d][b.data[d].y].push(g),a[d][b.data[d].y][d][b.data[d].group].push(e);else{var h=a.length,i=0;for(i=0;h>i;i++)if(_.has(a[i],b.data[d].y)){var j=a[i][b.data[d].y],k=j.length,l=0;for(l=0;k>l&&!_.has(a[i][b.data[d].y][l],b.data[d].group);l++);k>l?a[i][b.data[d].y][l][b.data[d].group].push(e):(a[i][b.data[d].y].push(g),a[i][b.data[d].y][l][b.data[d].group].push(e));break}i===h&&(a.push(f),a[i][b.data[d].y].push(g),a[i][b.data[d].y][0][b.data[d].group].push(e))}}return b.barName=_.unique(b.barName),a},this},PykCharts.multiD.columnChart=function(a){var b=this,c=new PykCharts.Configuration.Theme({});return this.execute=function(){b=new PykCharts.multiD.processInputs(b,a,"column"),b.grid_yEnabled=a.chart_grid_yEnabled?a.chart_grid_yEnabled:c.stylesheet.chart_grid_yEnabled,b.grid_color=a.chart_grid_color?a.chart_grid_color:c.stylesheet.chart_grid_color,"default"===b.mode&&b.k.loading(),d3.json(a.data,function(a,c){b.data=c.groupBy("column"),b.compare_data=c.groupBy("column"),$(b.selector+" #chart-loader").remove(),b.render()})},this.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("column"),b.refresh_data=c.groupBy("column");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.data=b.dataTransformation(),b.data=b.emptygroups(b.data);var f=b.flattenData();b.the_bars=f[0],b.the_keys=f[1],b.the_layers=b.buildLayers(b.the_bars),1===b.no_of_groups&&(b.legends_enable="no"),b.optionalFeatures().createChart().legends(),b.k.yAxis(b.svgContainer,b.yGroup,b.yScaleInvert).yGrid(b.svgContainer,b.group,b.yScaleInvert)})},this.render=function(){var b=this;b.data=b.dataTransformation(),b.data=b.emptygroups(b.data);var c=b.flattenData();b.the_bars=c[0],b.the_keys=c[1],b.the_layers=b.buildLayers(b.the_bars),b.border=new PykCharts.Configuration.border(b),b.transitions=new PykCharts.Configuration.transition(b),b.mouseEvent1=new PykCharts.multiD.mouseEvent(b),b.fillColor=new PykCharts.Configuration.fillChart(b,null,a),1===b.no_of_groups&&(b.legends_enable="no"),"default"===b.mode?(b.k.title().subtitle().makeMainDiv(b.selector,1),b.optionalFeatures().legendsContainer(1).svgContainer(1),b.k.liveData(b).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),b.optionalFeatures().createChart().legends().axisContainer(),b.k.yAxis(b.svgContainer,b.yGroup,b.yScaleInvert).yAxisTitle(b.yGroup).yGrid(b.svgContainer,b.group,b.yScaleInvert)):"infographics"===b.mode&&(b.k.makeMainDiv(b.selector,1),b.optionalFeatures().svgContainer(1).createChart().axisContainer(),b.k.tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),b.k.yAxis(b.svgContainer,b.ygroup,b.yScaleInvert).yAxisTitle(b.yGroup)),PykCharts.boolean(b.legends_enable)?$(window).on("load",function(){return b.k.resize(b.svgContainer,"",b.legendsContainer)}).on("resize",function(){return b.k.resize(b.svgContainer,"",b.legendsContainer)}):$(window).on("load",function(){return b.k.resize(b.svgContainer,"")}).on("resize",function(){return b.k.resize(b.svgContainer,"")})},this.optionalFeatures=function(){var b=this,c={svgContainer:function(c){return $(b.selector).attr("class","PykCharts-twoD"),b.svgContainer=d3.select(a.selector+" #tooltip-svg-container-"+c).append("svg:svg").attr("width",b.width).attr("height",b.height).attr("id","svgcontainer").attr("class","svgcontainer").style("background-color",b.bg).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" "+b.height),b.group=b.svgContainer.append("g").attr("id","svggroup").attr("class","svggroup").attr("transform","translate("+b.margin_left+","+b.margin_top+")"),PykCharts.boolean(b.grid_yEnabled)&&b.group.append("g").attr("id","ygrid").style("stroke",b.grid_color).attr("class","y grid-line"),this},legendsContainer:function(c){return PykCharts.boolean(b.legends_enable)&&(b.legendsContainer=d3.select(a.selector+" #tooltip-svg-container-"+c).append("svg:svg").attr("width",b.width).attr("height",50).attr("class","legendscontainer").attr("id","legendscontainer").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+b.width+" 50"),b.legendsGroup=b.legendsContainer.append("g").attr("id","legends").attr("class","legends").attr("transform","translate(0,10)")),this},axisContainer:function(){if(PykCharts.boolean(b.axis_x_enable)){var a=b.group.selectAll(".axis-line").data(["line"]);a.enter().append("line"),a.attr("class","axis-line").attr("x1",0).attr("y1",b.height-b.margin_top-b.margin_bottom).attr("x2",b.width-b.margin_left-b.margin_right).attr("y2",b.height-b.margin_top-b.margin_bottom).attr("stroke",b.axis_x_axisColor),a.exit().remove(),"bottom"===b.axis_x_position?b.xGroup=b.group.append("g").attr("id","xaxis").attr("class","x axis").style("stroke","none").append("text").attr("x",(b.width-b.margin_left-b.margin_right)/2).attr("y",b.height-b.margin_bottom-b.margin_top).attr("dy",b.margin_top+10).style("fill",b.axis_x_labelColor).style("text-anchor","end").text(b.axis_x_title):"top"===b.axis_x_position&&(a.attr("y1",0).attr("y2",0),b.xGroup=b.group.append("g").attr("id","xaxis").attr("class","x axis").style("stroke","none").append("text").attr("x",(b.width-b.margin_left-b.margin_right)/2).attr("y",-40).attr("dy",b.margin_top+10).style("fill",b.axis_x_labelColor).style("text-anchor","end").text(b.axis_x_title))}return PykCharts.boolean(b.axis_y_enable)&&(b.yGroup=b.group.append("g").attr("id","yaxis").attr("class","y axis")),this},createChart:function(){var c=b.width-b.margin_left-b.margin_right,d=b.height-b.margin_top-b.margin_bottom,e=b.no_of_groups+1,f=b.the_bars,g=(b.the_keys,b.the_layers),h=b.getGroups();b.stack_layout=d3.layout.stack().values(function(a){return a.values})(g);var i=[];g.map(function(a,b){for(b in a.values){var c=a.values[b];i.push(c.y+c.y0)}}),b.xScale=d3.scale.ordinal().domain(f.map(function(a,b){return a.id||b})).rangeBands([0,c],.1),y_domain=[0,d3.max(i)],y_domain=b.k._domainBandwidth(y_domain,1),b.yScale=d3.scale.linear().domain(y_domain).range([0,d]),b.yScaleInvert=d3.scale.linear().domain([y_domain[1],y_domain[0]]).range([0,d]);var j,k,l,m,n=(d3.scale.category10(),[]),o=0,p=0;1===b.no_of_groups&&(o=b.xScale.rangeBand()/4,p=b.xScale.rangeBand()/(2*b.no_of_groups));for(m in h)j=h[m],k=b.xScale(j[0]),l=b.xScale.rangeBand()*j.length,k+=l/2,n.push({x:k,name:m});var q=c/n.length,r=b.group.selectAll(".bars").data(g);r.attr("class","bars"),r.enter().append("g").attr("class","bars"),b.domain=n.map(function(a){return a.name});var s=r.selectAll("rect").data(function(a){return a.values});s.enter().append("svg:rect").attr("class","rect"),s.attr("height",0).attr("y",d).attr("fill",function(a){return b.fillColor.colorPieMS(a)}).attr("fill-opacity",function(a){return"saturation"===b.color_mode?b.highlight===a.name?(e--,1):e>1?(e--,e/b.no_of_groups):(e=b.no_of_groups+1,e--,e/b.no_of_groups):void 0}).attr("stroke",b.border.color()).attr("stroke-width",b.border.width()).attr("stroke-dasharray",b.border.style()).attr("stroke-opacity",1).on("mouseover",function(c){b.mouseEvent.tooltipPosition(c),b.mouseEvent.toolTextShow(c.tooltip?c.tooltip:c.y),b.mouseEvent.axisHighlightShow(c.name,a.selector+" .axis-text",b.domain,"column")}).on("mouseout",function(c){b.mouseEvent.tooltipHide(c),b.mouseEvent.axisHighlightHide(a.selector+" .axis-text","column")}).on("mousemove",function(a){b.mouseEvent.tooltipPosition(a)}),s.attr("x",function(a){return b.xScale(a.x)-o}).attr("width",function(){return b.xScale.rangeBand()+p}).attr("height",function(a){return b.yScale(a.y)}).attr("y",function(a){return d-b.yScale(a.y0+a.y)}),r.exit().remove();var t=b.group.selectAll("text.axis-text").data(n);return t.enter().append("text"),t.attr("class","axis-text").attr("x",function(a){return a.x}).attr("text-anchor","middle").attr("fill",b.axis_x_labelColor).text(function(a){return a.name}).text(function(a){return this.getBBox().width>.8*q?a.name.substr(0,3)+"..":a.name}).on("mouseover",function(a){b.mouseEvent.tooltipPosition(a),b.mouseEvent.toolTextShow(a.name)}).on("mouseout",function(a){b.mouseEvent.tooltipHide(a)}).on("mousemove",function(a){b.mouseEvent.tooltipPosition(a)}),t.exit().remove(),"top"===b.axis_x_position?"top"===b.axis_x_value_position?t.attr("y",function(){return-15}):"bottom"===b.axis_x_value_position&&t.attr("y",function(){return 15}):"top"===b.axis_x_value_position?t.attr("y",function(){return d-15}):"bottom"===b.axis_x_value_position&&t.attr("y",function(){return d+15}),this},legends:function(){if(PykCharts.boolean(b.legends_enable)){var a,c=b.getParameters();a=c[0].color,c=c.map(function(a){return a.name}),c=_.uniq(c);var d=0,e=0;if(d=c.length,e=c.length,"vertical"===b.legends_display){b.legendsContainer.attr("height",30*c.length+20),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,h=function(){return b.width-b.width/4+16},i=function(){return b.width-b.width/4};var f=function(a,b){return 24*b+12},g=function(a,b){return 24*b+23}}else if("horizontal"===b.legends_display){text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y";var h=function(){return d--,b.width-(100*d+75)};g=30,rect_parameter1value=13,rect_parameter2value=13;var i=function(){return e--,b.width-(100*e+100)};f=18}var j=b.legendsGroup.selectAll("rect").data(c);j.enter().append("rect"),j.attr(rect_parameter1,rect_parameter1value).attr(rect_parameter2,rect_parameter2value).attr(rect_parameter3,i).attr(rect_parameter4,f).attr("fill",function(){return a}).attr("fill-opacity",function(a,c){return"saturation"===b.color_mode?(b.no_of_groups-c)/b.no_of_groups:void 0}),j.exit().remove(),b.legends_text=b.legendsGroup.selectAll(".legends_text").data(c),b.legends_text.enter().append("text").attr("class","legends_text").attr("fill","#1D1D1D").attr("pointer-events","none").style("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-size",12),b.legends_text.attr("class","legends_text").attr("fill","black").attr(text_parameter1,h).attr(text_parameter2,g).text(function(a){return a}),b.legends_text.exit().remove()}return this}};return c},this.getGroups=function(){var a={};for(var c in b.the_bars){var d=b.the_bars[c];d.id&&(a[d.group]?a[d.group].push(d.id):a[d.group]=[d.id])}return a},this.buildLayers=function(a){function c(a){for(var b in e){var c=e[b];if(c.name==a)return c}return d(a)}function d(a){var b={name:a,values:[]};return e.push(b),b}var e=[];for(var f in a){var g=a[f];if(g.id){var h=g.id;for(var i in g)if("id"!==i){var j=g[i];for(var k in j){var l=j[k];if(l.name){var m=c(l.name);m.values.push({x:h,y:l.val,color:l.color,tooltip:l.tooltip,group:b.keys[h],name:g.group})}}}}}return e},this.flattenData=function(){var a=[-1];b.keys={};for(var c in b.data){var d=b.data[c];for(var e in d){for(var f in d[e]){var g="i"+c+"j"+f;if("object"==typeof d[e][f]){var h=Object.keys(d[e][f])[0];b.keys[g]=h,d[e][f].id=g,d[e][f].group=e,a.push(d[e][f])}}a.push(c)}}return[a,b.keys]},this.getParameters=function(){var a=[];for(var c in b.the_layers)if(b.the_layers[c].name)for(var d in b.the_layers[c].values)if(PykCharts.boolean(b.the_layers[c].values[d].y)){var e,f=b.the_layers[c].values[d].group;e="saturation"===b.color_mode?b.saturationColor:"color"===b.color_mode&&b.the_layers[c].values[0].color?b.the_layers[c].values[0].color:"color"===b.color_mode&&b.color.length?b.color[0]:b.chartColor,a.push({name:f,color:e})}return a},this.emptygroups=function(a){b.no_of_groups=d3.max(a,function(a){var b=_.values(a);return b[0].length});_.map(a,function(c,d){for(var e=_.values(c);e[0].length<b.no_of_groups;){var f=_.keys(c),g={name:"stack",tooltip:"null",color:"white",val:0},h={group3:[g]};a[d][f[0]].push(h),e=_.values(c)}});return a},this.dataTransformation=function(){var a=[];b.barName=[];var c=b.data.length;b.data.sort(function(a,b){return b.y-a.y});for(var d=0;c>d;d++){var e,f={},g={};if(b.data[d].group||(b.data[d].group="group"+d),b.data[d].stack||(b.data[d].stack="stack"),b.barName[d]=b.data[d].group,f[b.data[d].x]=[],g[b.data[d].group]=[],e={name:b.data[d].stack,tooltip:b.data[d].tooltip,color:b.data[d].color,val:b.data[d].y},0===d)a.push(f),a[d][b.data[d].x].push(g),a[d][b.data[d].x][d][b.data[d].group].push(e);else{var h=a.length,i=0;for(i=0;h>i;i++)if(_.has(a[i],b.data[d].x)){var j=a[i][b.data[d].x],k=j.length,l=0;for(l=0;k>l&&!_.has(a[i][b.data[d].x][l],b.data[d].group);l++);k>l?a[i][b.data[d].x][l][b.data[d].group].push(e):(a[i][b.data[d].x].push(g),a[i][b.data[d].x][l][b.data[d].group].push(e));break}i===h&&(a.push(f),a[i][b.data[d].x].push(g),a[i][b.data[d].x][0][b.data[d].group].push(e))}}return b.barName=_.unique(b.barName),a},this},PykCharts.multiD.scatterPlot=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.multiD.processInputs(b,a,"scatterplot"),"default"===b.mode&&b.k.loading();{var d=c.multiDimensionalCharts;c.stylesheet,a.optional}b.multiD=new PykCharts.multiD.configuration(b),b.multiple_containers_enable=a.multiple_containers_enable&&a.multiple_containers_enable?a.multiple_containers_enable:d.multiple_containers_enable,b.bubbleRadius=a.scatterplot_radius&&_.isNumber(a.scatterplot_radius)?a.scatterplot_radius:d.scatterplot_radius,b.enableTicks=a.scatterplot_pointer?a.scatterplot_pointer:d.scatterplot_pointer,b.zoomed_out=!0,b.size_enable=a.size_enable?a.size_enable:d.size_enable,b.radius_range=PykCharts.boolean(b.multiple_containers_enable)?[2*b.k._radiusCalculation(1.1),2*b.k._radiusCalculation(2.6)]:[2*b.k._radiusCalculation(4.5),2*b.k._radiusCalculation(11)],d3.json(a.data,function(c,d){b.data=d.groupBy("scatterplot"),b.yAxisDataFormat=a.yAxisDataFormat?a.yAxisDataFormat:b.k.yAxisDataFormatIdentification(b.data),b.xAxisDataFormat=a.xAxisDataFormat?a.xAxisDataFormat:b.k.xAxisDataFormatIdentification(b.data),b.compare_data=d.groupBy("scatterplot"),$(b.selector+" #chart-loader").remove();var e=new PykCharts.multiD.scatterplotFunction(a,b,"scatterplot");e.render()})}},PykCharts.multiD.pulse=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){b=new PykCharts.multiD.processInputs(b,a,"pulse"),"default"===b.mode&&b.k.loading();{var d=c.multiDimensionalCharts;c.stylesheet,a.optional}b.multiD=new PykCharts.multiD.configuration(b),b.multiple_containers_enable=a.multiple_containers_enable&&a.multiple_containers_enable?a.multiple_containers_enable:d.multiple_containers_enable,b.bubbleRadius=a.scatterplot_radius&&_.isNumber(a.scatterplot_radius)?a.scatterplot_radius:d.scatterplot_radius,b.zoomed_out=!0,b.radius_range=[2*b.k._radiusCalculation(1.1),2*b.k._radiusCalculation(3.5)],b.size_enable=a.size_enable?a.size_enable:d.size_enable,d3.json(a.data,function(c,d){b.data=d.groupBy("pulse"),b.yAxisDataFormat=a.yAxisDataFormat?a.yAxisDataFormat:b.k.yAxisDataFormatIdentification(b.data),b.xAxisDataFormat=a.xAxisDataFormat?a.xAxisDataFormat:b.k.xAxisDataFormatIdentification(b.data),b.compare_data=d.groupBy("pulse"),$(b.selector+" #chart-loader").remove();var e=new PykCharts.multiD.scatterplotFunction(a,b,"pulse");e.render()})}},PykCharts.multiD.scatterplotFunction=function(a,b,c){function d(){e.zoomed_out=!1;var a,b=this.id,c=b.length;a=PykCharts.boolean(e.multiple_containers_enable)?e.no_of_groups:1;for(var d=0;a>d;d++){var f=b.substring(0,c-1);current_container=d3.select(e.selector+" #"+f+d),e.k.isOrdinal(current_container,".x.axis",e.x),e.k.isOrdinal(current_container,".x.grid",e.x),e.k.isOrdinal(current_container,".y.axis",e.yScale),e.k.isOrdinal(current_container,".y.grid",e.yScale),e.optionalFeatures().plotCircle().label(),d3.select(e.selector+" #"+f+d).selectAll(".dot").attr("r",function(a){return e.sizes(a.weight)*d3.event.scale
}).attr("cx",function(a){return e.x(a.x)+e.extra_left_margin}).attr("cy",function(a){return e.yScale(a.y)+e.extra_top_margin}),d3.select(e.selector+" #"+f+d).selectAll(".text").style("font-size",e.label_size).attr("x",function(a){return e.x(a.x)+e.extra_left_margin}).attr("y",function(a){return e.yScale(a.y)+e.extra_top_margin+5})}e.count++,10===e.count&&(d3.select(e.selector+" #"+f+d).call(function(){return e.zoomOut()}),e.count=1)}var e=b;e.refresh=function(){d3.json(a.data,function(a,b){e.data=b.groupBy("scatterplot"),e.refresh_data=b.groupBy("scatterplot");var c=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=c[0];var d=c[1];d&&e.k.lastUpdatedAt("liveData"),e.map_group_data=e.multiD.mapGroup(e.data),e.optionalFeatures().createChart().legends().plotCircle().label().ticks(),e.k.xAxis(e.svgContainer,e.xGroup,e.x,e.extra_left_margin,e.xdomain).yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain)})},this.render=function(){if(e.map_group_data=e.multiD.mapGroup(e.data),e.fillChart=new PykCharts.Configuration.fillChart(e),e.border=new PykCharts.Configuration.border(e),"default"===e.mode){if(e.k.title().subtitle(),e.uniq_group_arr=_.uniq(e.data.map(function(a){return a.group})),e.no_of_groups=1,PykCharts.boolean(e.multiple_containers_enable)&&"scatterplot"===c){for(e.no_of_groups=e.uniq_group_arr.length,e.w=e.width/4,e.height=e.height/2,e.margin_left=e.margin_left,e.margin_right=e.margin_right,i=0;i<e.no_of_groups;i++){for(e.new_data=[],j=0;j<e.data.length;j++)e.data[j].group===e.uniq_group_arr[i]&&e.new_data.push(e.data[j]);e.k.positionContainers(e.legends_enable,e),e.k.makeMainDiv(e.selector,i),e.optionalFeatures().legendsContainer(i).svgContainer(i),e.k.liveData(e).tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.sizes=new PykCharts.multiD.bubbleSizeCalculation(e,e.data,e.radius_range),e.optionalFeatures().createChart().legends(i).label().ticks(),e.k.xAxis(e.svgContainer,e.xGroup,e.x,e.extra_left_margin,e.xdomain).yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup),(i+1)%4===0&&0!==i&&e.k.emptyDiv()}e.k.emptyDiv()}else e.w=e.width,e.new_data=e.data,e.k.makeMainDiv(e.selector,0),e.optionalFeatures().legendsContainer(0).svgContainer(0),e.k.liveData(e).tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.sizes=new PykCharts.multiD.bubbleSizeCalculation(e,e.data,e.radius_range),e.optionalFeatures().createChart().legends().ticks(),"scatterplot"===c&&e.optionalFeatures().label(),e.k.xAxis(e.svgContainer,e.xGroup,e.x,e.extra_left_margin,e.xdomain).yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup);e.k.createFooter().lastUpdatedAt().credits().dataSource()}else"infographics"===e.mode&&(e.radius_range=[7,18],e.new_data=e.data,e.w=e.width,e.sizes=new PykCharts.multiD.bubbleSizeCalculation(e,e.data,e.radius_range),e.k.tooltip().makeMainDiv(e.selector,0),e.optionalFeatures().svgContainer(0),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().createChart(0),e.k.xAxis(e.svgContainer,e.xGroup,e.x,e.extra_left_margin,e.xdomain).yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup));PykCharts.boolean(e.multiple_containers_enable)||("scatterplot"===c&&PykCharts.boolean(e.legends_enable)&&PykCharts.boolean(e.size_enable)&&e.map_group_data[1]?$(window).on("load",function(){return e.k.resize(e.svgContainer,"",e.legendsContainer)}).on("resize",function(){return e.k.resize(e.svgContainer,"",e.legendsContainer)}):$(window).on("load",function(){return e.k.resize(e.svgContainer)}).on("resize",function(){return e.k.resize(e.svgContainer)}))},e.optionalFeatures=function(){var b={svgContainer:function(b){return $(a.selector+" #tooltip-svg-container-"+b).css("width",e.w),$(a.selector).attr("class","PykCharts-weighted"),e.svgContainer=d3.select(a.selector+" #tooltip-svg-container-"+b).append("svg").attr("width",e.w).attr("height",e.height).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+e.w+" "+e.height).attr("id","svgcontainer"+b).attr("class","svgcontainer").style("background-color",e.bg),e.group=e.svgContainer.append("g").attr("transform","translate("+e.margin_left+","+e.margin_top+")").attr("id","main"),e.ticksElement=e.svgContainer.append("g").attr("transform","translate("+e.margin_left+","+e.margin_top+")").attr("id","main2"),PykCharts.boolean(e.axis_x_enable)&&(e.xGroup=e.group.append("g").attr("class","x axis").style("stroke","black")),PykCharts.boolean(e.axis_y_enable)&&(e.yGroup=e.group.append("g").attr("class","y axis").style("stroke","blue")),e.clip=e.group.append("svg:clipPath").attr("id","clip"+b+e.selector).append("svg:rect").attr("width",e.w-e.margin_left-e.margin_right).attr("height",e.height-e.margin_top-e.margin_bottom),e.chartBody=e.group.append("g").attr("clip-path","url(#clip"+b+e.selector+" )"),this},legendsContainer:function(a){return console.log(e.selector,e.map_group_data[1]),PykCharts.boolean(e.legends_enable)&&PykCharts.boolean(e.size_enable)&&e.map_group_data[1]&&(console.log(e.selector),e.legendsContainer=d3.select(e.selector+" #tooltip-svg-container-"+a).append("svg").attr("width",e.w).attr("height",50).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+e.w+" 50").attr("class","legends").attr("id","legendscontainer"),e.legendsGroup=e.legendsContainer.append("g").attr("id","legends").attr("transform","translate(0,20)")),this},createChart:function(){if(e.weight=_.map(e.new_data,function(a){return a.weight}),e.weight=_.reject(e.weight,function(a){return 0==a}),e.sorted_weight=e.weight.slice(0),e.sorted_weight.sort(function(a,b){return a-b}),e.group.append("text").attr("fill","black").attr("text-anchor","end").attr("x",e.w-70).attr("y",e.height+40),e.zoomed_out===!0){var a,b,c,f,g=[],h=[];"number"===e.yAxisDataFormat?(f=d3.extent(e.data,function(a){return a.y}),h=e.k._domainBandwidth(f,2,"number"),b=[e.height-e.margin_top-e.margin_bottom,0],e.yScale=e.k.scaleIdentification("linear",h,b),e.extra_top_margin=0):"string"===e.yAxisDataFormat?(e.data.forEach(function(a){h.push(a.y)}),b=[0,e.height-e.margin_top-e.margin_bottom],e.yScale=e.k.scaleIdentification("ordinal",h,b,0),e.extra_top_margin=e.yScale.rangeBand()/2):"time"===e.yAxisDataFormat&&(h=d3.extent(e.data,function(a){return new Date(a.x)}),b=[e.height-e.margin_top-e.margin_bottom,0],e.yScale=e.k.scaleIdentification("time",h,b),e.extra_top_margin=0),"number"===e.xAxisDataFormat?(a=d3.extent(e.data,function(a){return a.x}),g=e.k._domainBandwidth(a,2),c=[0,e.w-e.margin_left-e.margin_right],e.x=e.k.scaleIdentification("linear",g,c),e.extra_left_margin=0):"string"===e.xAxisDataFormat?(e.data.forEach(function(a){g.push(a.x)}),c=[0,e.w-e.margin_left-e.margin_right],e.x=e.k.scaleIdentification("ordinal",g,c,0),e.extra_left_margin=e.x.rangeBand()/2):"time"===e.xAxisDataFormat&&(max=d3.max(e.data,function(a){return new Date(a.x)}),min=d3.min(e.data,function(a){return new Date(a.x)}),a=[min.getTime(),max.getTime()],g=e.k._domainBandwidth(a,2,"time"),c=[0,e.w-e.margin_left-e.margin_right],e.x=e.k.scaleIdentification("time",g,c),e.data.forEach(function(a){a.x=new Date(a.x)}),e.extra_left_margin=0),e.xdomain=e.x.domain(),e.ydomain=e.yScale.domain(),e.x1=1,e.y1=12,e.count=1;var i=d3.behavior.zoom().x(e.x).y(e.yScale).scaleExtent([e.x1,e.y1]).on("zoom",d);if(PykCharts.boolean(e.zoom_enable)&&"string"!==e.yAxisDataFormat&&"string"!==e.xAxisDataFormat&&"default"===e.mode){var j;j=PykCharts.boolean(e.multiple_containers_enable)?e.no_of_groups:1;for(var k=0;k<e.no_of_groups;k++)d3.select(e.selector+" #svgcontainer"+k).call(i),d3.select(e.selector+" #svgcontainer"+k).on("wheel.zoom",null).on("mousewheel.zoom",null)}e.optionalFeatures().plotCircle()}return this},legends:function(a){if(PykCharts.boolean(e.legends_enable)&&PykCharts.boolean(e.size_enable)&&e.map_group_data[1]){var b=(_.uniq(e.sorted_weight),0),c=0;if("vertical"===e.legends_display){e.legendsContainer.attr("height",30*e.map_group_data[0].length+20),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,g=function(){return e.w-e.w/4+16},h=function(){return e.w-e.w/4};var d=function(a,b){return 24*b+12},f=function(a,b){return 24*b+23}}else if("horizontal"===e.legends_display){text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",b=0,c=0;var g=function(a,b){return 0===b&&(c=0),e.w-(100*b+75)>0?e.w-(100*b+75):e.w-(100*c+75)<e.w?(c++,e.w-(100*(c-1)+75)):(c=0,c++,e.w-(100*(c-1)+75))};f=function(a,d){return 0===d&&(b=0,c=0),e.w-(100*d+75)>0||(e.w-(100*c+75)<e.w?(0===c&&b++,c++):(c=0,c++,b++)),24*b+23},rect_parameter1value=13,rect_parameter2value=13;var h=function(a,d){return 0===d&&(b=0,c=0),e.w-(100*d+100)>=0?e.w-(100*d+100):e.w-(100*d+100)<e.w?(b++,0===c&&e.legendsContainer.attr("height",50*(b+1)),c++,e.w-(100*(c-1)+100)):(c=0,c++,b++,e.w-(100*(c-1)+100))};d=function(a,d){return 0===d&&(b=0,c=0),e.w-(100*d+75)>0||(e.w-(100*c+75)<e.w?(0==c&&b++,c++):(c=0,c++,b++)),24*b+12}}var i;if(PykCharts.boolean(e.multiple_containers_enable)){var j=[];j.push(e.map_group_data[0][a]),i=e.legendsGroup.selectAll("rect").data(j),e.legends_text=e.legendsGroup.selectAll(".legends_text").data(j)}else i=e.legendsGroup.selectAll("rect").data(e.map_group_data[0]),e.legends_text=e.legendsGroup.selectAll(".legends_text").data(e.map_group_data[0]);i.enter().append("rect"),i.attr(rect_parameter1,rect_parameter1value).attr(rect_parameter2,rect_parameter2value).attr(rect_parameter3,h).attr(rect_parameter4,d).attr("fill",function(a){return e.fillChart.colorPieW(a)}).attr("opacity",function(){return.6}),i.exit().remove(),e.legends_text.enter().append("text").attr("class","legends_text").attr("fill",e.legendsText_color).attr("pointer-events","none").style("font-family",e.legendsText_family).attr("font-size",e.legendsText_size),e.legends_text.attr("class","legends_text").attr("fill","black").attr(text_parameter1,g).attr(text_parameter2,f).text(function(a){return a.group}),e.legends_text.exit().remove()}return this},ticks:function(){if(PykCharts.boolean(e.enableTicks)){var a=e.ticksElement.selectAll("text").data(e.new_data);a.enter().append("text"),a.attr("transform",function(a){return"translate("+e.x(a.x)+","+e.yScale(a.y)+")"}).style("text-anchor","middle").style("font-family",e.label_family).style("font-size",e.label_size).attr("pointer-events","none").attr("dx",-1).attr("dy",function(a){return-e.sizes(a.weight)-4}),a.text(function(a){return a.name}),a.exit().remove()}return this},plotCircle:function(){return e.circlePlot=e.chartBody.selectAll(".dot").data(e.new_data),e.circlePlot.enter().append("circle").attr("class","dot"),e.circlePlot.attr("r",function(a){return e.sizes(a.weight)}).attr("cx",function(a){return e.x(a.x)+e.extra_left_margin}).attr("cy",function(a){return e.yScale(a.y)+e.extra_top_margin}).style("fill",function(a){return e.fillChart.colorPieW(a)}).style("fill-opacity",function(a){return e.multiD.opacity(a.weight,e.weight,e.data)}).attr("stroke",e.border.color()).attr("stroke-width",e.border.width()).attr("stroke-dasharray",e.border.style()).attr("stroke-opacity",1).on("mouseover",function(a){tooltipText=a.tooltip?a.tooltip:"<table class='PykCharts'><tr><th colspan='2'>"+a.name+"</th></tr><tr><td>X</td><td>"+a.x+"</td></tr><tr><td>Y</td><td>"+a.y+"</td></tr><tr><td>Weight</td><td>"+a.weight+"</td></tr></table>",e.mouseEvent.tooltipPosition(a),e.mouseEvent.toolTextShow(tooltipText),PykCharts.boolean(e.size_enable)&&d3.select(this).style("fill-opacity",1)}).on("mouseout",function(a){e.mouseEvent.tooltipHide(a),PykCharts.boolean(e.size_enable)&&d3.selectAll(".dot").style("fill-opacity",.5)}).on("mousemove",function(a){e.mouseEvent.tooltipPosition(a)}).on("dblclick",function(){d3.event.stopPropagation()}).on("mousedown",function(){d3.event.stopPropagation()}),e.circlePlot.exit().remove(),this},label:function(){return PykCharts.boolean(e.label_size)&&(e.circleLabel=e.chartBody.selectAll(".text").data(e.new_data),e.circleLabel.enter().append("text").attr("class","text"),e.circleLabel.attr("x",function(a){return e.x(a.x)+e.extra_left_margin}).attr("y",function(a){return e.yScale(a.y)+e.extra_top_margin+5}).attr("text-anchor","middle").attr("pointer-events","none").style("font-weight",e.label_weight).style("font-size",e.label_size).attr("fill",e.label_color).style("font-family",e.label_family).text(function(a){return a.weight}).text(function(a){return this.getBBox().width<2*e.sizes(a.weight)&&this.getBBox().height<2*e.sizes(a.weight)?a.weight:""}),e.circleLabel.exit().remove()),this}};return b},e.zoomOut=function(){e.zoomed_out=!0,e.x1=1,e.y1=12,e.optionalFeatures().createChart().label(),e.k.xAxis(e.svgContainer,e.xGroup,e.x,e.extra_left_margin,e.xdomain).yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain)}},PykCharts.multiD.spiderWeb=function(a){var b=this,c=new PykCharts.Configuration.Theme({});this.execute=function(){"default"===b.mode&&b.k.loading(),b=new PykCharts.multiD.processInputs(b,a,"spiderweb"),b.multiD=new PykCharts.multiD.configuration(b),b.axisTitle=a.axisTitle?a.axisTitle:c.multiDimensionalCharts.spiderweb_axisTitle,b.bubbleRadius=a.spiderweb_radius&&_.isNumber(a.spiderweb_radius)?a.spiderweb_radius:c.multiDimensionalCharts.spiderweb_radius,b.outerRadius=a.spiderweb_outer_radius_percent&&_.isNumber(a.spiderweb_outer_radius_percent)?a.spiderweb_outer_radius_percent:c.multiDimensionalCharts.spiderweb_outer_radius_percent,b.inner_radius=0,b.enableTicks=a.spiderweb_pointer?a.spiderweb_pointer:c.multiDimensionalCharts.spiderweb_pointer,b.size_enable=a.size_enable?a.size_enable:c.multiDimensionalCharts.size_enable,b.outerRadius=b.k._radiusCalculation(b.outerRadius),d3.json(a.data,function(a,c){b.data=c.groupBy("spiderweb"),b.compare_data=c.groupBy("spiderweb"),$(b.selector+" #chart-loader").remove(),b.render()})},b.refresh=function(){d3.json(a.data,function(a,c){b.data=c.groupBy("spiderweb"),b.refresh_data=c.groupBy("spiderweb");var d=b.k.checkChangeInData(b.refresh_data,b.compare_data);b.compare_data=d[0];var e=d[1];e&&b.k.lastUpdatedAt("liveData"),b.map_group_data=b.multiD.mapGroup(b.data),b.optionalFeatures().createChart().legends().axisTicks().axisTitle()})},this.render=function(){b.radius_range=[3*b.outerRadius/100,.09*b.outerRadius],b.fillChart=new PykCharts.Configuration.fillChart(b),b.sizes=new PykCharts.multiD.bubbleSizeCalculation(b,b.data,b.radius_range),b.border=new PykCharts.Configuration.border(b),b.map_group_data=b.multiD.mapGroup(b.data),"default"===b.mode?(b.k.title(),b.k.subtitle().makeMainDiv(b.selector,1),b.optionalFeatures().legendsContainer(1).svgContainer(1),b.k.liveData(b).tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b),b.optionalFeatures().createChart().axisTicks().axisTitle().legends(),b.k.createFooter().lastUpdatedAt().credits().dataSource()):"infographics"===b.mode&&(b.optionalFeatures().svgContainer().createChart().axisTicks().axisTitle(),b.k.tooltip(),b.mouseEvent=new PykCharts.Configuration.mouseEvent(b)),PykCharts.boolean(b.legends_enable)?$(window).on("load",function(){return b.k.resize(b.svgContainer,"",b.legendsContainer)}).on("resize",function(){return b.k.resize(b.svgContainer,"",b.legendsContainer)}):$(window).on("load",function(){return b.k.resize(b.svgContainer,"")}).on("resize",function(){return b.k.resize(b.svgContainer,"")})},this.degrees=function(a){return a/Math.PI*180-90},this.optionalFeatures=function(){var a=this,b={svgContainer:function(b){return $(a.selector).attr("class","PykCharts-spider-web"),a.svgContainer=d3.select(a.selector+" #tooltip-svg-container-"+b).append("svg").attr("class","svgcontainer").attr("id","svgcontainer").attr("width",a.width).attr("height",a.height).style("background-color",a.bg).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+a.width+" "+a.height),a.group=a.svgContainer.append("g").attr("id","spidergrp").attr("transform","translate("+a.width/2+","+a.height/2+")"),this},legendsContainer:function(b){return PykCharts.boolean(a.legends_enable)&&PykCharts.boolean(a.size_enable)&&a.map_group_data[1]&&(a.legendsContainer=d3.select(a.selector+" #tooltip-svg-container-"+b).append("svg").attr("class","legendsvg").attr("id","legendscontainer").attr("width",a.width).attr("height",50).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+a.width+" 50"),a.legendsGroup=a.legendsContainer.append("g").attr("class","legendgrp").attr("id","legendgrp")),this},createChart:function(){var b,c,d;for(a.group_arr=[],a.uniq_group_arr=[],j=0;j<a.data.length;j++)a.group_arr[j]=a.data[j].group;a.uniq_group_arr=_.uniq(a.group_arr);var e=a.uniq_group_arr.length;for(a.new_data=[],k=0;e>k;k++)for(a.new_data[k]={name:a.uniq_group_arr[k],data:[]},l=0;l<a.data.length;l++)a.uniq_group_arr[k]===a.data[l].group&&a.new_data[k].data.push({x:a.data[l].x,y:a.data[l].y,weight:a.data[l].weight,color:a.data[l].color,tooltip:a.data[l].tooltip});var f=a.new_data[0].data;for(d=d3.max(a.new_data,function(a){return d3.max(a.data,function(a){return a.y})}),c=d3.min(a.new_data,function(a){return d3.min(a.data,function(a){return a.y})}),a.yScale=d3.scale.linear().domain([c,d]).range([a.inner_radius,a.outerRadius]),a.y_domain=[],a.nodes=[],b=0;b<a.new_data.length;b++){var g=[];for(j=0;j<a.new_data[b].data.length;j++)g[j]=a.yScale(a.new_data[b].data[j].y);a.y_domain[b]=g}for(b=0;b<a.new_data.length;b++){a.y=d3.scale.linear().domain(d3.extent(a.y_domain[b],function(a){return a})).range([.1,.9]);var h=[];for(j=0;j<f.length;j++)h[j]={x:j,y:a.y(a.y_domain[b][j]),tooltip:a.new_data[b].data[j].tooltip||a.new_data[b].data[j].weight};a.nodes[b]=h}for(m=0;m<a.new_data.length;m++){var i=[];for(j=0;j<a.new_data[m].data.length;j++)i[j]=a.new_data[m].data[j].tooltip;for(a.angle=d3.scale.ordinal().domain(d3.range(a.new_data[m].data.length+1)).rangePoints([0,2*Math.PI]),a.radius=d3.scale.linear().range([a.inner_radius,a.outerRadius]),a.yAxis=[],b=0;b<a.new_data[m].data.length;b++)a.yAxis.push({x:b,y:.25},{x:b,y:.5},{x:b,y:.75},{x:b,y:1});var n,o=[];for(b=0;b<a.yAxis.length;b++)n=b<a.yAxis.length-4?a.yAxis[b+4]:a.yAxis[b-a.yAxis.length+4],o.push({source:a.yAxis[b],target:n});var p,q=[];for(b=0;b<a.nodes[m].length;b++)b<a.nodes[m].length-1?(n=a.nodes[m][b+1],p=a.fillChart.colorPieW(a.new_data[m].data[b])):(n=a.nodes[m][0],p=a.fillChart.colorPieW(a.new_data[m].data[b])),q.push({source:a.nodes[m][b],target:n,color:p});var r=a.group.selectAll("#link"+m).data(q);r.enter().append("path").attr("class","link"),r.attr("class","link").attr("stroke",function(a){return a.color}).attr("stroke-opacity",1).attr("id","link"+m).attr("d",d3.customHive.link().angle(function(b){return a.angle(b.x)}).radius(function(b){return a.radius(b.y)})),r.exit().remove(),a.weight=_.map(a.new_data[m].data,function(a){return a.weight}),a.weight=_.reject(a.weight,function(a){return 0==a}),a.sorted_weight=a.weight.slice(0),a.sorted_weight.sort(function(a,b){return a-b});var s=a.group.selectAll(".node"+m).data(a.nodes[m]);s.enter().append("circle").attr("class","node"+m).attr("transform",function(b){return"rotate("+a.degrees(a.angle(b.x))+")"}),s.attr("class","node"+m).attr("cx",function(b){return a.radius(b.y)}).attr("r",function(b,c){return a.sizes(a.new_data[m].data[c].weight)}).style("fill",function(b,c){return a.fillChart.colorPieW(a.new_data[m].data[c])}).style("opacity",function(b,c){return a.multiD.opacity(a.new_data[m].data[c].weight,a.weight,a.data)}).attr("stroke",a.border.color()).attr("stroke-width",a.border.width()).attr("stroke-dasharray",a.border.style()).on("mouseover",function(b){a.mouseEvent.tooltipPosition(b),a.mouseEvent.toolTextShow(b.tooltip)}).on("mouseout",function(b){a.mouseEvent.tooltipHide(b)}).on("mousemove",function(b){a.mouseEvent.tooltipPosition(b)}),s.exit().remove()}return a.group.selectAll(".axis").data(d3.range(a.new_data[0].data.length)).enter().append("line").attr("class","axis").attr("transform",function(b){return"rotate("+a.degrees(a.angle(b))+")"}).attr("x1",a.radius.range()[0]).attr("x2",a.radius.range()[1]),a.group.selectAll(".grid").data(o).enter().append("path").attr("class","grid").attr("d",d3.customHive.link().angle(function(b){return a.angle(b.x)}).radius(function(b){return a.radius(b.y)})),this},legends:function(){if(PykCharts.boolean(a.legends_enable)&&PykCharts.boolean(a.size_enable)&&a.map_group_data[1]){var b=(_.uniq(a.sorted_weight),0),c=0;if("vertical"===a.legends_display){a.legendsContainer.attr("height",30*a.map_group_data[0].length+20),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,f=function(){return a.width-a.width/4+16},g=function(){return a.width-a.width/4};var d=function(a,b){return 24*b+12},e=function(a,b){return 24*b+23}}else if("horizontal"===a.legends_display){text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",b=0,c=0;var f=function(b,d){return 0===d&&(c=0),a.w-(100*d+75)>0?a.width-(100*d+75):a.width-(100*c+75)<a.width?(c++,a.width-(100*(c-1)+75)):(c=0,c++,a.width-(100*(c-1)+75))};e=function(d,e){return 0===e&&(b=0,c=0),a.width-(100*e+75)>0||(a.width-(100*c+75)<a.width?(0===c&&b++,c++):(c=0,c++,b++)),24*b+23},rect_parameter1value=13,rect_parameter2value=13;var g=function(d,e){return 0===e&&(b=0,c=0),a.w-(100*e+100)>=0?a.width-(100*e+100):a.width-(100*e+100)<a.width?(b++,0===c&&a.legendsContainer.attr("height",50*(c+1)),c++,a.width-(100*(c-1)+100)):(c=0,c++,b++,a.width-(100*(c-1)+100))};d=function(d,e){return 0===e&&(b=0,c=0),a.width-(100*e+75)>0||(a.width-(100*c+75)<a.width?(0==c&&b++,c++):(c=0,c++,b++)),24*b+12}}var h=a.legendsGroup.selectAll("rect").data(a.map_group_data[0]);h.enter().append("rect"),h.attr(rect_parameter1,rect_parameter1value).attr(rect_parameter2,rect_parameter2value).attr(rect_parameter3,g).attr(rect_parameter4,d).attr("fill",function(b){return a.fillChart.colorPieW(b)}).attr("opacity",function(){return.6}),h.exit().remove(),a.legends_text=a.legendsGroup.selectAll(".legends_text").data(a.map_group_data[0]),a.legends_text.enter().append("text").attr("class","legends_text").attr("fill",a.legendsText_color).attr("pointer-events","none").style("font-family",a.legendsText_family).attr("font-size",a.legendsText_size),a.legends_text.attr("class","legends_text").attr("fill","black").attr(text_parameter1,f).attr(text_parameter2,e).text(function(a){return a.group}),a.legends_text.exit().remove()}return this},axisTitle:function(){if(PykCharts.boolean(a.axisTitle)){a.length=a.new_data[0].data.length;var b=a.group.selectAll("text.axisTitle").data(a.nodes[0]);b.enter().append("text").attr("class","axisTitle"),b.attr("transform",function(){return"translate("+-a.outerRadius+","+-a.outerRadius+")"}).style("text-anchor","middle").attr("x",function(b,c){return a.outerRadius*(1-.2*Math.sin(2*c*Math.PI/a.length))+1.25*a.outerRadius*Math.sin(2*c*Math.PI/a.length)}).attr("y",function(b,c){return a.outerRadius*(1-.6*Math.cos(2*c*Math.PI/a.length))-.47*a.outerRadius*Math.cos(2*c*Math.PI/a.length)}).style("font-size",a.label_size).style("font-family",a.label_family),b.text(function(b,c){return a.new_data[0].data[c].x}),b.exit().remove()}return this},axisTicks:function(){if(PykCharts.boolean(a.enableTicks)){var b=a.yScale.domain();a.ticksElement=a.svgContainer.append("g").attr("transform","translate("+a.width/2+","+a.height/2+")");var c=b[1]/4,d=[];for(i=4,j=0;i>=0;i--,j++)d[j]=i*c;var e=a.ticksElement.selectAll("text.ticks").data(d);e.enter().append("text").attr("class","ticks"),e.style("text-anchor","start").attr("transform","translate(5,"+-a.outerRadius+")").attr("x",0).attr("y",function(b,c){return c*(a.outerRadius/4)}).attr("dy",-2),e.text(function(a){return a}).style("font-size",a.label_size).style("font-family",a.label_family)}return this}};return b}},PykCharts.maps={},PykCharts.maps.mouseEvent=function(){var a={highlight:function(a,b){var c=d3.select(b);return d3.selectAll(a).attr("opacity",.5),c.attr("opacity",1),this},highlightHide:function(a){return d3.selectAll(a).attr("opacity",1),this}};return a},PykCharts.maps.processInputs=function(a,b){{var c=new PykCharts.Configuration.Theme({}),d=c.stylesheet,e=c.functionality,f=c.mapsTheme;b.optional}switch(a.selector=b.selector?b.selector:d.selector,a.width=_.isNumber(parseInt(b.chart_width,10))?b.chart_width:f.chart_width,a.height=_.isNumber(parseInt(b.chart_height,10))?b.chart_height:f.chart_height,a.mapCode=b.mapCode?b.mapCode:f.mapCode,a.enableClick=b.enableClick?b.enableClick:f.enableClick,a.bg=b.colors_backgroundColor?b.colors_backgroundColor:d.backgroundColor,a.timeline_duration=b.timeline_duration?b.timeline_duration:f.timeline_duration,a.margin_left=b.timeline_margin_left?b.timeline_margin_left:f.timeline_margin_left,a.margin_right=b.timeline_margin_right?b.timeline_margin_right:f.timeline_margin_right,a.margin_top=b.timeline_margin_top?b.timeline_margin_top:f.timeline_margin_top,a.margin_bottom=b.timeline_margin_bottom?b.timeline_margin_bottom:f.timeline_margin_bottom,a.tooltip_enable=b.tooltip_enable?b.tooltip_enable:f.tooltip_enable,a.tooltip_mode=b.tooltip_mode?b.tooltip_mode:f.tooltip_mode,a.tooltip_positionTop=b.tooltip_positionTop?b.tooltip_positionTop:f.tooltip_positionTop,a.tooltip_positionLeft=b.tooltip_positionLeft?b.tooltip_positionLeft:f.tooltip_positionLeft,a.tooltipTopCorrection=d3.select(a.selector).style("top"),a.tooltipLeftCorrection=d3.select(a.selector).style("left"),a.colors_defaultColor=b.colors_defaultColor?b.colors_defaultColor:f.colors_defaultColor,a.colors_total=b.colors_total&&_.isNumber(parseInt(b.colors_total,10))?parseInt(b.colors_total,10):f.colors_total,a.colors_type=b.colors_type?b.colors_type:f.colors_type,a.colors_palette=b.colors_palette?b.colors_palette:f.colors_palette,a.axis_onHoverHighlightenable=PykCharts.boolean(b.axis_x_enable)&&b.axis_onHoverHighlightenable?b.axis_onHoverHighlightenable:f.axis_onHoverHighlightenable,a.axis_x_enable=b.axis_x_enable?b.axis_x_enable:f.axis_x_enable,a.axis_x_value_position=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_value_position?b.axis_x_value_position:f.axis_x_value_position,a.axis_x_axisColor=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_axisColor?b.axis_x_axisColor:f.axis_x_axisColor,a.axis_x_labelColor=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_labelColor?b.axis_x_labelColor:f.axis_x_labelColor,a.axis_x_no_of_axis_value=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_no_of_axis_value?b.axis_x_no_of_axis_value:f.axis_x_no_of_axis_value,a.axis_x_pointer_padding=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_pointer_padding?b.axis_x_pointer_padding:f.axis_x_pointer_padding,a.axis_x_pointer_size="axis_x_pointer_size"in b&&PykCharts.boolean(b.axis_x_enable)?b.axis_x_pointer_size:f.axis_x_pointer_size,a.axis_x_value_format=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_value_format?b.axis_x_value_format:f.axis_x_value_format,a.axis_x_pointer_values=PykCharts.boolean(b.axis_x_enable)&&b.axis_x_pointer_values?b.axis_x_pointer_values:f.axis_x_pointer_values,a.axis_x_outer_pointer_size="axis_x_outer_pointer_size"in b&&PykCharts.boolean(b.axis_x_enable)?b.axis_x_outer_pointer_size:f.axis_x_outer_pointer_size,a.label_enable=b.label_enable?b.label_enable:f.label_enable,a.legends_enable=b.legends_enable?b.legends_enable:f.legends_enable,a.legends_display=b.legends_display?b.legends_display:f.legends_display,a.borderBetweenChartElements_width="borderBetweenChartElements_width"in b?b.borderBetweenChartElements_width:d.borderBetweenChartElements_width,a.borderBetweenChartElements_color=b.borderBetweenChartElements_color?b.borderBetweenChartElements_color:d.borderBetweenChartElements_color,a.borderBetweenChartElements_style=b.borderBetweenChartElements_style?b.borderBetweenChartElements_style:d.borderBetweenChartElements_style,a.borderBetweenChartElements_style){case"dotted":a.borderBetweenChartElements_style="1,3";break;case"dashed":a.borderBetweenChartElements_style="5,5";break;default:a.borderBetweenChartElements_style="0"}return a.onhover=b.onhover?b.onhover:f.onhover,a.defaultZoomLevel=b.defaultZoomLevel?b.defaultZoomLevel:80,a.loading=b.loading_animationGifUrl?b.loading_animationGifUrl:d.loading_animationGifUrl,a.highlightArea=b.highlightArea?b.highlightArea:f.highlightArea,a.highlight=b.highlight?b.highlight:f.highlight,b&&PykCharts.boolean(b.title_text)?(a.title_text=b.title_text,a.title_size="title_size"in b?b.title_size:d.title_size,a.title_color=b.title_color?b.title_color:d.title_color,a.title_weight=b.title_weight?b.title_weight:d.title_weight,a.title_family=b.title_family?b.title_family:d.title_family):(a.title_size=d.title_size,a.title_color=d.title_color,a.title_weight=d.title_weight,a.title_family=d.title_family),b&&PykCharts.boolean(b.subtitle_text)?(a.subtitle_text=b.subtitle_text,a.subtitle_size="subtitle_size"in b?b.subtitle_size:d.subtitle_size,a.subtitle_color=b.subtitle_color?b.subtitle_color:d.subtitle_color,a.subtitle_weight=b.subtitle_weight?b.subtitle_weight:d.subtitle_weight,a.subtitle_family=b.subtitle_family?b.subtitle_family:d.subtitle_family):(a.subtitle_size=d.subtitle_size,a.subtitle_color=d.subtitle_color,a.subtitle_weight=d.subtitle_weight,a.subtitle_family=d.subtitle_family),a.realTimeCharts_refreshFrequency=b.realTimeCharts_refreshFrequency?b.realTimeCharts_refreshFrequency:e.realTimeCharts_refreshFrequency,a.realTimeCharts_enableLastUpdatedAt=b.realTimeCharts_enableLastUpdatedAt?b.realTimeCharts_enableLastUpdatedAt:e.realTimeCharts_enableLastUpdatedAt,a.transition_duration=b.transition_duration?b.transition_duration:e.transition_duration,a.creditMySite_name=b.creditMySite_name?b.creditMySite_name:d.creditMySite_name,a.creditMySite_url=b.creditMySite_url?b.creditMySite_url:d.creditMySite_url,a.dataSource_name=b.dataSource_name?b.dataSource_name:"",a.dataSource_url=b.dataSource_url?b.dataSource_url:"",a.units=b.units?b.units:!1,a.k=new PykCharts.Configuration(a),a},PykCharts.maps.oneLayer=function(a){{var b=this;new PykCharts.Configuration.Theme({})}this.execute=function(){b=PykCharts.maps.processInputs(b,a),d3.json(a.data,function(c){b.data=c,b.compare_data=c,b.k.totalColors(b.colors_total).colorType(b.colors_type).loading(b.loading).tooltip(),d3.json("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/maps/"+b.mapCode+"-topo.json",function(c){b.map_data=c,d3.json("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/palette/colorPalette.json",function(c){b.color_palette_data=c,$(b.selector).html("");var d=new PykCharts.maps.mapFunctions(a,b,"oneLayer");d.render()})}),b.extent_size=d3.extent(b.data,function(a){return parseInt(a.size,10)}),b.difference=b.extent_size[1]-b.extent_size[0]})}},PykCharts.maps.timelineMap=function(a){{var b=this;new PykCharts.Configuration.Theme({})}this.execute=function(){b=PykCharts.maps.processInputs(b,a),d3.json(a.data,function(c){b.timeline_data=c,b.compare_data=c;var d=d3.extent(c,function(a){return a.timestamp});b.data=_.where(c,{timestamp:d[0]}),b.redeced_width=b.width-2*b.margin_left-b.margin_right,b.redeced_height=b.height-b.margin_top-b.margin_bottom,b.k.totalColors(b.colors_total).colorType(b.colors_type).loading(b.loading).tooltip(b.tooltip_enable),d3.json("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/maps/"+b.mapCode+"-topo.json",function(c){b.map_data=c,d3.json("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/palette/colorPalette.json",function(c){b.color_palette_data=c;var d=d3.extent(b.timeline_data,function(a){return a.timestamp});b.data=_.where(b.timeline_data,{timestamp:d[0]}),b.data.sort(function(a,b){return a.timestamp-b.timestamp}),$(b.selector).html("");var e=new PykCharts.maps.mapFunctions(a,b,"timeline");e.render()})}),b.extent_size=d3.extent(b.data,function(a){return parseInt(a.size,10)}),b.difference=b.extent_size[1]-b.extent_size[0]
})}},PykCharts.maps.mapFunctions=function(a,b,c){var d=b;this.render=function(){d.border=new PykCharts.Configuration.border(d),d.k.title().subtitle(),d.current_palette=_.where(d.color_palette_data,{name:d.colors_palette,number:d.colors_total})[0],d.optionalFeatures().legendsContainer(d.legends_enable).legends(d.legends_enable).svgContainer().createMap().label(d.label_enable).enableClick(d.enableClick),d.k.createFooter().lastUpdatedAt().credits().dataSource().liveData(d),"timeline"===c&&(d.optionalFeatures().axisContainer(!0),d.renderDataForTimescale(),d.renderButtons(),d.renderTimeline()),PykCharts.boolean(d.legends_enable)&&"saturation"===d.colors_type?$(window).on("load",function(){return d.k.resize(d.svgContainer,"",d.legendsContainer)}).on("resize",function(){return d.k.resize(d.svgContainer,"",d.legendsContainer)}):$(window).on("load",function(){return d.k.resize(d.svgContainer,"")}).on("resize",function(){return d.k.resize(d.svgContainer,"")})},d.refresh=function(){"oneLayer"===c?d3.json(a.data,function(a){d.data=a,d.refresh_data=a;var b=d.k.checkChangeInData(d.refresh_data,d.compare_data);d.compare_data=b[0];var c=b[1];c&&d.k.lastUpdatedAt("liveData"),d.extent_size=d3.extent(d.data,function(a){return parseInt(a.size,10)}),d.difference=d.extent_size[1]-d.extent_size[0],d.optionalFeatures().legends(d.legends_enable).createMap()}):d3.json(a.data,function(a){d.timeline_data=a,d.refresh_data=a;var b=d.k.checkChangeInData(d.refresh_data,d.compare_data);d.compare_data=b[0];var c=b[1],e=d3.extent(a,function(a){return a.timestamp});d.data=_.where(a,{timestamp:e[0]}),d.optionalFeatures().legends(d.legends_enable).createMap(),d.renderDataForTimescale(),d.renderTimeline(),c&&d.k.lastUpdatedAt("liveData")})},d.optionalFeatures=function(){var b={legends:function(a){return PykCharts.boolean(a)&&d.renderLegend(),this},legendsContainer:function(a){return PykCharts.boolean(a)&&"saturation"===d.colors_type&&(d.legendsContainer=d3.select(d.selector).append("svg").attr("id","legend-container").attr("width",d.width).attr("height",50).attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+d.width+" 50")),this},label:function(a){return PykCharts.boolean(a)&&d.renderLabel(),this},svgContainer:function(){$(d.selector).css("width","100%"),d.svgContainer=d3.select(d.selector).append("svg").attr("width",d.width).attr("height",d.height).attr("class","PykCharts-map").attr("style","border:1px solid lightgrey").style("border-radius","5px").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+d.width+" "+d.height),d.map_cont=d.svgContainer.append("g").attr("id","map_group");var a=d.map_cont.append("defs"),b=a.append("filter").attr("id","dropshadow");b.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1).attr("result","blur"),b.append("feOffset").attr("in","blur").attr("dx",1).attr("dy",1).attr("result","offsetBlur");var c=b.append("feMerge");return c.append("feMergeNode").attr('in", "offsetBlur'),c.append("feMergeNode").attr("in","SourceGraphic"),this},createMap:function(){var b=150,c=[d.width/2,d.height/2];if($(a.selector).css("background-color",d.bg),d.group=d.map_cont.selectAll(".map_group").data(topojson.feature(d.map_data,d.map_data.objects).features),d.group.enter().append("g").attr("class","map_group").append("path"),"world"===d.mapCode)var e=[0,0];else var e=d3.geo.centroid(topojson.feature(d.map_data,d.map_data.objects));var f=d3.geo.mercator().center(e).scale(b).translate(c);d.path=d3.geo.path().projection(f);var g=d.path.bounds(topojson.feature(d.map_data,d.map_data.objects)),h=b*d.width/(g[1][0]-g[0][0]),i=b*d.height/(g[1][1]-g[0][1]),b=i>h?h:i,c=[d.width-(g[0][0]+g[1][0])/2,d.height-(g[0][1]+g[1][1])/2];f=d3.geo.mercator().center(e).scale(d.defaultZoomLevel/100*b).translate(c),d.path=d.path.projection(f);var j=d3.select("#pyk-tooltip");return d.chart_data=d.group.select("path").attr("d",d.path).attr("class","area").attr("iso2",function(a){return a.properties.iso_a2}).attr("state_name",function(a){return a.properties.NAME_1}).attr("fill",d.renderColor).attr("prev_fill",function(){return d3.select(this).attr("fill")}).attr("opacity",d.renderOpacity).style("stroke",d.border.color()).style("stroke-width",d.border.width()+"px").style("stroke-dasharray",d.border.style()).on("mouseover",function(a){PykCharts.boolean(d.tooltip_enable)&&(j.style("visibility","visible"),j.html(_.where(d.data,{iso2:a.properties.iso_a2})[0].tooltip),"moving"===d.tooltip_mode?j.style("top",function(){return d3.event.pageY-20+"px"}).style("left",function(){return d3.event.pageX+20+"px"}):"fixed"===d.tooltip_mode&&j.style("top",d.tooltip_positionTop+"px").style("left",d.tooltip_positionLeft+"px")),d.bodColor(a)}).on("mouseout",function(a){PykCharts.boolean(d.tooltip_enable)&&j.style("visibility","hidden"),d.bodUncolor(a)}),d.group.exit().remove(),this},enableClick:function(a){return PykCharts.boolean(a)&&(d.chart_data.on("click",d.clicked),d.onhover1=d.onhover),this},axisContainer:function(a){return PykCharts.boolean(a)&&(d.gxaxis=d.svgContainer.append("g").attr("id","xaxis").attr("class","x axis").attr("transform","translate("+2*d.margin_left+","+d.redeced_height+")")),this}};return b},d.renderColor=function(a,b){if(!PykCharts.boolean(a))return!1;var c,e=_.where(d.data,{iso2:a.properties.iso_a2});if(e.length>0){if("colors"===d.colors_type)return e.length>0&&""!==e[0].color?e[0].color:d.colors_defaultColor;if("saturation"===d.colors_type){if("yes"===d.highlightArea&&d.highlight===d.map_data.objects.geometries[b].properties.iso_a2)return"yellow";if(""!==d.colors_palette)for(c=e[0].size,b=0;b<d.current_palette.colors.length;b++)if(c>=d.extent_size[0]+b*(d.difference/d.current_palette.colors.length)&&c<=d.extent_size[0]+(b+1)*(d.difference/d.current_palette.colors.length))return 1===d.data.length?d.current_palette.colors[d.current_palette.colors.length-1]:d.current_palette.colors[b];return d.colors_defaultColor}return d.colors_defaultColor}return d.colors_defaultColor},d.renderOpacity=function(a){return""===d.colors_palette&&"saturation"===d.colors_type?(d.oneninth=+d3.format(".2f")(d.difference/10),d.opacity=(d.extent_size[0]+_.where(d.data,{iso2:a.properties.iso_a2})[0].size+d.oneninth)/d.difference,d.opacity):1},d.renderLegend=function(){var a;if("saturation"===d.colors_type){if("vertical"===d.legends_display){var b=0,c=0;""===d.colors_palette?d.legendsContainer.attr("height",290):d.legendsContainer.attr("height",30*d.current_palette.number+20),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,g=function(){return d.width-d.width/12+18},h=function(){return d.width-d.width/12};var e=function(){return b++,24*b+12},f=function(){return c++,24*c+23}}else if("horizontal"===d.legends_display){var b=0,c=0;""===d.colors_palette?(b=9,c=9):(b=d.current_palette.number,c=d.current_palette.number,d.legendsContainer.attr("height",30*d.current_palette.number+20)),d.legendsContainer.attr("height",50),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y";var g=function(){return c--,d.width-(60*c+40)};f=30,rect_parameter1value=13,rect_parameter2value=13;var h=function(){return b--,d.width-(60*b+60)};e=18}if(""===d.colors_palette){var i=[1,2,3,4,5,6,7,8,9];a=d3.format(".1f")(d.extent_size[1]/9),d.leg=function(b,c){return"<"+d3.round(a*(c+1))};var j=d.legendsContainer.selectAll(".rect").data(i);j.enter().append("rect"),j.attr("class","rect").attr("x",h).attr("y",e).attr("width",rect_parameter1value).attr("height",rect_parameter2value).attr("fill",d.colors_defaultColor).attr("opacity",function(a,b){return(b+1)/9}),j.exit().remove(),d.legends_text=d.legendsContainer.selectAll(".text").data(i),d.legends_text.enter().append("text"),d.legends_text.attr("class","text").attr("x",g).attr("y",f).style("font-size",10).style("font","Arial").text(d.leg),d.legends_text.exit().remove()}else{d.leg=function(a,b){return"<"+d3.round(d.extent_size[0]+(b+1)*(d.difference/d.current_palette.number))};var j=d.legendsContainer.selectAll(".rect").data(d.current_palette.colors);j.enter().append("rect"),j.attr("class","rect").attr("x",h).attr("y",e).attr("width",rect_parameter1value).attr("height",rect_parameter2value).attr("fill",function(a){return a}),j.exit().remove(),d.legends_text=d.legendsContainer.selectAll(".text").data(d.current_palette.colors),d.legends_text.enter().append("text"),d.legends_text.attr("class","text").attr("x",g).attr("y",f).style("font-size",10).style("font","Arial").text(d.leg),d.legends_text.exit().remove()}}else $("#legend-container").remove()},d.renderLabel=function(){d.group.append("text").attr("x",function(a){return d.path.centroid(a)[0]}).attr("y",function(a){return d.path.centroid(a)[1]}).attr("text-anchor","middle").attr("font-size","10").attr("pointer-events","none").text(function(a){return a.properties.NAME_1})},d.bodColor=function(a){var b=_.where(d.data,{iso2:a.properties.iso_a2});"none"!==d.onhover1?"highlight_border"===d.onhover1?d3.select("path[state_name='"+a.properties.NAME_1+"']").style("stroke",d.border.color()).style("stroke-width",parseInt(d.border.width())+1.5+"px").style("stroke-dasharray",d.border.style()):"shadow"===d.onhover1?d3.select("path[state_name='"+a.properties.NAME_1+"']").attr("filter","url(#dropshadow)").attr("opacity",function(){return""===d.colors_palette&&"saturation"===d.colors_type?(d.oneninth_dim=+d3.format(".2f")(d.difference/10),d.opacity_dim=(d.extent_size[0]+b[0].size+d.oneninth_dim)/d.difference,d.opacity_dim/2):.5}):"color_saturation"===d.onhover1&&d3.select("path[state_name='"+a.properties.NAME_1+"']").attr("opacity",function(){return""===d.colors_palette&&"saturation"===d.colors_type?(d.oneninth_dim=+d3.format(".2f")(d.difference/10),d.opacity_dim=(d.extent_size[0]+b[0].size+d.oneninth_dim)/d.difference,d.opacity_dim/2):.5}):d.bodUncolor(a)},d.bodUncolor=function(a){d3.select("path[state_name='"+a.properties.NAME_1+"']").style("stroke",d.border.color()).style("stroke-width",d.border.width()).style("stroke-dasharray",d.border.style()).attr("filter",null).attr("opacity",function(){return""===d.colors_palette&&"saturation"===d.colors_type?(d.oneninth_high=+d3.format(".2f")(d.difference/10),d.opacity_high=(d.extent_size[0]+_.where(d.data,{iso2:a.properties.iso_a2})[0].size+d.oneninth_high)/d.difference,d.opacity_high):1})},this.clicked=function(a){var b={};b.container=d3.event.target.ownerSVGElement.parentNode.id,b.area=a.properties,b.data=_.where(d.data,{iso2:a.properties.iso_a2})[0];try{customFunction(b)}catch(c){}},d.renderDataForTimescale=function(){d.unique=[],x_extent=d3.extent(d.timeline_data,function(a){return a.timestamp}),x_range=[0,d.redeced_width],d.xScale=d.k.scaleIdentification("linear",x_extent,x_range),_.each(d.timeline_data,function(a){-1===d.unique.indexOf(a.timestamp)&&d.unique.push(a.timestamp)}),d.unique.sort(function(a,b){return a-b}),d.k.xAxis(d.svgContainer,d.gxaxis,d.xScale)},d.renderTimeline=function(){var a=interval1=1;d.play.on("click",function(){c()});var b,c=function(){if(console.log("hey"),"playing"===b)d.play.attr("xlink:href","https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/assets/images/play.gif"),clearInterval(d.play_interval),b="paused";else{b="playing",d.play.attr("xlink:href","https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/assets/images/pause.gif"),d.play_interval=setInterval(function(){d.marker.attr("x",2*d.margin_left+d.xScale(d.unique[a])-7),d.data=_.where(d.timeline_data,{timestamp:d.unique[a]}),d.data.sort(function(a,b){return a.timestamp-b.timestamp}),_.each(d.data,function(a){d3.select("path[iso2='"+a.iso2+"']").attr("fill",d.renderColor)}),a++,a===d.unique.length&&clearInterval(d.play_interval)},d.timeline_duration);var c=setTimeout(function(){var e=setInterval(function(){interval1++,interval1===a&&(clearInterval(e),clearTimeout(c)),interval1===d.unique.length&&(clearInterval(e),d.play.attr("xlink:href","https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/assets/images/play.gif"),d.marker.attr("x",2*d.margin_left+d.xScale(d.unique[0])-7),a=interval1=1,b="")},d.timeline_duration)},d.timeline_duration)}}},d.renderButtons=function(){var a=d3.select(d.selector+" .axis").node().getBBox();d.play=d.svgContainer.append("image").attr("xlink:href","https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/assets/images/play.gif").attr("x",d.margin_left/2).attr("y",d.redeced_height-d.margin_top-a.height/2).attr("width","24px").attr("height","21px").style("cursor","pointer"),d.marker=d.svgContainer.append("image").attr("xlink:href","https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/assets/images/marker.png").attr("x",2*d.margin_left+d.xScale(d.unique[0])-7).attr("y",d.redeced_height).attr("width","14px").attr("height","12px")}},function(){function a(a){var b=document.createElement("script");b.type="text/javascript",b.async=!1,b.onload=b.onreadystatechange=function(){try{_&&d3&&($||jQuery)&&d3.customHive&&topojson&&window.PykChartsInit()}catch(a){}},b.src=a;var c=document.getElementsByTagName("link")[0];c.parentNode.insertBefore(b,c)}try{d3||a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/d3.min.js")}catch(b){a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/d3.min.js")}try{_||a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/underscore-min.js")}catch(b){a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/underscore-min.js")}try{$||jQuery||a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/jquery-1.11.1.min.js")}catch(b){a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/jquery-1.11.1.min.js")}try{topojson||a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/topojson.js")}catch(b){a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/topojson.js")}try{d3.customHive||a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/custom-hive.min.js")}catch(b){a("https://s3-ap-southeast-1.amazonaws.com/ap-southeast-1.datahub.pykih/distribution/js/custom-hive.min.js")}}();